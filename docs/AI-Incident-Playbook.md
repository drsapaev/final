# AI Incident Playbook

> –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –Ω–µ–ø–æ–ª–∞–¥–æ–∫ AI –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã

---

## üö® –°–∏–º–ø—Ç–æ–º—ã –∏ –¥–µ–π—Å—Ç–≤–∏—è

### 1. "AI –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç" / Timeout

**–ü—Ä–∏–∑–Ω–∞–∫–∏**:
- Loading –∫—Ä—É—Ç–∏—Ç—Å—è –±–æ–ª—å—à–µ 2 –º–∏–Ω—É—Ç
- –í –∫–æ–Ω—Å–æ–ª–∏: `Request timeout`
- –í –ª–æ–≥–∞—Ö: `MCP_TIMEOUT`

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ backend
grep "MCP_TIMEOUT" backend.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å circuit breaker
curl /api/v1/mcp/circuit-breaker
```

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API –∫–ª—é—á–∏ –≤ `.env`
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (DeepSeek, OpenAI)
3. –ï—Å–ª–∏ circuit breaker —Å—Ä–∞–±–æ—Ç–∞–ª ‚Äî –ø–æ–¥–æ–∂–¥–∞—Ç—å 5 –º–∏–Ω—É—Ç
4. –í—Ä–µ–º–µ–Ω–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `MCP_REQUEST_TIMEOUT`

---

### 2. Circuit Breaker —Å—Ä–∞–±–æ—Ç–∞–ª

**–ü—Ä–∏–∑–Ω–∞–∫–∏**:
- –í –ª–æ–≥–∞—Ö: `CIRCUIT_BREAKER_TRIPPED`
- –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã —Å –æ—à–∏–±–∫–æ–π "Server temporarily unavailable"

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```bash
curl /api/v1/mcp/circuit-breaker
# –û—Ç–≤–µ—Ç –ø–æ–∫–∞–∂–µ—Ç disabled —Å–µ—Ä–≤–µ—Ä—ã –∏ –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è
```

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏—á–∏–Ω—É failures (—Ç–∞–π–º–∞—É—Ç—ã? –æ—à–∏–±–∫–∏ API?)
2. –ü–æ–¥–æ–∂–¥–∞—Ç—å –æ–∫–æ–Ω—á–∞–Ω–∏—è cooldown (5 –º–∏–Ω—É—Ç)
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
4. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å backend

---

### 3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

**–ü—Ä–∏–∑–Ω–∞–∫–∏**:
- AI –¥–∞—ë—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∫–æ–¥—ã –ú–ö–ë-10
- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —Å–∏–º–ø—Ç–æ–º–∞–º

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (dev mode)
// –ò—Å–∫–∞—Ç—å: [AI Debug] ‚Äî –ø–æ–∫–∞–∂–µ—Ç –∫–∞–∫–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è
```

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `debug_meta.provider`
2. –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø—Ä–æ–≤–∞–π–¥–µ—Ä —á–µ—Ä–µ–∑ `.env`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å prompt –≤ `deepseek_provider.py`
4. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Å–∏–º–ø—Ç–æ–º—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 4. –ü—É—Å—Ç—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏

**–ü—Ä–∏–∑–Ω–∞–∫–∏**:
- AI –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è, –Ω–æ suggestions –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤
- –í –∫–æ–Ω—Å–æ–ª–∏: `[EMR AI] No ICD-10 suggestions returned`

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
grep "DeepSeek ICD10" backend.log
```

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ symptoms –Ω–µ –ø—É—Å—Ç—ã–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JSON parsing –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ
3. –°–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ fallback regex –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ
4. –í—Ä–µ–º–µ–Ω–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---

### 5. Frontend –∑–∞–≤–∏—Å–∞–µ—Ç

**–ü—Ä–∏–∑–Ω–∞–∫–∏**:
- UI –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è AI
- –ù–µ—Ç error –≤ –∫–æ–Ω—Å–æ–ª–∏

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞**:
```
Network tab ‚Üí –Ω–∞–π—Ç–∏ /mcp/* –∑–∞–ø—Ä–æ—Å ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
```

**–î–µ–π—Å—Ç–≤–∏—è**:
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å network tab –Ω–∞ pending –∑–∞–ø—Ä–æ—Å—ã
2. –°—Ä–∞–≤–Ω–∏—Ç—å `MCP_REQUEST_TIMEOUT` –∏ frontend timeout
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω
4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É

---

## üîß –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ MCP
```bash
curl -H "Authorization: Bearer $TOKEN" /api/v1/mcp/health
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
```bash
curl -H "Authorization: Bearer $TOKEN" /api/v1/mcp/metrics
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å circuit breaker
```bash
curl -H "Authorization: Bearer $TOKEN" /api/v1/mcp/circuit-breaker
```

### –ù–∞–π—Ç–∏ —Ç–∞–π–º–∞—É—Ç—ã –≤ –ª–æ–≥–∞—Ö
```bash
grep "MCP_TIMEOUT\|CIRCUIT_BREAKER" backend.log | tail -20
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- `requests_failed` ‚Äî –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- `avg_response_time` ‚Äî —Å—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞
- Circuit breaker —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

### –ê–ª–µ—Ä—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å)
- `requests_failed` > 10 –∑–∞ 5 –º–∏–Ω—É—Ç
- `avg_response_time` > 60 —Å–µ–∫—É–Ω–¥
- Circuit breaker —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

---

## üìû –≠—Å–∫–∞–ª–∞—Ü–∏—è

1. **L1**: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend
2. **L2**: –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–µ–π, —Å–º–µ–Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
3. **L3**: –ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤, debugging –∫–æ–¥–∞
4. **L4**: –ö–æ–Ω—Ç–∞–∫—Ç —Å –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º API (DeepSeek, OpenAI)

---

## üìù –®–∞–±–ª–æ–Ω –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞

```
–í—Ä–µ–º—è: [–∫–æ–≥–¥–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ]
–°–∏–º–ø—Ç–æ–º—ã: [—á—Ç–æ –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è]
–ó–∞—Ç—Ä–æ–Ω—É—Ç–æ: [–∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏]
–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:
  - Circuit breaker: [ok/tripped]
  - –õ–æ–≥–∏: [–∫–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏]
  - Provider: [–∫–∞–∫–æ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è]
–ü—Ä–∏—á–∏–Ω–∞: [–µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–∞]
–†–µ—à–µ–Ω–∏–µ: [—á—Ç–æ —Å–¥–µ–ª–∞–Ω–æ]
–í—Ä–µ–º—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è: [–∫–æ–≥–¥–∞ –∑–∞—Ä–∞–±–æ—Ç–∞–ª–æ]
```
