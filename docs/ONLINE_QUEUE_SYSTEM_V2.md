# –°–∏—Å—Ç–µ–º–∞ –æ–Ω–ª–∞–π–Ω-–æ—á–µ—Ä–µ–¥–µ–π ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è v2.0

---

# –ß–ê–°–¢–¨ 1: –ö–ê–ö –≠–¢–û –†–ê–ë–û–¢–ê–ï–¢ (–ü—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º)

---

## 1. –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π?

–°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–± –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –≤ –∫–ª–∏–Ω–∏–∫–µ. –û–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –ü–∞—Ü–∏–µ–Ω—Ç–∞–º –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –∑–∞—Ä–∞–Ω–µ–µ —á–µ—Ä–µ–∑ QR-–∫–æ–¥ –∏–ª–∏ Telegram
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É —É–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Ç–æ–∫–æ–º –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
- –í—Ä–∞—á–∞–º –≤–∏–¥–µ—Ç—å, –∫—Ç–æ —Å–ª–µ–¥—É—é—â–∏–π
- –ö–∞—Å—Å–µ –∑–Ω–∞—Ç—å, —á—Ç–æ –æ–ø–ª–∞—á–µ–Ω–æ

### –ö–∞–∫ –ø–∞—Ü–∏–µ–Ω—Ç –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –æ—á–µ—Ä–µ–¥—å?

–°—É—â–µ—Å—Ç–≤—É–µ—Ç **5 —Å–ø–æ—Å–æ–±–æ–≤** –∑–∞–ø–∏—Å–∏ –≤ –æ—á–µ—Ä–µ–¥—å:

| –°–ø–æ—Å–æ–± | –û–ø–∏—Å–∞–Ω–∏–µ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è |
|--------|----------|-------------------|
| **QR-–∫–æ–¥** (`online`) | –ü–∞—Ü–∏–µ–Ω—Ç —Å–∫–∞–Ω–∏—Ä—É–µ—Ç QR, –≤—ã–±–∏—Ä–∞–µ—Ç –≤—Ä–∞—á–µ–π | –£—Ç—Ä–æ–º –¥–æ 09:00 |
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä–∞** (`desk`) | –†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞ –≤—Ä—É—á–Ω—É—é | –í –ª—é–±–æ–µ –≤—Ä–µ–º—è |
| **Telegram** (`telegram`) | –ü–∞—Ü–∏–µ–Ω—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞ | –í –ª—é–±–æ–µ –≤—Ä–µ–º—è |
| **–ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** (`mobile_app`) | –ß–µ—Ä–µ–∑ PWA-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | –í –ª—é–±–æ–µ –≤—Ä–µ–º—è |
| **–£—Ç—Ä–µ–Ω–Ω–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** (`morning_assignment`) | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö –≤–∏–∑–∏—Ç–æ–≤ | –í 06:00 |

---

## 2. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ QR?

| –í—Ä–µ–º—è | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç |
|-------|----------------|
| **06:00** | –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö –≤–∏–∑–∏—Ç–æ–≤ |
| **07:00‚Äì09:00** | –ü–∞—Ü–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR –∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –°–ï–ì–û–î–ù–Ø |
| **–ü–æ—Å–ª–µ 09:00** | QR-–∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è |
| **–ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞** | QR-–∑–∞–ø–∏—Å—å –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–∞—á–∞–ª —Ä–∞–±–æ—Ç—É) |

### –ß—Ç–æ —Ç–∞–∫–æ–µ "–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ QR"?

–ö–æ–≥–¥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º—É —É—Ç—Ä–æ–º, QR-–∑–∞–ø–∏—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è. –≠—Ç–æ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã:
- –ù–µ –±—ã–ª–æ —Ö–∞–æ—Å–∞ —Å –∑–∞–ø–∏—Å—è–º–∏
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞–ª –ø–æ—Ç–æ–∫
- –ü–∞—Ü–∏–µ–Ω—Ç—ã, –ø—Ä–∏—à–µ–¥—à–∏–µ –ø–æ–∑–∂–µ, –æ–±—Ä–∞—â–∞–ª–∏—Å—å –≤ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—É

> **–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:** –ï—Å—Ç—å —Ä–µ–∂–∏–º Dev Mode (–∫–Ω–æ–ø–∫–∞ –≤ Admin Panel –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `DISABLE_QUEUE_TIME_RESTRICTIONS=true`), –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–∫–ª—é—á–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

---

## 3. –ù–æ–º–µ—Ä–∞ –≤ –æ—á–µ—Ä–µ–¥–∏

### –ö–∞–∫ –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è –Ω–æ–º–µ—Ä–∞?

- –ö–∞–∂–¥—ã–π –≤—Ä–∞—á –∏–º–µ–µ—Ç **—Å–≤–æ–π –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫** –Ω–æ–º–µ—Ä–æ–≤
- –í—Å–µ –Ω–∞—á–∏–Ω–∞—é—Ç —Å –Ω–æ–º–µ—Ä–∞ **1** –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- –ö–∞—Ä–¥–∏–æ–ª–æ–≥: 1, 2, 3, 4...
- –°—Ç–æ–º–∞—Ç–æ–ª–æ–≥: 1, 2, 3, 4...

### –ß—Ç–æ —Ç–∞–∫–æ–µ `queue_time`?

`queue_time` ‚Äî —ç—Ç–æ **–º–æ–º–µ–Ω—Ç, –∫–æ–≥–¥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –ø–æ—è–≤–∏–ª–∞—Å—å –≤ –æ—á–µ—Ä–µ–¥–∏**.

**–ü—Ä–∞–≤–∏–ª–æ:**
- –ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å ‚Üí –≤—Ä–µ–º—è QR/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –ù–æ–≤–∞—è —É—Å–ª—É–≥–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ ‚Üí –≤—Ä–µ–º—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ:**
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤ –æ—á–µ—Ä–µ–¥–∏
- –ß–µ–º —Ä–∞–Ω—å—à–µ `queue_time` ‚Äî —Ç–µ–º —Ä–∞–Ω—å—à–µ –ø–∞—Ü–∏–µ–Ω—Ç –±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω
- –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—Ç–∞—Ä—ã–µ —É—Å–ª—É–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç —Å–≤–æ—ë –≤—Ä–µ–º—è

---

## 4. –ü–æ—Ä—è–¥–æ–∫ –≤ –æ—á–µ—Ä–µ–¥–∏ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã)

### –ö—Ç–æ –ø–µ—Ä–≤—ã–π?

–ü–æ—Ä—è–¥–æ–∫ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –ø–æ `queue_time`**. –ò—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–ø–∏—Å–∏ –Ω–µ –≤–ª–∏—è–µ—Ç.

**–ü—Ä–∏–º–µ—Ä –Ω–∞ 09:30:**
1. –ò–≤–∞–Ω–æ–≤ ‚Äî `morning_assignment` (06:00) ‚Üí **–ø–µ—Ä–≤—ã–π**
2. –ü–µ—Ç—Ä–æ–≤ ‚Äî `online` (07:15) ‚Üí **–≤—Ç–æ—Ä–æ–π**
3. –°–∏–¥–æ—Ä–æ–≤ ‚Äî `online` (07:20) ‚Üí **—Ç—Ä–µ—Ç–∏–π**
4. –ö–æ–∑–ª–æ–≤ ‚Äî `desk` (09:25) ‚Üí **—á–µ—Ç–≤—ë—Ä—Ç—ã–π**

**–ü–æ—á–µ–º—É –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –∑–∞—Ä–∞–Ω–µ–µ –ø–µ—Ä–≤—ã–µ:**
–£—Ç—Ä–µ–Ω–Ω–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ 06:00, –ø–æ—ç—Ç–æ–º—É —ç—Ç–∏ –ø–∞—Ü–∏–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞—é—Ç —Å–∞–º–æ–µ —Ä–∞–Ω–Ω–µ–µ `queue_time`.

---

## 5. –°—Ç–∞—Ç—É—Å—ã –∑–∞–ø–∏—Å–∏ –≤ –æ—á–µ—Ä–µ–¥–∏

### –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –∑–∞–ø–∏—Å–∏

```
waiting ‚Üí called ‚Üí in_service ‚Üí diagnostics ‚Üí in_service ‚Üí served
                       ‚Üò no_show
                       ‚Üò incomplete (–≤—Ä–∞—á –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç)
                       ‚Üò cancelled (–Ω–∞ –ª—é–±–æ–º —ç—Ç–∞–ø–µ)
```

### –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| `waiting` | –ü–∞—Ü–∏–µ–Ω—Ç –æ–∂–∏–¥–∞–µ—Ç –≤—ã–∑–æ–≤–∞ |
| `called` | –í—ã–∑–≤–∞–Ω (–Ω–æ–º–µ—Ä –Ω–∞ —Ç–∞–±–ª–æ, –∏–¥—ë—Ç –∫ –∫–∞–±–∏–Ω–µ—Ç—É) |
| `in_service` | –ó–∞—à—ë–ª –∫ –≤—Ä–∞—á—É, —É—Å–ª—É–≥–∞ –Ω–∞—á–∞–ª–∞—Å—å |
| `diagnostics` | –í—Ä–µ–º–µ–Ω–Ω–æ –Ω–∞ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ (–≠–ö–ì, –∞–Ω–∞–ª–∏–∑—ã), –≤–µ—Ä–Ω—ë—Ç—Å—è |
| `served` | –û–±—Å–ª—É–∂–µ–Ω –∏ –≤—ã—à–µ–ª |
| `incomplete` | –£—à—ë–ª, –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è (–≤—Ä–∞—á –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å –ø—Ä–∏—á–∏–Ω–æ–π) |
| `no_show` | –ù–µ –ø—Ä–∏—à—ë–ª –ø–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ |
| `cancelled` | –û—Ç–º–µ–Ω—ë–Ω |

### –°—Ç–∞—Ç—É—Å `diagnostics` ‚Äî –≤–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –í—Ä–∞—á –æ—Å–º–æ—Ç—Ä–µ–ª –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∏–ª –Ω–∞ –≠–ö–ì. –ü–∞—Ü–∏–µ–Ω—Ç —É—à—ë–ª –Ω–∞ 15‚Äì20 –º–∏–Ω—É—Ç.

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
- –°—Ç–∞—Ç—É—Å ‚Üí `diagnostics`
- –û—á–µ—Ä–µ–¥—å –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- –ù–æ–º–µ—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –í–∏–∑–∏—Ç –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
- EMR –æ—Å—Ç–∞—ë—Ç—Å—è –æ—Ç–∫—Ä—ã—Ç—ã–º

**–ö–æ–≥–¥–∞ –ø–∞—Ü–∏–µ–Ω—Ç –≤–µ—Ä–Ω—É–ª—Å—è:**
- –í—Ä–∞—á –Ω–∞–∂–∏–º–∞–µ—Ç "–í–µ—Ä–Ω—É–ª—Å—è –≤ –∫–∞–±–∏–Ω–µ—Ç"
- –°—Ç–∞—Ç—É—Å ‚Üí `in_service`

### –°—Ç–∞—Ç—É—Å `incomplete` ‚Äî –ø–∞—Ü–∏–µ–Ω—Ç –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è

**–ï—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç —É—à—ë–ª –¥–æ–º–æ–π –∏ –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è:**
1. –°–∏—Å—Ç–µ–º–∞ –ù–ï –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–∏–∑–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
2. –í –∫–æ–Ω—Ü–µ —Å–º–µ–Ω—ã –≤—Ä–∞—á –ø–æ–ª—É—á–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
3. –í—Ä–∞—á –≤—ã–±–∏—Ä–∞–µ—Ç "–ó–∞–≤–µ—Ä—à–∏—Ç—å –∫–∞–∫ incomplete" —Å –ø—Ä–∏—á–∏–Ω–æ–π:
   - "–ü–∞—Ü–∏–µ–Ω—Ç —É—à—ë–ª –¥–æ–º–æ–π, –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è"
   - "–û—Ç–∫–∞–∑–∞–ª—Å—è –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –æ—Å–º–æ—Ç—Ä"
   - "–ù–µ –¥–æ–∂–¥–∞–ª—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤"

**–ù–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å:**
- –°–æ–∑–¥–∞—ë—Ç—Å—è –ù–û–í–´–ô –≤–∏–∑–∏—Ç
- –°–æ–∑–¥–∞—ë—Ç—Å—è –ù–û–í–ê–Ø –∑–∞–ø–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥–∏
- –°—Ç–∞—Ä—ã–π –≤–∏–∑–∏—Ç –æ—Å—Ç–∞—ë—Ç—Å—è `incomplete` –Ω–∞–≤—Å–µ–≥–¥–∞
- –°—Ç–∞—Ä—ã–π EMR ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è

---

## 6. –î—É–±–ª–∏–∫–∞—Ç—ã –∑–∞–ø–∏—Å–µ–π

### –ß—Ç–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –¥—É–±–ª–∏–∫–∞—Ç–æ–º?

**–î–ª—è –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏ (QR):**
- –û–¥–∏–Ω –ø–∞—Ü–∏–µ–Ω—Ç + –æ–¥–∏–Ω –≤—Ä–∞—á + –æ–¥–Ω–∞ —É—Å–ª—É–≥–∞ + –æ–¥–∏–Ω –¥–µ–Ω—å = **–¥—É–±–ª–∏–∫–∞—Ç (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è)**

**–î–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:**
- –ë–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π (–¥–µ–π—Å—Ç–≤—É–µ—Ç –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ, –Ω–µ—Å—ë—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å)

### –ú–æ–∂–Ω–æ –ª–∏ –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –∫ –æ–¥–Ω–æ–º—É –≤—Ä–∞—á—É –Ω–∞ —Ä–∞–∑–Ω—ã–µ —É—Å–ª—É–≥–∏?

**–î–∞!** –ï—Å–ª–∏ —ç—Ç–æ —Ä–∞–∑–Ω—ã–µ —É—Å–ª—É–≥–∏ ‚Äî —ç—Ç–æ –ù–ï –¥—É–±–ª–∏–∫–∞—Ç.

–ü—Ä–∏–º–µ—Ä: –ü–∞—Ü–∏–µ–Ω—Ç –∑–∞–ø–∏—Å–∞–ª—Å—è –∫ –∫–∞—Ä–¥–∏–æ–ª–æ–≥—É –Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é. –ü–æ—Ç–æ–º —Ö–æ—á–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≠—Ö–æ–ö–ì. –≠—Ç–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ ‚Äî —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤—Ç–æ—Ä–∞—è –∑–∞–ø–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥–∏.

---

## 7. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ QR

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. –ü–∞—Ü–∏–µ–Ω—Ç —Å–∫–∞–Ω–∏—Ä—É–µ—Ç **–æ–±—â–∏–π QR –∫–ª–∏–Ω–∏–∫–∏**
2. –í–≤–æ–¥–∏—Ç –§–ò–û –∏ —Ç–µ–ª–µ—Ñ–æ–Ω
3. –í—ã–±–∏—Ä–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤—Ä–∞—á–µ–π: –ö–∞—Ä–¥–∏–æ–ª–æ–≥ ‚úÖ, –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è ‚úÖ
4. –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°–æ–∑–¥–∞—é—Ç—Å—è **2 –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø–∏—Å–∏** –≤ –æ—á–µ—Ä–µ–¥—è—Ö
- –ö–∞—Ä–¥–∏–æ–ª–æ–≥: –Ω–æ–º–µ—Ä 3, `queue_time = 07:30`
- –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è: –Ω–æ–º–µ—Ä 5, `queue_time = 07:30`
- –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ `queue_time` ‚Äî —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ, –ø–∞—Ü–∏–µ–Ω—Ç –∑–∞–ø–∏—Å–∞–ª—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

## 8. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤ ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### 8.1 –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∞–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

| –≠—Ç–∞–ø | –†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä | –í—Ä–∞—á | –ü–∞—Ü–∏–µ–Ω—Ç |
|------|-------------|------|---------|
| **–î–æ –æ–ø–ª–∞—Ç—ã** | ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é: —É—Å–ª—É–≥–∏, –¥–∞—Ç—ã, –≤—Ä–∞—á–µ–π, –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ | ‚úÖ –°–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ (–∫–æ–Ω—Ç–∞–∫—Ç) |
| **–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã, –¥–æ –≤—Ö–æ–¥–∞** | ‚úÖ –£—Å–ª—É–≥–∏ + –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –∫–∞—Å—Å—ã | ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ | ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ |
| **–í–æ –≤—Ä–µ–º—è –ø—Ä–∏—ë–º–∞ (`in_service`)** | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –≤–∏–∑–∏—Ç–∞ | ‚úÖ –£—Å–ª—É–≥–∏, EMR, —Å—Ç–∞—Ç—É—Å—ã | ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ |
| **–ù–∞ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ (`diagnostics`)** | ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π | ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è | ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ |
| **–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (`served`)** | ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ | ‚ùå –ó–∞–ø—Ä–µ—â–µ–Ω–æ | ‚ùå –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ |

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∞–≤–∏–ª–∞:**
- **–†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä** ‚Äî –≥–ª–∞–≤–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –¥–æ `served`
- **–í—Ä–∞—á** ‚Äî —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Å–≤–æ–µ–≥–æ –ø—Ä–∏—ë–º–∞
- **–ü–∞—Ü–∏–µ–Ω—Ç** ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞, —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –¥–æ –æ–ø–ª–∞—Ç—ã
- –ü–æ—Å–ª–µ `served` ‚Äî –∏—Å—Ç–æ—Ä–∏—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–∞ (–¥–ª—è –∞—É–¥–∏—Ç–∞)

### 8.2 –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–∞—á–∞/–¥–∞—Ç—ã –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã

**–ü—Ä–∞–≤–∏–ª–æ:** –¢–æ–ª—å–∫–æ –≤ –æ—Å–æ–±—ã—Ö —Å–ª—É—á–∞—è—Ö:
- –ë–æ–ª–µ–∑–Ω—å –≤—Ä–∞—á–∞
- –§–æ—Ä—Å-–º–∞–∂–æ—Ä
- –°–∏—Å—Ç–µ–º–Ω–∞—è –æ—à–∏–±–∫–∞

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:**
1. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç—É
2. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –±–∏–ª–ª–∏–Ω–≥–∞ (–¥–æ–ø–ª–∞—Ç–∞/–≤–æ–∑–≤—Ä–∞—Ç)
3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –∞—É–¥–∏—Ç–µ

### 8.3 –î–µ–π—Å—Ç–≤–∏—è –≤—Ä–∞—á–∞ –≤–æ –≤—Ä–µ–º—è –ø—Ä–∏—ë–º–∞

| –î–µ–π—Å—Ç–≤–∏–µ | –†–∞–∑—Ä–µ—à–µ–Ω–æ? | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|----------|------------|-------------|
| –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é —É—Å–ª—É–≥—É | ‚úÖ –î–∞ | –í—Ä–∞—á –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–∞–º –æ–∫–∞–∑—ã–≤–∞–µ—Ç |
| –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É –¥—Ä—É–≥–æ–≥–æ –≤—Ä–∞—á–∞ | ‚ùå –ù–µ—Ç | –ß–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—É |
| –£–¥–∞–ª–∏—Ç—å/–æ—Ç–º–µ–Ω–∏—Ç—å —É—Å–ª—É–≥—É | ‚ö†Ô∏è –¢–æ–ª—å–∫–æ —Å–≤–æ–∏ | –ò–∑–º–µ–Ω–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è |
| –ò–∑–º–µ–Ω–∏—Ç—å –¥–∏–∞–≥–Ω–æ–∑ (EMR) | ‚úÖ –î–∞ | –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞ –≤—Ä–∞—á–∞ |
| –ù–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ | ‚úÖ –î–∞ | –°–æ–∑–¥–∞—ë—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥–∏ |
| –û—Ç–º–µ—Ç–∏—Ç—å —É—Å–ª—É–≥—É –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—É—é | ‚úÖ –î–∞ | –ü–æ—Å–ª–µ –æ–∫–∞–∑–∞–Ω–∏—è —É—Å–ª—É–≥–∏ |

### 8.4 –°—Ü–µ–Ω–∞—Ä–∏–π: –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

**–ü—Ä–∏–º–µ—Ä:** –í—Ä–∞—á-–∫–∞—Ä–¥–∏–æ–ª–æ–≥ –≥–æ–≤–æ—Ä–∏—Ç: "–í–∞–º –Ω—É–∂–Ω–æ –≠–ö–ì, –ø–æ—Ç–æ–º –≤–µ—Ä–Ω–∏—Ç–µ—Å—å".

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –í—Ä–∞—á –Ω–∞–∂–∏–º–∞–µ—Ç "–ù–∞–ø—Ä–∞–≤–∏—Ç—å –Ω–∞ –≠–ö–ì"
2. –°—Ç–∞—Ç—É—Å –≤–∏–∑–∏—Ç–∞ ‚Üí `diagnostics`
3. –ü–∞—Ü–∏–µ–Ω—Ç –∏–¥—ë—Ç –≤ **—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—É**
4. **–û–ø–ª–∞—á–∏–≤–∞–µ—Ç** —É—Å–ª—É–≥—É –≠–ö–ì
5. –ü–æ–ª—É—á–∞–µ—Ç **—Ç–∞–ª–æ–Ω** —Å –Ω–æ–º–µ—Ä–æ–º –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –≠–ö–ì
6. –ü–æ—Å–ª–µ –≠–ö–ì –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫ –≤—Ä–∞—á—É

**–ü–æ—á–µ–º—É —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—É?**
- –ö–æ–Ω—Ç—Ä–æ–ª—å –æ–ø–ª–∞—Ç—ã
- –ü–µ—á–∞—Ç—å —Ç–∞–ª–æ–Ω–∞
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ —É—á—ë—Ç–∞

### 8.5 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º

**–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–π —É—Å–ª—É–≥–∏:**
- –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ ‚Äî **–Ω–µ –º–µ–Ω—è—é—Ç—Å—è** (–Ω–æ–º–µ—Ä, `queue_time` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è)
- –ù–æ–≤–∞—è —É—Å–ª—É–≥–∞ ‚Üí **–Ω–æ–≤—ã–π –Ω–æ–º–µ—Ä –≤ –∫–æ–Ω–µ—Ü –æ—á–µ—Ä–µ–¥–∏** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≤—Ä–∞—á–∞
- –ù–æ–≤–∞—è —É—Å–ª—É–≥–∞ ‚Üí **`queue_time` = –≤—Ä–µ–º—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**

**–ü—Ä–∏–º–µ—Ä:**
- 07:30: –ü–∞—Ü–∏–µ–Ω—Ç –∑–∞–ø–∏—Å–∞–ª—Å—è –Ω–∞ –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∞ (–Ω–æ–º–µ—Ä 3, `queue_time = 07:30`)
- 14:10: –†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è (–Ω–æ–º–µ—Ä 12, `queue_time = 14:10`)

### 8.6 –£–¥–∞–ª–µ–Ω–∏–µ —É—Å–ª—É–≥–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- `OnlineQueueEntry` ‚Üí —Å—Ç–∞—Ç—É—Å `cancelled`
- –í–∏–∑–∏—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–µ (–∏—Å—Ç–æ—Ä–∏—è)
- **–§–∏–∑–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ù–ï –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç**

### 8.7 –°—Ü–µ–Ω–∞—Ä–∏–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ–ø–ª–∞—Ç—ã

| –°–∏—Ç—É–∞—Ü–∏—è | –î–µ–π—Å—Ç–≤–∏–µ |
|----------|----------|
| **–û—Ç–º–µ–Ω–∞ –¥–æ –ø—Ä–∏—Ö–æ–¥–∞** | –û–ø–ª–∞—Ç–∞ –≤ –∫–ª–∏–Ω–∏–∫–µ ‚Üí –Ω–µ—á–µ–≥–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å. –û–Ω–ª–∞–π–Ω ‚Üí —á–∞—Å—Ç–∏—á–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç (- –±–∞–Ω–∫–æ–≤—Å–∫–∞—è –∫–æ–º–∏—Å—Å–∏—è) |
| **–í—Ä–∞—á –æ—Ç–º–µ–Ω—è–µ—Ç —É—Å–ª—É–≥—É** | –í–æ–∑–≤—Ä–∞—Ç –ø–æ–ª–Ω–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É—Å–ª—É–≥–∏ –ò–õ–ò –º–∏–Ω—É—Å –∫–æ–º–∏—Å—Å–∏—è –∑–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é |
| **–ó–∞–º–µ–Ω–∞ –Ω–∞ –±–æ–ª–µ–µ –¥–æ—Ä–æ–≥—É—é** | –î–æ–ø–ª–∞—Ç–∞ —Ä–∞–∑–Ω–∏—Ü—ã (—Å—Ç–∞—Ä–∞—è –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è) |
| **–ó–∞–º–µ–Ω–∞ –Ω–∞ –±–æ–ª–µ–µ –¥–µ—à—ë–≤—É—é** | –í–æ–∑–≤—Ä–∞—Ç —Ä–∞–∑–Ω–∏—Ü—ã |

---

## 8.8 ‚úÖ (–†–ï–®–ï–ù–û) –ü—Ä–æ–±–ª–µ–º–∞: –£—Å–ª—É–≥–∏ QR-–∑–∞–ø–∏—Å–µ–π –Ω–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤ –º–∞—Å—Ç–µ—Ä–µ

### –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã (–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–æ–µ)

–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ QR-–∑–∞–ø–∏—Å–∏ –≤ `AppointmentWizardV2`:
1. –£—Å–ª—É–≥–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∫–æ—Ä–∑–∏–Ω–µ (—à–∞–≥ 2)
2. –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è **–¥—É–±–ª–∏–∫–∞—Ç** –≤–º–µ—Å—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
3. –ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ—Å—Ç–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

**1Ô∏è‚É£ Backend: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è API**
API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ —Å–µ—Ä–≤–∏—Å–∞—Ö (`service_details`), –≤–∫–ª—é—á–∞—è `service_id`.

**2Ô∏è‚É£ Frontend (RegistrarPanel.jsx): –ü–µ—Ä–µ–¥–∞—á–∞ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
`queue_numbers` –æ–±–æ–≥–∞—â–∞–µ—Ç—Å—è –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ API, –ø–µ—Ä–µ–¥–∞–≤–∞—è `service_id` –∏ `service_name`.

**3Ô∏è‚É£ Frontend (AppointmentWizardV2.jsx): –£–º–Ω—ã–π fallback –∏ SSOT**
–ú–∞—Å—Ç–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `updateOnlineQueueEntry` –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –∑–∞–ø–∏—Å–∏ –≤–º–µ—Å—Ç–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π.

**4Ô∏è‚É£ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**
–í–Ω–µ–¥—Ä–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–∞–ø–∏—Å–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –Ω–æ–≤–æ–π, –∏ –≤–∏–∑—É–∞–ª—å–Ω–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü–µ.

### –°—Ç–∞—Ç—É—Å: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (v2.2)

---

## 8.9 ‚ö†Ô∏è –ó–ê–ö–û–ù: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ª—É–≥ –≤ Registrar Panel

### üö® –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –ü–†–ê–í–ò–õ–û

**–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è —É—Å–ª—É–≥ QR-–∑–∞–ø–∏—Å–µ–π ‚Äî –º–∞—Å—Å–∏–≤ `queue_numbers`!**

```
‚ùå –ó–ê–ü–†–ï–©–ï–ù–û: –ë—Ä–∞—Ç—å —É—Å–ª—É–≥–∏ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ appointment.services –¥–ª—è QR-–∑–∞–ø–∏—Å–µ–π
‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò–∑–≤–ª–µ–∫–∞—Ç—å —É—Å–ª—É–≥–∏ –∏–∑ queue_numbers –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–¥—ã
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    RegistrarPanel.jsx                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  filterServicesByDepartment(appointment, departmentKey)     ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ departmentKey = null ("–í—Å–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è")                 ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ –°–æ–±–∏—Ä–∞–µ—Ç –í–°–ï —É—Å–ª—É–≥–∏ –∏–∑ queue_numbers ‚Üí [K01, S01]  ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ departmentKey = "cardio"                               ‚îÇ
‚îÇ  ‚îÇ   ‚îî‚îÄ‚îÄ –ù–∞—Ö–æ–¥–∏—Ç queue_number –ø–æ specialty ‚Üí [K01]          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ departmentKey = "dental"                               ‚îÇ
‚îÇ      ‚îî‚îÄ‚îÄ –ù–∞—Ö–æ–¥–∏—Ç queue_number –ø–æ specialty ‚Üí [S01]          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  filteredAppointments (useMemo)                             ‚îÇ
‚îÇ  ‚îú‚îÄ‚îÄ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏:                            ‚îÇ
‚îÇ  ‚îÇ   services = filterServicesByDepartment(appt, activeTab) ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ "–í—Å–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è":                                       ‚îÇ
‚îÇ      aggregatedPatients.map(p => ({                         ‚îÇ
‚îÇ        ...p,                                                ‚îÇ
‚îÇ        services: filterServicesByDepartment(p, null) ‚Üê ‚ö†Ô∏è   ‚îÇ
‚îÇ      }))                                                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –§—É–Ω–∫—Ü–∏—è toServiceCode

–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (specialty, service_name, queue_tag) –≤ –∫–æ–¥ —É—Å–ª—É–≥–∏:

```javascript
// –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏:
"cardiology"    ‚Üí "K01"
"stomatology"   ‚Üí "S01"
"dermatology"   ‚Üí "D01"
"laboratory"    ‚Üí "L01"
"–∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è"   ‚Üí "K01"  // –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–æ–∂–µ
"K01"           ‚Üí "K01"  // –£–∂–µ –∫–æ–¥ ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
```

### ‚ö†Ô∏è –ß—Ç–æ –ù–ï –¥–µ–ª–∞—Ç—å

1. **–ù–ï –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `appointment.services` –Ω–∞–ø—Ä—è–º—É—é –¥–ª—è QR-–∑–∞–ø–∏—Å–µ–π** ‚Äî –æ–Ω–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å—ã—Ä—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è.
2. **–ù–ï –∑–∞–±—ã–≤–∞—Ç—å –≤—ã–∑—ã–≤–∞—Ç—å `filterServicesByDepartment`** –¥–ª—è –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ –≤ "–í—Å–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è".
3. **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—ã—Ä—ã–µ specialty** ("cardiology", "stomatology") ‚Äî –≤—Å–µ–≥–¥–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–¥—ã.

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–æ–≥–∏–∫–∏ —É–±–µ–¥–∏—Ç–µ—Å—å:
- [ ] –ü–∞—Ü–∏–µ–Ω—Ç —Å 2+ —É—Å–ª—É–≥–∞–º–∏ (QR) –≤ "–í—Å–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è" –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç **–í–°–ï** –∫–æ–¥—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, `K01, S01`)
- [ ] –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ **—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π** –∫–æ–¥
- [ ] –°—ã—Ä—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è **–Ω–∏–≥–¥–µ** –Ω–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è

---

## 9. –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–µ–π

### –ö—Ç–æ –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å?

| –ö—Ç–æ | –ß—Ç–æ –º–æ–∂–µ—Ç –æ—Ç–º–µ–Ω–∏—Ç—å |
|-----|-------------------|
| **–†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä** | –õ—é–±—ã–µ –∑–∞–ø–∏—Å–∏ |
| **–í—Ä–∞—á** | –°–≤–æ–∏ –∑–∞–ø–∏—Å–∏ |
| **–ü–∞—Ü–∏–µ–Ω—Ç** | –°–≤–æ–∏ –∑–∞–ø–∏—Å–∏ (—á–µ—Ä–µ–∑ QR/–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ/Telegram) |
| **–°–∏—Å—Ç–µ–º–∞** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ —Ç–∞–π–º–∞—É—Ç—É ‚Üí `no_show` |

### –û—Ç–º–µ–Ω–∞ –≤—Å–µ–≥–æ –≤–∏–∑–∏—Ç–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—Å–µ `OnlineQueueEntry` ‚Üí `cancelled`
- –í–∏–∑–∏—Ç ‚Üí `cancelled`
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –∞—É–¥–∏—Ç–∞

### –û—Ç–º–µ–Ω–∞ –æ–¥–Ω–æ–π —É—Å–ª—É–≥–∏ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –¢–æ–ª—å–∫–æ —ç—Ç–∞ `OnlineQueueEntry` ‚Üí `cancelled`
- –û—Å—Ç–∞–ª—å–Ω—ã–µ —É—Å–ª—É–≥–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
- –í–∏–∑–∏—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è

**‚ö†Ô∏è –í–ê–ñ–ù–û –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã "–í—Å–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è":**
–í –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ (–≤–∫–ª–∞–¥–∫–∞ "–í—Å–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è") –∫–Ω–æ–ø–∫–∞ "–û—Ç–º–µ–Ω–∞" **—É–¥–∞–ª—è–µ—Ç –í–°–ï —É—Å–ª—É–≥–∏** –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∑–∞ —ç—Ç–æ—Ç –¥–µ–Ω—å (—Ç–∞–∫ –∫–∞–∫ –æ–Ω–∏ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É).
–î–ª—è —É–¥–∞–ª–µ–Ω–∏—è *–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π* —É—Å–ª—É–≥–∏ –Ω—É–∂–Ω–æ –∑–∞–π—Ç–∏ –≤ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–∞—Ä–∞–Ω–¥–∞—à) ‚Üí `AppointmentWizardV2`.

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: `aggregated_ids`

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö (`loadAppointments`) –∑–∞–ø–∏—Å–∏ –¥–µ–¥—É–ø–ª–∏—Ü–∏—Ä—É—é—Ç—Å—è –ø–æ –∫–ª—é—á—É `dedupKey` (patient + date).
–î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Å–µ—Ö ID –æ–±—ä–µ–¥–∏–Ω—è–µ–º—ã—Ö –∑–∞–ø–∏—Å–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–∞—Å—Å–∏–≤ `aggregated_ids`:

```javascript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏:
aggregated_ids: [entryId]  // –Ω–∞–ø—Ä–∏–º–µ—Ä: [407]

// –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏:
existingAppointment.aggregated_ids.push(entryId);  // [407, 408, 409]
```

**–ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:**
1. `loadAppointments` ‚Üí –ø–µ—Ä–≤–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è (–ø–æ `dedupKey`) ‚Üí —Å–æ–±–∏—Ä–∞–µ—Ç `aggregated_ids`
2. `mergeAppointments` ‚Üí –≤—Ç–æ—Ä–∞—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è ‚Üí –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç `aggregated_ids`
3. `aggregatePatientsForAllDepartments` ‚Üí –∞–≥—Ä–µ–≥–∞—Ü–∏—è –¥–ª—è –≤–∫–ª–∞–¥–∫–∏ ‚Üí —Å–æ–±–∏—Ä–∞–µ—Ç `aggregated_ids`
4. `onCancel` ‚Üí –∏—Ç–µ—Ä–∏—Ä—É–µ—Ç –ø–æ `aggregated_ids` –∏ –æ—Ç–º–µ–Ω—è–µ—Ç –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å

---

## 10. –û–ø–ª–∞—Ç–∞ –∏ –æ—á–µ—Ä–µ–¥—å

### –ö–æ–≥–¥–∞ –ø–ª–∞—Ç–∏—Ç—å?

**–ü—Ä–∞–≤–∏–ª–æ:** –û–ø–ª–∞—Ç–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–î–û –≤—Ö–æ–¥–∞ –∫ –≤—Ä–∞—á—É** (–ø–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º).

### –°—Ü–µ–Ω–∞—Ä–∏–∏ –æ–ø–ª–∞—Ç—ã

| –°–∏—Ç—É–∞—Ü–∏—è | –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç |
|----------|----------------|
| **–í—Ä–∞—á –æ—Ç–º–µ–Ω—è–µ—Ç —É—Å–ª—É–≥—É** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç, –∫–∞—Å—Å–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç |
| **–í—Ä–∞—á –¥–æ–±–∞–≤–ª—è–µ—Ç —É—Å–ª—É–≥—É (—É —Å–µ–±—è)** | –û–ø–ª–∞—Ç–∞ –ü–û–°–õ–ï –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤–∏–∑–∏—Ç–∞ |
| **–í—Ä–∞—á –¥–æ–±–∞–≤–ª—è–µ—Ç —É—Å–ª—É–≥—É (–≤ –¥—Ä—É–≥–æ–π –æ—á–µ—Ä–µ–¥–∏)** | –ü–∞—Ü–∏–µ–Ω—Ç –∏–¥—ë—Ç –≤ –∫–∞—Å—Å—É –¥–æ–ø–ª–∞—Ç–∏—Ç—å –î–û |
| **–ó–∞–º–µ–Ω–∞ —É—Å–ª—É–≥–∏ (–¥–æ—Ä–æ–∂–µ)** | –°—Ç–∞—Ä–∞—è –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è, –¥–æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è —Ä–∞–∑–Ω–∏—Ü–∞ |
| **–ó–∞–º–µ–Ω–∞ —É—Å–ª—É–≥–∏ (–¥–µ—à–µ–≤–ª–µ)** | –°–æ–∑–¥–∞—ë—Ç—Å—è –≤–æ–∑–≤—Ä–∞—Ç —Ä–∞–∑–Ω–∏—Ü—ã |

### –ü—Ä–∏–º–µ—Ä: –ó–∞–º–µ–Ω–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –Ω–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—É—é

- –°—Ç–∞—Ä–∞—è —É—Å–ª—É–≥–∞: –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (50,000) ‚Üí `cancelled` (–æ–ø–ª–∞—Ç–∞ –ù–ï –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è)
- –ù–æ–≤–∞—è —É—Å–ª—É–≥–∞: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è (80,000)
- –ö–∞—Å—Å–∞ –≤–∏–¥–∏—Ç: "–î–æ–ø–ª–∞—Ç–∞ 30,000 —Å—É–º"

---

## 11. –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ

### –ë–µ–π–¥–∂–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∑–∞–ø–∏—Å–∏

| –ò—Å—Ç–æ—á–Ω–∏–∫ | –¶–≤–µ—Ç | –¢–µ–∫—Å—Ç |
|----------|------|-------|
| `online` | üü¢ –ó–µ–ª—ë–Ω—ã–π | QR / Online |
| `desk` | üîµ –°–∏–Ω–∏–π | Manual |
| `morning_assignment` | üü° –ñ—ë–ª—Ç—ã–π | Morning |
| `telegram` | üü£ –§–∏–æ–ª–µ—Ç–æ–≤—ã–π | Telegram |

### –¢–∞–±–ª–æ –æ—á–µ—Ä–µ–¥–∏

- ‚úÖ **TV-—ç–∫—Ä–∞–Ω –≤ —Ö–æ–ª–ª–µ** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
- ‚è≥ **Push –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω** ‚Äî –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

---

## 12. –£—Ç—Ä–µ–Ω–Ω–µ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (Morning Assignment)

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

**–ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 06:00:**
1. –°–∏—Å—Ç–µ–º–∞ –±–µ—Ä—ë—Ç –≤—Å–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –≤–∏–∑–∏—Ç—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –∑–∞–ø–∏—Å–∏ –≤ –æ—á–µ—Ä–µ–¥—è—Ö
3. –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ –≤—Ä–∞—á–∞–º
4. –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ—Ç –Ω–æ–º–µ—Ä–∞ (–Ω–∞—á–∏–Ω–∞—è —Å 1)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ó–∞–ø–∏—Å–∞–Ω–Ω—ã–µ –∑–∞—Ä–∞–Ω–µ–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã –ø–æ–ª—É—á–∞—é—Ç `queue_time = 06:00`
- –û–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–≤—ã–µ –≤ –æ—á–µ—Ä–µ–¥–∏
- –ü–∞—Ü–∏–µ–Ω—Ç—ã –∏–∑ QR (07:00‚Äì09:00) –≤—Å—Ç–∞—é—Ç –ø–æ—Å–ª–µ –Ω–∏—Ö

---

## 13. Telegram-–±–æ—Ç

### –ß—Ç–æ —É–º–µ–µ—Ç –±–æ—Ç?

| –§—É–Ω–∫—Ü–∏—è | –°—Ç–∞—Ç—É—Å |
|---------|--------|
| –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—á–µ—Ä–µ–¥–µ–π `/queue` | ‚úÖ |
| –ó–∞–ø–∏—Å—å –Ω–∞ –ø—Ä–∏—ë–º `/book` | ‚úÖ |
| –ú–æ–∏ –∑–∞–ø–∏—Å–∏ `/appointments` | ‚úÖ |
| –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏ `/cancel` | ‚úÖ |
| –ü–µ—Ä–µ–Ω–æ—Å –∑–∞–ø–∏—Å–∏ `/reschedule` | ‚úÖ |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | ‚úÖ |
| –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≤—ã–∑–æ–≤–µ | ‚è≥ –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è |

---

## 14. –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### PWA (Progressive Web App)

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –º–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
- –†–∞–±–æ—Ç–∞–µ—Ç offline
- –ë—ã—Å—Ç—Ä—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–∞–Ω–µ–ª–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä, –≤—Ä–∞—á, –∫–∞—Å—Å–∞)

---

# –ß–ê–°–¢–¨ 2: –¢–ï–•–ù–ò–ß–ï–°–ö–ê–Ø –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø

---

## 1. –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### `DailyQueue` ‚Äî –î–Ω–µ–≤–Ω–∞—è –æ—á–µ—Ä–µ–¥—å

```python
class DailyQueue(Base):
    __tablename__ = "daily_queues"
    
    id: int                     # PK
    day: date                   # –î–∞—Ç–∞ –æ—á–µ—Ä–µ–¥–∏
    specialist_id: int          # FK ‚Üí doctors.id
    queue_tag: str              # ecg, lab, cardiology_common
    active: bool                # –ê–∫—Ç–∏–≤–Ω–∞ –ª–∏ –æ—á–µ—Ä–µ–¥—å
    opened_at: datetime         # –í—Ä–µ–º—è –æ—Ç–∫—Ä—ã—Ç–∏—è –ø—Ä–∏—ë–º–∞
    cabinet_number: str         # –ù–æ–º–µ—Ä –∫–∞–±–∏–Ω–µ—Ç–∞
    online_start_time: str      # "07:00"
    online_end_time: str        # "09:00"
    max_online_entries: int     # –õ–∏–º–∏—Ç (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±–µ–∑ –ª–∏–º–∏—Ç–∞)
```

### `OnlineQueueEntry` ‚Äî –ó–∞–ø–∏—Å—å –≤ –æ—á–µ—Ä–µ–¥–∏

```python
class OnlineQueueEntry(Base):
    __tablename__ = "queue_entries"
    
    id: int                     # PK
    queue_id: int               # FK ‚Üí daily_queues.id
    number: int                 # –ù–æ–º–µ—Ä –≤ –æ—á–µ—Ä–µ–¥–∏ (1..N)
    
    # –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞
    patient_id: int             # FK ‚Üí patients.id (nullable)
    patient_name: str           # –ò–º—è (–µ—Å–ª–∏ –±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏)
    phone: str                  # –¢–µ–ª–µ—Ñ–æ–Ω
    telegram_id: int            # Telegram ID
    
    # –°–≤—è–∑—å —Å –≤–∏–∑–∏—Ç–æ–º
    visit_id: int               # FK ‚Üí visits.id (nullable)
    
    # –£—Å–ª—É–≥–∏
    services: List[Dict]        # JSON —Å —É—Å–ª—É–≥–∞–º–∏
    service_codes: List[str]    # ["K01", "K02"]
    total_amount: int           # –°—É–º–º–∞
    
    # –ò—Å—Ç–æ—á–Ω–∏–∫ –∏ —Å—Ç–∞—Ç—É—Å
    source: str                 # online, desk, telegram, morning_assignment
    status: str                 # waiting, called, in_service, diagnostics, served, incomplete, no_show, cancelled
    
    # –í—Ä–µ–º—è
    queue_time: datetime        # –í—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤ –æ—á–µ—Ä–µ–¥–∏
    created_at: datetime        # –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
```

### `QueueToken` ‚Äî QR-—Ç–æ–∫–µ–Ω

```python
class QueueToken(Base):
    __tablename__ = "queue_tokens"
    
    id: int
    token: str                  # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
    day: date                   # –î–∞—Ç–∞
    specialist_id: int          # FK ‚Üí doctors.id (nullable –¥–ª—è –æ–±—â–µ–≥–æ QR)
    is_clinic_wide: bool        # True = –æ–±—â–∏–π QR –∫–ª–∏–Ω–∏–∫–∏
    expires_at: datetime        # –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è
    active: bool
```

---

## 2. API Endpoints

### –ü—É–±–ª–∏—á–Ω—ã–µ (–±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/api/v1/queue/available-specialists` | –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤—Ä–∞—á–µ–π –¥–ª—è QR |
| GET | `/api/v1/queue/qr-tokens/{token}/info` | –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ QR-—Ç–æ–∫–µ–Ω–µ |
| POST | `/api/v1/queue/join/start` | –ù–∞—á–∞—Ç—å —Å–µ—Å—Å–∏—é –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è |
| POST | `/api/v1/queue/join/complete` | –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é (–æ–¥–∏–Ω–æ—á–Ω–∞—è/–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è) |

### –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ (—Ç—Ä–µ–±—É—é—Ç –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| POST | `/api/v1/queue/qr-tokens/admin/generate-clinic` | –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π QR –∫–ª–∏–Ω–∏–∫–∏ |
| POST | `/api/v1/registrar-integration/queue/entries/batch` | –ú–∞—Å—Å–æ–≤–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π |
| PUT | `/api/v1/queue/online-entry/{id}/status` | –ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏ |
| DELETE | `/api/v1/queue/online-entry/{id}` | –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å |

---

## 3. –°–µ—Ä–≤–∏—Å—ã

### `QueueBusinessService` (queue_service.py)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `create_queue_entry()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
- `get_or_create_daily_queue()` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ/—Å–æ–∑–¥–∞–Ω–∏–µ –¥–Ω–µ–≤–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
- `get_next_queue_number()` ‚Äî —Å–ª–µ–¥—É—é—â–∏–π –Ω–æ–º–µ—Ä
- `check_uniqueness()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ (–ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç `desk`, `morning_assignment`)
- `assign_queue_token()` ‚Äî –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ QR-—Ç–æ–∫–µ–Ω–∞

### `QRQueueService` (qr_queue_service.py)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `generate_qr_token()` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è QR
- `start_join_session()` ‚Äî –Ω–∞—á–∞–ª–æ —Å–µ—Å—Å–∏–∏
- `complete_join_session()` ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (–æ–¥–∏–Ω–æ—á–Ω–∞—è)
- `complete_join_session_multiple()` ‚Äî –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ (–º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è)
- `_check_online_time_restrictions()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

### `MorningAssignmentService` (morning_assignment.py)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã:**
- `run()` ‚Äî –∑–∞–ø—É—Å–∫ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- `_assign_queues_for_visit()` ‚Äî –ø—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è –≤–∏–∑–∏—Ç–∞

---

## 4. Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### –°—Ç—Ä–∞–Ω–∏—Ü—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|------|----------|
| `QueueJoin.jsx` | `/queue/join` | QR-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è |
| `RegistrarPanel.jsx` | `/registrar-panel` | –ü–∞–Ω–µ–ª—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ |
| `ModernQueueManager.jsx` | ‚Äî | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥—å—é |

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `AppointmentWizardV2.jsx` | –ú–∞—Å—Ç–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |
| `EnhancedAppointmentsTable.jsx` | –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π —Å –±–µ–π–¥–∂–∞–º–∏ |

---

## 5. –õ–æ–≥–∏–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤

### –í `check_uniqueness()`:

```python
def check_uniqueness(cls, db, daily_queue, phone, telegram_id, source="online"):
    # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è –¥–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
    if source in ["desk", "morning_assignment"]:
        return None, ""
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
    if phone:
        existing = db.query(OnlineQueueEntry).filter(
            OnlineQueueEntry.queue_id == daily_queue.id,
            OnlineQueueEntry.phone == phone,
            OnlineQueueEntry.status.in_(["waiting", "called"])
        ).first()
        if existing:
            return existing, f"—Ç–µ–ª–µ—Ñ–æ–Ω—É {phone}"
    
    return None, ""
```

### –í `create_queue_entries_batch()`:

```python
# –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –æ–Ω–ª–∞–π–Ω –∑–∞–ø–∏—Å–∏
if existing_queue and request.source == "online":
    existing_entry = db.query(OnlineQueueEntry).filter(...)
    if existing_entry:
        continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ
```

---

## 6. –ú–∏–≥—Ä–∞—Ü–∏–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `queue_time`:

```sql
ALTER TABLE queue_entries ADD COLUMN queue_time DATETIME;
UPDATE queue_entries SET queue_time = created_at WHERE queue_time IS NULL;
CREATE INDEX idx_queue_entries_queue_time ON queue_entries(queue_time);
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ `is_clinic_wide`:

```sql
ALTER TABLE queue_tokens ADD COLUMN is_clinic_wide BOOLEAN DEFAULT 0;
```

---

## 7. –°—Ç–∞—Ç—É—Å—ã ‚Äî –ø–µ—Ä–µ—Ö–æ–¥—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ waiting ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ –≤—Ä–∞—á –≤—ã–∑—ã–≤–∞–µ—Ç
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ called  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ –ø–∞—Ü–∏–µ–Ω—Ç –∑–∞—à—ë–ª      ‚îÇ –Ω–µ –ø—Ä–∏—à—ë–ª
     ‚ñº                    ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ in_service‚îÇ       ‚îÇ no_show  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ –Ω–∞ –æ–±—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ diagnostics ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ –≤–µ—Ä–Ω—É–ª—Å—è
     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ in_service‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ –∑–∞–≤–µ—Ä—à–∏–ª      ‚îÇ –Ω–µ –≤–µ—Ä–Ω—É–ª—Å—è
     ‚ñº               ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ served ‚îÇ     ‚îÇ incomplete ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

–í –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç ‚Üí cancelled
```

---

## 8. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Dev Mode

### –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
DISABLE_QUEUE_TIME_RESTRICTIONS=true
```

### –í –∫–æ–¥–µ:

```python
import os

def _check_online_time_restrictions(self, ...):
    if os.getenv("DISABLE_QUEUE_TIME_RESTRICTIONS") == "true":
        return {"allowed": True, "status": "dev_mode"}
    # –û—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞...
```

---

## 15. –ü–µ—á–∞—Ç—å —Ç–∞–ª–æ–Ω–∞

### –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ç–∞–ª–æ–Ω–∞

–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –ø–∞—Ü–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Ç–∞–ª–æ–Ω —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:

| –ü–æ–ª–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| **–ù–æ–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏** | –ù–∞–ø—Ä–∏–º–µ—Ä: "–ö-003" (–ö–∞—Ä–¥–∏–æ–ª–æ–≥, –Ω–æ–º–µ—Ä 3) |
| **–§–ò–û –ø–∞—Ü–∏–µ–Ω—Ç–∞** | –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á |
| **–í—Ä–∞—á / –ö–∞–±–∏–Ω–µ—Ç** | –ö–∞—Ä–¥–∏–æ–ª–æ–≥ ‚Äî –ö–∞–±. 205 |
| **–î–∞—Ç–∞ / –í—Ä–µ–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** | 15.01.2025 07:30 |
| **QR-–∫–æ–¥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è** | –°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ |

### –§–æ—Ä–º–∞—Ç –ø–µ—á–∞—Ç–∏

- –¢–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä (—á–µ–∫–æ–≤–∞—è –±—É–º–∞–≥–∞ 58–º–º –∏–ª–∏ 80–º–º)
- QR-–∫–æ–¥ –¥–ª—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º
- –ö—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö

---

## 16. SMS/Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

| –¢–∏–ø | SMS | Push | Telegram |
|-----|-----|------|----------|
| –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞–ø–∏—Å–∏ (24—á) | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ | ‚úÖ | ‚úÖ | ‚úÖ |
| –û—Ç–º–µ–Ω–∞ –∑–∞–ø–∏—Å–∏ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏ | ‚Äî | ‚úÖ | ‚úÖ |
| –í—ã–∑–æ–≤ –∫ –≤—Ä–∞—á—É | ‚Äî | ‚úÖ | ‚úÖ |
| –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–æ–≤ | ‚úÖ | ‚úÖ | ‚úÖ |
| –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ | ‚úÖ | ‚úÖ | ‚úÖ |

### SMS –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:
- **Eskiz** (–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω)
- **Play Mobile** (–£–∑–±–µ–∫–∏—Å—Ç–∞–Ω)

### Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- **Firebase Cloud Messaging (FCM)** ‚Äî –¥–ª—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (PWA)
- –°–µ—Ä–≤–∏—Å: `mobile_notifications.py`, `fcm_service.py`

### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å:
- SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤–∫–ª/–≤—ã–∫–ª)
- Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤–∫–ª/–≤—ã–∫–ª)
- Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–≤–∫–ª/–≤—ã–∫–ª)
- –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è, –æ–ø–ª–∞—Ç–∞, —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ)

---

## 17. –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –æ—Ç—á—ë—Ç—ã

### –î–æ—Å—Ç—É–ø–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞

| –û—Ç—á—ë—Ç | –û–ø–∏—Å–∞–Ω–∏–µ | –§–∞–π–ª |
|-------|----------|------|
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏–∑–∏—Ç–æ–≤ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ, —Å—Ç–∞—Ç—É—Å—ã, –ø–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è–º | `analytics.py` |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π | –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è, –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å | `get_queue_statistics()` |
| –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ | –ù–æ–≤—ã–µ/–ø–æ–≤—Ç–æ—Ä–Ω—ã–µ, –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—è | `get_patient_statistics()` |
| –î–æ—Ö–æ–¥—ã | –ü–æ —É—Å–ª—É–≥–∞–º, –≤—Ä–∞—á–∞–º, –æ—Ç–¥–µ–ª–µ–Ω–∏—è–º | `calculate_revenue()` |
| –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è | –†–µ–∞–ª—å–Ω–æ–µ vs –æ–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è | `wait_time_analytics_service.py` |

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤

```python
AnalyticsService.generate_report(
    db=db,
    report_type="comprehensive",  # revenue|visits|patients|services|comprehensive
    start_date=start,
    end_date=end,
    department="cardiology",  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
    format="json"  # json|csv
)
```

### –≠–∫—Å–ø–æ—Ä—Ç

- JSON ‚Äî –¥–ª—è API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- CSV ‚Äî –¥–ª—è Excel/—Ç–∞–±–ª–∏—Ü

---

## 18. –õ—å–≥–æ—Ç–Ω–∏–∫–∏ –∏ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–µ —É—Å–ª—É–≥–∏

### –†–µ–∂–∏–º—ã —Å–∫–∏–¥–æ–∫ (`discount_mode`)

| –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `none` | –ü–æ–ª–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å |
| `repeat` | –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –≤–∏–∑–∏—Ç (—Å–∫–∏–¥–∫–∞) |
| `benefit` | –õ—å–≥–æ—Ç–Ω–∏–∫ (–∏–Ω–≤–∞–ª–∏–¥, –≤–µ—Ç–µ—Ä–∞–Ω –∏ —Ç.–¥.) |
| `all_free` | –ü–æ–ª–Ω–æ—Å—Ç—å—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ (—Ç—Ä–µ–±—É–µ—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è) |

### API –¥–ª—è –ª—å–≥–æ—Ç

| Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|
| `POST /api/v1/discount-benefits/benefits` | –°–æ–∑–¥–∞—Ç—å –ª—å–≥–æ—Ç—É |
| `GET /api/v1/discount-benefits/benefits` | –°–ø–∏—Å–æ–∫ –ª—å–≥–æ—Ç |
| `POST /api/v1/discount-benefits/benefits/assign` | –ù–∞–∑–Ω–∞—á–∏—Ç—å –ª—å–≥–æ—Ç—É –ø–∞—Ü–∏–µ–Ω—Ç—É |
| `POST /api/v1/discount-benefits/benefits/apply` | –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª—å–≥–æ—Ç—É –∫ –≤–∏–∑–∏—Ç—É |

### –ó–∞–ø—Ä–æ—Å –Ω–∞ all_free

1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–º–µ—á–∞–µ—Ç –≤–∏–∑–∏—Ç –∫–∞–∫ `all_free`
2. –°–æ–∑–¥–∞—ë—Ç—Å—è –∑–∞–ø—Ä–æ—Å –Ω–∞ –æ–¥–æ–±—Ä–µ–Ω–∏–µ
3. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ–¥–æ–±—Ä—è–µ—Ç/–æ—Ç–∫–ª–æ–Ω—è–µ—Ç
4. –ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ ‚Üí –≤–∏–∑–∏—Ç –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π

### –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏

- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∑–∞ –æ–ø–ª–∞—Ç—ã
- –°–ø–∏—Å–∞–Ω–∏–µ –±–∞–ª–ª–æ–≤ –∫–∞–∫ —Å–∫–∏–¥–∫–∞
- API: `/api/v1/discount-benefits/loyalty-programs`

---

## 19. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–µ–π

### –û—á–µ—Ä–µ–¥—å –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏

- Queue tag: `lab`, `laboratory`
- –û—Ç–¥–µ–ª—å–Ω–∞—è –æ—á–µ—Ä–µ–¥—å —Å–æ —Å–≤–æ–∏–º–∏ –Ω–æ–º–µ—Ä–∞–º–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π –æ—á–µ—Ä–µ–¥–µ–π

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

–ö–æ–≥–¥–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ—Ç–æ–≤—ã:
1. –°–∏—Å—Ç–µ–º–∞ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è SMS (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ)
3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Telegram
4. –ü–∞—Ü–∏–µ–Ω—Ç –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —á–µ—Ä–µ–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

- –ö–Ω–æ–ø–∫–∞ "üî¨ –í –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—é" –≤ –±–æ—Ç–µ
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ WebApp

---

## 20. –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (Edge Cases)

### 20.1 –û–ø–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ (`no_show`)

**–¢–∞–π–º–∞—É—Ç:**
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤—Ä–∞—á–æ–º **–≤—Ä—É—á–Ω—É—é**.
- –ï—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –Ω–µ—Ç, –≤—Ä–∞—á –≤—ã–∑—ã–≤–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–≥–æ (—Ç–µ–∫—É—â–∏–π –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `no_show`).

**–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–ø–æ–∑–¥–∞–≤—à–µ–≥–æ:**
- –ï—Å–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç –ø—Ä–∏—à—ë–ª –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –µ–≥–æ –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏:
- **–î–µ–π—Å—Ç–≤–∏–µ:** –í—Ä–∞—á –∏–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∑–∞–ø–∏—Å—å.
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ü–∞—Ü–∏–µ–Ω—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è **—Å–ª–µ–¥—É—é—â–∏–º** (–≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç), —á—Ç–æ–±—ã –∑–∞–π—Ç–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞.

### 20.2 –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –æ–∂–∏–¥–∞–Ω–∏—è

**–ú–µ—Ç–æ–¥:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–¥—Ö–æ–¥ **"–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ª—é–¥–µ–π"**.
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: "–ü–µ—Ä–µ–¥ –≤–∞–º–∏ –≤ –æ—á–µ—Ä–µ–¥–∏ **3 —á–µ–ª–æ–≤–µ–∫–∞**".
- –†–∞—Å—á–µ—Ç –ø–æ –º–∏–Ω—É—Ç–∞–º –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑-–∑–∞ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç–∏ –∂–∏–≤–æ–π –æ—á–µ—Ä–µ–¥–∏.

### 20.3 –û–∫–æ–Ω—á–∞–Ω–∏–µ —Å–º–µ–Ω—ã / –§–æ—Ä—Å-–º–∞–∂–æ—Ä

**–°–∏—Ç—É–∞—Ü–∏—è:** –°–º–µ–Ω–∞ –≤—Ä–∞—á–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –∏–ª–∏ –µ–º—É —Å—Ä–æ—á–Ω–æ –Ω—É–∂–Ω–æ —É–π—Ç–∏, –Ω–æ –≤ –æ—á–µ—Ä–µ–¥–∏ –æ—Å—Ç–∞–ª–∏—Å—å –ª—é–¥–∏.

**–í—ã–±–æ—Ä –ø–∞—Ü–∏–µ–Ω—Ç–∞:**
1. **–ü–µ—Ä–µ–Ω–æ—Å –Ω–∞ –∑–∞–≤—Ç—Ä–∞:** –ü–∞—Ü–∏–µ–Ω—Ç –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è –Ω–∞ –∑–∞–≤—Ç—Ä–∞—à–Ω–µ–µ —É—Ç—Ä–æ –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è **–ø–µ—Ä–≤—ã–º** –≤ –æ—á–µ—Ä–µ–¥–∏ (–ø–æ—Å–ª–µ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è).
2. **–û—Ç–º–µ–Ω–∞ —Å –≤–æ–∑–≤—Ä–∞—Ç–æ–º:** –ü–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤.

### 20.4 –í–æ–∑–≤—Ä–∞—Ç –ø—Ä–∏ –æ–Ω–ª–∞–π–Ω-–æ—Ç–º–µ–Ω–µ

**–°–∏—Ç—É–∞—Ü–∏—è:** –ü–∞—Ü–∏–µ–Ω—Ç –æ–ø–ª–∞—Ç–∏–ª –æ–Ω–ª–∞–π–Ω –∏ –æ—Ç–º–µ–Ω—è–µ—Ç —á–µ—Ä–µ–∑ Telegram/–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ.

**–í—ã–±–æ—Ä –ø–∞—Ü–∏–µ–Ω—Ç–∞:**
1. **–†—É—á–Ω–æ–π –≤–æ–∑–≤—Ä–∞—Ç:** –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞—è–≤–∫–∞, –º–µ–Ω–µ–¥–∂–µ—Ä —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –¥–µ–Ω—å–≥–∏ –Ω–∞ –∫–∞—Ä—Ç—É.
2. **–î–µ–ø–æ–∑–∏—Ç:** –î–µ–Ω—å–≥–∏ –æ—Å—Ç–∞—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –≤ –∫–ª–∏–Ω–∏–∫–µ –¥–ª—è –æ–ø–ª–∞—Ç—ã –±—É–¥—É—â–∏—Ö –≤–∏–∑–∏—Ç–æ–≤.

### 20.5 –¢–∏–ø –æ—á–µ—Ä–µ–¥–∏

- **–°—Ç—Ä–æ–≥–æ "–ñ–∏–≤–∞—è –æ—á–µ—Ä–µ–¥—å"**.
- –ù–∏–∫–∞–∫–∏—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–Ω–∞ 10:30").
- –í—Å–µ –ø–∞—Ü–∏–µ–Ω—Ç—ã –∏–¥—É—Ç –≤ –ø–æ—Ä—è–¥–∫–µ `queue_time` –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è.

---


---

## 21. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–µ–π QR-–∑–∞–ø–∏—Å–µ–π

–í–≤–µ–¥–µ–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ª–æ–≥–∏–∫–∞ "–ï–¥–∏–Ω–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å—Ç–∏–Ω—ã" (SSOT) –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è QR-–∑–∞–ø–∏—Å–µ–π, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤.

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1.  **–ó–∞–ø—Ä–µ—Ç —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏**
    *   –ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π QR-–∑–∞–ø–∏—Å–∏ (`record_type='online_queue'`, `source='online'`) **–ó–ê–ü–†–ï–©–ï–ù–û** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å endpoint —Å–æ–∑–¥–∞–Ω–∏—è (`POST /registrar/cart`).
    *   –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –æ–±–Ω–æ–≤–ª—è—Ç—å—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏.

2.  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Full Update Endpoint**
    *   –î–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π endpoint:
        `PUT /api/v1/qr-queue/online-entry/{entry_id}/full-update`
    *   –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –∞—Ç–æ–º–∞—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞, —É—Å–ª—É–≥–∏, —Ç–∏–ø –≤–∏–∑–∏—Ç–∞ –∏ —Å–∫–∏–¥–∫–∏, —Å–æ—Ö—Ä–∞–Ω—è—è `queue_time` –∏ –ø–æ–∑–∏—Ü–∏—é –≤ –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã—Ö —É—Å–ª—É–≥.

3.  **–õ–æ–≥–∏–∫–∞ Frontend (AppointmentWizardV2)**
    *   –ú–∞—Å—Ç–µ—Ä —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç QR-–∑–∞–ø–∏—Å—å.
    *   –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é `updateOnlineQueueEntry`.
    *   –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞—è –≤—ã–∑–æ–≤ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏ —Å–æ–∑–¥–∞–Ω–∏—è.

4.  **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤ UI (RegistrarPanel)**
    *   –ó–∞–ø–∏—Å–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –≤–∏–∑—É–∞–ª—å–Ω–æ –ø–æ –∫–ª—é—á—É: `online_{pid|phone|fio}_{date}`.
    *   –≠—Ç–æ —Å–∫—Ä—ã–≤–∞–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (–∫–æ–≥–¥–∞ –æ–¥–Ω–∞ –∑–∞–ø–∏—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–±–∏—Ç–∞ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ `OnlineQueueEntry` –≤ —Å–ª—É—á–∞–µ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏, —Ö–æ—Ç—è —Å–µ–π—á–∞—Å –º—ã —Å—Ç—Ä–µ–º–∏–º—Å—è –∫ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏).

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (SSOT)

*   **`service_id`**: –Ø–≤–ª—è–µ—Ç—Å—è –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º —É—Å–ª—É–≥–∏.
*   **`updateOnlineQueueEntry`**: Frontend-—Ñ—É–Ω–∫—Ü–∏—è –≤ `api/queue.js`, –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `PUT`.

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 2.2 (–§–∏–Ω–∞–ª—å–Ω–∞—è + SSOT QR Fix)
**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2025-12-14
**–°—Ç–∞—Ç—É—Å:** –í–Ω–µ–¥—Ä–µ–Ω–æ

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

### ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–∞–±–æ—Ç—É)

- [x] **–ó–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥ QR-–∑–∞–ø–∏—Å–µ–π –≤ –º–∞—Å—Ç–µ—Ä–µ** ‚Äî –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ (—Å–º. —Ä–∞–∑–¥–µ–ª 8.8)
- [x] **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è API** ‚Äî `service_details` –≤ –æ—Ç–≤–µ—Ç–µ `/api/v1/registrar/queue/all`
- [x] **SSOT –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –¥—É–±–ª–µ–π** ‚Äî `PUT /full-update` –∏ frontend –ª–æ–≥–∏–∫–∞
- [x] **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É—Å–ª—É–≥ "–í—Å–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è"** ‚Äî –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤—ã–≤–æ–¥ –≤—Å–µ—Ö –∫–æ–¥–æ–≤ —É—Å–ª—É–≥ –¥–ª—è –º—É–ª—å—Ç–∏-QR –∑–∞–ø–∏—Å–µ–π

### üîß –ù—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å

- [ ] –ü–µ—á–∞—Ç—å —Ç–∞–ª–æ–Ω–∞ (—Ç–µ—Ä–º–æ–ø—Ä–∏–Ω—Ç–µ—Ä)
- [x] Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
    - [x] "–í–∞—à–∞ –ø–æ–∑–∏—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏: 5" ‚Äî `POST /queue/position/notify/position`
    - [x] "–í–∞—Å –≤—ã–∑—ã–≤–∞—é—Ç!" ‚Äî `POST /queue/position/notify/call`
- [ ] –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤—Ä–∞—á–∞:
    - [ ] –ö–Ω–æ–ø–∫–∞ "–°–ª–µ–¥—É—é—â–∏–π" (—É—Å—Ç–∞–Ω–æ–≤–∫–∞ no_show –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É)
    - [x] –ö–Ω–æ–ø–∫–∞ "–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥–∏" (API: `POST /queue/entry/{id}/restore-next`)
    - [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞ —É—Å–ª—É–≥ (UI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)
- [x] Dev Mode (env: `DISABLE_QUEUE_TIME_RESTRICTIONS=true`)
- [x] –°—Ç–∞—Ç—É—Å `incomplete` —Å —Ä—É—á–Ω—ã–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏ –ø—Ä–∏—á–∏–Ω–æ–π (API: `POST /queue/entry/{id}/incomplete`)
- [x] –°—Ç–∞—Ç—É—Å `diagnostics` —Å —Ç–∞–π–º–µ—Ä–æ–º (API: `POST /queue/entry/{id}/diagnostics`)
- [x] **–û–ø–æ–∑–¥–∞–≤—à–∏–µ:** –õ–æ–≥–∏–∫–∞ –≤—Å—Ç–∞–≤–∫–∏ "—Å–ª–µ–¥—É—é—â–∏–º" –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ (`priority=1`)
- [x] **–§–æ—Ä—Å-–º–∞–∂–æ—Ä:** –ú–µ—Ö–∞–Ω–∏–∑–º –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–µ—Ä–µ–Ω–æ—Å–∞ –æ—á–µ—Ä–µ–¥–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞ (–ø–µ—Ä–≤—ã–º–∏)
    - API: `POST /force-majeure/transfer`
    - API: `POST /force-majeure/cancel-with-refund`
- [x] **–û–Ω–ª–∞–π–Ω-–≤–æ–∑–≤—Ä–∞—Ç:** –°–∏—Å—Ç–µ–º–∞ –∑–∞—è–≤–æ–∫ –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç –∏ –±–∞–ª–∞–Ω—Å –¥–µ–ø–æ–∑–∏—Ç–æ–≤
    - API: `/force-majeure/refund-requests/*`
    - API: `/force-majeure/deposits/*`
    - –ú–æ–¥–µ–ª–∏: `RefundRequest`, `PatientDeposit`, `DepositTransaction`

### ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ä–∞–±–æ—Ç–∞–Ω–æ

- [x] –í—Å–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–∑–∞–ø–∏—Å—å, –æ—á–µ—Ä–µ–¥—å, —Å—Ç–∞—Ç—É—Å—ã)
- [x] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [x] –û–ø–ª–∞—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—Ç—ã
- [x] –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–æ–ø–æ–∑–¥–∞–Ω–∏—è, —Ñ–æ—Ä—Å-–º–∞–∂–æ—Ä)
- [x] `service_details` API –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–¥—É–±–ª–∏–∫–∞—Ç—ã QR-–∑–∞–ø–∏—Å–µ–π)
- [x] –ù–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –≤ –º–æ–¥–µ–ª–∏: `in_service`, `diagnostics`, `incomplete`, `cancelled`
- [x] –ü–æ–ª–µ `priority` –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
- [x] FCM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –ø–æ–∑–∏—Ü–∏–∏ –≤ –æ—á–µ—Ä–µ–¥–∏
- [x] **SSOT –¥–ª—è Service Code Mappings** ‚Äî —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π `serviceCodeResolver.js`
- [x] **Batch API** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∑–∞–ø–∏—Å—è–º–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞ (`/registrar/batch/*`)
- [x] **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á—ë—Ç `queue_length`** ‚Äî —Ç–æ–ª—å–∫–æ `OnlineQueueEntry`
- [x] **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤** ‚Äî –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ ID –∑–∞–ø–∏—Å–∏
- [x] **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–¥–æ–≤ —É—Å–ª—É–≥** ‚Äî K11/L02 –≤–º–µ—Å—Ç–æ K01/L01 fallback

---

## üìÖ Changelog

### 2024-12-18 ‚Äî –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–æ–¥–æ–≤ —É—Å–ª—É–≥

| –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `filterServicesByDepartment()` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `appointment.services` –∏–∑ API –≤–º–µ—Å—Ç–æ fallback |
| `isInDepartment()` | ECG (K10) –æ—Ç–¥–µ–ª—ë–Ω –æ—Ç Cardiology (K01, K11) |
| –ú–∞–ø–ø–∏–Ω–≥ –≤–∫–ª–∞–¥–æ–∫ | –î–æ–±–∞–≤–ª–µ–Ω—ã D_PROC –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä, S10 –¥–ª—è —Å—Ç–æ–º–∞—Ç–æ–ª–æ–≥–∏–∏ |
| –ê–≥—Ä–µ–≥–∞—Ü–∏—è | `aggregatePatientsForAllDepartments` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–¥—ã |

### 2024-12-17 ‚Äî –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ SSOT

| –ò–∑–º–µ–Ω–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `serviceCodeResolver.js` | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π SSOT –¥–ª—è frontend-–º–∞–ø–ø–∏–Ω–≥–æ–≤ |
| `normalizeServicesFromInitialData()` | –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è 5 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ —É—Å–ª—É–≥ –≤ –æ–¥–∏–Ω |
| `batch_patient_service.py` | Backend-—Å–µ—Ä–≤–∏—Å –¥–ª—è batch-–æ–ø–µ—Ä–∞—Ü–∏–π |
| `registrar_batch.py` | API endpoints: GET/PATCH/DELETE |
| `registrarBatch.js` | Frontend API –∫–ª–∏–µ–Ω—Ç |
| `qr_queue_service.py` | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ä–∞—Å—á—ë—Ç –¥–ª–∏–Ω—ã –æ—á–µ—Ä–µ–¥–∏ |
| `RegistrarPanel.jsx` | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ |
| `visit_confirmation.py` | –î–æ–±–∞–≤–ª–µ–Ω –∞—É–¥–∏—Ç source_ip/user_agent |

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2024-12-18*
