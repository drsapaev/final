# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π

**–î–∞—Ç–∞**: 2025-10-01  
**–í–µ—Ä—Å–∏—è**: 1.0

---

## üìã –û–±–∑–æ—Ä –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 1Ô∏è‚É£ **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤ –ø–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è–º**

**–ü—Ä–æ–±–ª–µ–º–∞**: –û–¥–∏–Ω –ø–∞—Ü–∏–µ–Ω—Ç —Å —É—Å–ª—É–≥–∞–º–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, K01 + L01) —Å–æ–∑–¥–∞–≤–∞–ª –æ–¥–∏–Ω –≤–∏–∑–∏—Ç —Å department="cardiology", —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ —É—Å–ª—É–≥–∏.

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω–∞ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤ `groupCartItemsByVisit()` –≤ `AppointmentWizardV2.jsx`:

```javascript
// –ë–´–õ–û:
const key = `${item.doctor_id || 'no_doctor'}_${item.visit_date}_${item.visit_time || 'no_time'}`;

// –°–¢–ê–õ–û:
const department = getDepartmentByService(item.service_id);
const key = `${department}_${item.doctor_id || 'no_doctor'}_${item.visit_date}_${item.visit_time || 'no_time'}`;
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°–æ–∑–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–µ –≤–∏–∑–∏—Ç—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è.

---

### 2Ô∏è‚É£ **–ù–µ–∑–∞–≤–∏—Å–∏–º–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è –æ—á–µ—Ä–µ–¥–µ–π**

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù—É–º–µ—Ä–∞—Ü–∏—è –±—ã–ª–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π (—á–µ—Ä–µ–∑ `enumerate`), –Ω–æ –≤–∏–∑–∏—Ç—ã –Ω–µ —Ä–∞–∑–¥–µ–ª—è–ª–∏—Å—å –ø–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è–º (—Å–º. –ø.1).

**–†–µ—à–µ–Ω–∏–µ**: –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏, –∫–∞–∂–¥–æ–µ –æ—Ç–¥–µ–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∏–ª–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—É—é –Ω—É–º–µ—Ä–∞—Ü–∏—é.

**–ü—Ä–∏–º–µ—Ä**:
- –ü–∞—Ü–∏–µ–Ω—Ç —Å —É—Å–ª—É–≥–∞–º–∏ K01 + L01:
  - –í –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏–∏: —Å–≤–æ–π –Ω–æ–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Ññ3)
  - –í –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏: —Å–≤–æ–π –Ω–æ–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, ‚Ññ1)

---

### 3Ô∏è‚É£ **–°—Ç–∞—Ç—É—Å –≤–∏–∑–∏—Ç–æ–≤ –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**

**–ü—Ä–æ–±–ª–µ–º–∞**: –í–∏–∑–∏—Ç—ã –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `pending_confirmation` –∏–∑-–∑–∞ —Ñ–∏—á–∞-—Ñ–ª–∞–≥–∞ `confirmation_before_queue`, –∏ –Ω–µ –ø–æ–ø–∞–¥–∞–ª–∏ –≤ –æ—á–µ—Ä–µ–¥—å.

**–†–µ—à–µ–Ω–∏–µ**: –ò–∑–º–µ–Ω–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `registrar_wizard.py`:

```python
# –ë–´–õ–û:
confirmation_required = is_feature_enabled(db, "confirmation_before_queue", default=True)
if confirmation_required and cart_data.discount_mode != "all_free":
    visit_status = "pending_confirmation"
else:
    visit_status = "confirmed"

# –°–¢–ê–õ–û:
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤—Å–µ–≥–¥–∞ —Å–æ–∑–¥–∞—ë—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏
visit_status = "confirmed"
confirmed_at = datetime.utcnow()
confirmed_by = f"registrar_{current_user.id}"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í–∏–∑–∏—Ç—ã –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–∞—é—Ç –≤ –æ—á–µ—Ä–µ–¥—å.

---

### 4Ô∏è‚É£ **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**

**–ü—Ä–æ–±–ª–µ–º–∞ 1**: –ü–æ–ª–µ `created_at` –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–æ—Å—å –Ω–∞ –≤–µ—Ä—Ö–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å –æ–±—ä–µ–∫—Ç–∞ appointment –≤ `RegistrarPanel.jsx`.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `created_at` –≤–æ –≤—Å–µ –º–µ—Å—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ appointments:

```javascript
const appointment = {
  id: entry.id,
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è ...
  created_at: entry.created_at,  // ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ
  queue_numbers: [{
    // ...
    created_at: entry.created_at
  }]
};
```

**–ü—Ä–æ–±–ª–µ–º–∞ 2**: Backend –æ—Ç–ø—Ä–∞–≤–ª—è–ª –≤—Ä–µ–º—è –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è timezone, JavaScript –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–ª –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω —Å—É—Ñ—Ñ–∏–∫—Å 'Z' –∫ ISO —Å—Ç—Ä–æ–∫–µ –≤ `registrar_integration.py`:

```python
# –ë–´–õ–û:
"created_at": entry_wrapper["created_at"].isoformat() if entry_wrapper["created_at"] else None

# –°–¢–ê–õ–û:
"created_at": entry_wrapper["created_at"].isoformat() + "Z" if entry_wrapper["created_at"] else None
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –§—Ä–æ–Ω—Ç–µ–Ω–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç UTC –≤—Ä–µ–º—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–µ (+5 —á–∞—Å–æ–≤ –¥–ª—è –£–∑–±–µ–∫–∏—Å—Ç–∞–Ω–∞).

---

### 5Ô∏è‚É£ **–ú–∏–∫—Ä–æ–∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≤–∏–∑–∏—Ç–∞–º–∏**

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ –≤–∏–∑–∏—Ç—ã –æ–¥–Ω–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º `created_at`, —á—Ç–æ –º–æ–≥–ª–æ –≤—ã–∑–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π.

**–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–∏–∫—Ä–æ–∑–∞–¥–µ—Ä–∂–∫–∞ –≤ `registrar_wizard.py`:

```python
from time import sleep

for idx, visit_req in enumerate(cart_data.visits):
    if idx > 0:
        sleep(0.001)  # 1 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞ –∑–∞–¥–µ—Ä–∂–∫–∏
    
    # –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–∞...
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ö–∞–∂–¥—ã–π –≤–∏–∑–∏—Ç –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è.

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —Å —É—Å–ª—É–≥–∞–º–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π

1. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –Ω–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞ —Å —É—Å–ª—É–≥–∞–º–∏ K01 (–∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è) + L01 (–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è)
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è**:
   - 2 –≤–∏–∑–∏—Ç–∞ –≤ –ë–î (–æ–¥–∏–Ω –¥–ª—è –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∏–∏, –æ–¥–∏–Ω –¥–ª—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏)
   - –í –≤–∫–ª–∞–¥–∫–µ "–ö–∞—Ä–¥–∏–æ–ª–æ–≥–∏—è": –ø–∞—Ü–∏–µ–Ω—Ç —Å –Ω–æ–º–µ—Ä–æ–º N
   - –í –≤–∫–ª–∞–¥–∫–µ "–õ–∞–±–æ—Ä–∞—Ç–æ—Ä–∏—è": —Ç–æ—Ç –∂–µ –ø–∞—Ü–∏–µ–Ω—Ç —Å –Ω–æ–º–µ—Ä–æ–º M (–Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –æ—Ç N)

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏

1. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è**: –í —Å—Ç–æ–ª–±—Ü–µ "–î–∞—Ç–∞" –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è (UTC+5)

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –û—á–µ—Ä–µ–¥—å –Ω–∞ —Å–µ–≥–æ–¥–Ω—è

1. –°–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π —á–µ—Ä–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
2. **–û–∂–∏–¥–∞–µ—Ç—Å—è**: –í—Å–µ –∑–∞–ø–∏—Å–∏ —Å—Ä–∞–∑—É –≤–∏–¥–Ω—ã –≤ –æ—á–µ—Ä–µ–¥–∏ (–±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)

---

## üìù –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### Timezone

- **Backend —Ö—Ä–∞–Ω–∏—Ç**: UTC –≤—Ä–µ–º—è (–±–µ–∑ timezone info)
- **Backend –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç**: ISO —Å—Ç—Ä–æ–∫—É —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º 'Z' (–Ω–∞–ø—Ä–∏–º–µ—Ä, `2025-10-01T02:55:09.203953Z`)
- **Frontend –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç**: –õ–æ–∫–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è (JavaScript –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç)

### –°—Ç–∞—Ç—É—Å—ã –≤–∏–∑–∏—Ç–æ–≤

- `pending_confirmation`: –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (–¥–ª—è –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–µ–π)
- `confirmed`: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω (–∑–∞–ø–∏—Å–∏ –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏)
- `open`: –û—Ç–∫—Ä—ã—Ç –¥–ª—è –ø—Ä–∏—ë–º–∞ (–ø–æ—Å–ª–µ –ø—Ä–∏—Å–≤–æ–µ–Ω–∏—è –Ω–æ–º–µ—Ä–∞ –æ—á–µ—Ä–µ–¥–∏)

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤–∏–∑–∏—Ç–æ–≤

–í–∏–∑–∏—Ç—ã –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ –∫–ª—é—á—É:
```javascript
`${department}_${doctor_id}_${visit_date}_${visit_time}`
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –æ–¥–∏–Ω –ø–∞—Ü–∏–µ–Ω—Ç —Å —É—Å–ª—É–≥–∞–º–∏ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –æ—Ç–¥–µ–ª–µ–Ω–∏–π —Å–æ–∑–¥–∞—Å—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∏–∑–∏—Ç–æ–≤.

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**Backend:**
- `backend/app/api/v1/endpoints/registrar_wizard.py` - —Å–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑–∏—Ç–æ–≤
- `backend/app/api/v1/endpoints/registrar_integration.py` - –ø–æ–ª—É—á–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π

**Frontend:**
- `frontend/src/components/wizard/AppointmentWizardV2.jsx` - –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤–∏–∑–∏—Ç–æ–≤
- `frontend/src/pages/RegistrarPanel.jsx` - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—á–µ—Ä–µ–¥–µ–π
- `frontend/src/components/tables/EnhancedAppointmentsTable.jsx` - —Ç–∞–±–ª–∏—Ü–∞ —Å –≤—Ä–µ–º–µ–Ω–µ–º

---

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] –í–∏–∑–∏—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ department
- [ ] –ù—É–º–µ—Ä–∞—Ü–∏—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ—Ç–¥–µ–ª–µ–Ω–∏—è
- [ ] –í—Ä–µ–º—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º 'Z'
- [ ] –ü–æ–ª–µ `created_at` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ appointment
- [ ] –í–∏–∑–∏—Ç—ã –æ—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–º–µ—é—Ç status='confirmed'
- [ ] –ú–∏–∫—Ä–æ–∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –≤–∏–∑–∏—Ç–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

**–ê–≤—Ç–æ—Ä**: AI Agent  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞**: 1.0

