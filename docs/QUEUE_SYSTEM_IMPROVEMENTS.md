# üìã –£–ª—É—á—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π - –û—Ç—á–µ—Ç

## üéØ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö** ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** –≠–Ω–¥–ø–æ–∏–Ω—Ç `/registrar/queues/today` —á–∏—Ç–∞–ª —Ç–æ–ª—å–∫–æ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `Visit`, –∞ –º–∞—Å—Ç–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–≤–∞–ª –∑–∞–ø–∏—Å–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `Appointment`.

**–†–µ—à–µ–Ω–∏–µ:**
- –≠–Ω–¥–ø–æ–∏–Ω—Ç —Ç–µ–ø–µ—Ä—å —á–∏—Ç–∞–µ—Ç –∏–∑ **–æ–±–µ–∏—Ö —Ç–∞–±–ª–∏—Ü**: `Visit` (–Ω–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞) –∏ `Appointment` (—Å—Ç–∞—Ä–∞—è —Å–∏—Å—Ç–µ–º–∞)
- –ó–∞–ø–∏—Å–∏ –æ–±—ä–µ–¥–∏–Ω—è—é—Ç—Å—è –∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è/–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –û–±–µ—Å–ø–µ—á–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏

```python
# backend/app/api/v1/endpoints/registrar_integration.py
visits = db.query(Visit).filter(Visit.visit_date == today).all()
appointments = db.query(Appointment).filter(Appointment.appointment_date == today).all()
```

---

### 2. **–û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ—Ç–≤–µ—Ç–µ API** ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** –≠–Ω–¥–ø–æ–∏–Ω—Ç –≤–æ–∑–≤—Ä–∞—â–∞–ª —Ç–æ–ª—å–∫–æ –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–∏–º—è, —Ç–µ–ª–µ—Ñ–æ–Ω), –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏:
- –ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞
- –ê–¥—Ä–µ—Å
- –°–ø–∏—Å–æ–∫ —É—Å–ª—É–≥
- –°—Ç–æ–∏–º–æ—Å—Ç—å

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `Patient`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ —É—Å–ª—É–≥ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `VisitService`
- –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –æ–±—â–µ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —É—Å–ª—É–≥
- –ú–∞–ø–ø–∏–Ω–≥ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏

```python
# –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –æ—Ç–≤–µ—Ç–µ:
{
    "patient_birth_year": 1985,
    "address": "—É–ª. –ù–∞–≤–æ–∏, –¥. 15",
    "services": ["–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∞", "–≠–ö–ì"],
    "service_codes": ["CARD-CONS", "ECG"],
    "cost": 50000,
    "payment_status": "paid"
}
```

---

### 3. **–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤–æ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ** ‚úÖ
**–ü—Ä–æ–±–ª–µ–º–∞:** –§—Ä–æ–Ω—Ç–µ–Ω–¥ —Å–æ–∑–¥–∞–≤–∞–ª –æ–±—ä–µ–∫—Ç—ã —Å –ø—É—Å—Ç—ã–º–∏ –ø–æ–ª—è–º–∏ (`services: []`, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `patient_birth_year`, `address`, `cost`).

**–†–µ—à–µ–Ω–∏–µ:**
- –û–±–Ω–æ–≤–ª–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö –≤ `RegistrarPanel.jsx`
- –í—Å–µ –ø–æ–ª—è —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∏–∑ –æ—Ç–≤–µ—Ç–∞ API
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–æ–ª–µ–π –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã

```javascript
// frontend/src/pages/RegistrarPanel.jsx
const appointment = {
    patient_birth_year: entry.patient_birth_year,
    address: entry.address,
    services: entry.services || [],
    cost: entry.cost || 0,
    payment_status: entry.payment_status || 'pending'
};
```

---

### 4. **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π** ‚úÖ
**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- –ó–∞–ø–∏—Å–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—è–º (`cardiology`, `dermatology`, –∏ —Ç.–¥.)
- –í–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø–∏—Å–∏ —Å–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- –ù–æ–º–µ—Ä–∞ –≤ –æ—á–µ—Ä–µ–¥–∏ –ø—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è –ø–æ –ø–æ—Ä—è–¥–∫—É (1, 2, 3...)

```python
# –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
entries_list.sort(key=lambda e: e["created_at"])

# –ü—Ä–∏—Å–≤–æ–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤
for idx, entry in enumerate(entries_list, 1):
    entries.append({"number": idx, ...})
```

---

### 5. **–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∑–∞–ø–∏—Å–∏** ‚úÖ
**–¢–∏–ø—ã –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:**
- `online` - –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ Telegram/PWA
- `confirmation` - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
- `desk` - —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–∞ –º–µ—Å—Ç–µ

```python
if visit.confirmed_by:
    if "telegram" in visit.confirmed_by.lower():
        source = "online"
    elif "registrar" in visit.confirmed_by.lower():
        source = "confirmation"
```

---

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞:
```json
{
  "queues": [
    {
      "queue_id": 1,
      "specialist_id": 7,
      "specialist_name": "–î–æ–∫—Ç–æ—Ä –ö–∞—Ä–¥–∏–æ–ª–æ–≥",
      "specialty": "cardiology",
      "cabinet": "101",
      "entries": [
        {
          "id": 56,
          "number": 1,
          "patient_id": 1,
          "patient_name": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á",
          "patient_birth_year": 1985,
          "phone": "+998901234567",
          "address": "—É–ª. –ù–∞–≤–æ–∏, –¥. 15",
          "services": ["–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –∫–∞—Ä–¥–∏–æ–ª–æ–≥–∞"],
          "service_codes": ["CARD-CONS"],
          "cost": 50000,
          "payment_status": "paid",
          "source": "online",
          "status": "waiting",
          "created_at": "2025-09-30T10:00:00",
          "visit_time": "10:00",
          "discount_mode": "paid"
        }
      ],
      "stats": {
        "total": 4,
        "waiting": 3,
        "called": 1,
        "served": 0,
        "online_entries": 2
      }
    }
  ],
  "total_queues": 1,
  "date": "2025-09-30"
}
```

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã

### –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏:
1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
2. –ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `Appointment` –∏–ª–∏ `Visit`
3. –≠–Ω–¥–ø–æ–∏–Ω—Ç `/registrar/queues/today` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å
4. –ó–∞–ø–∏—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ —Å –ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

### –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –ø–∞–Ω–µ–ª–∏:
1. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
2. –î–∞–Ω–Ω—ã–µ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—è–º (–≤–∫–ª–∞–¥–∫–∏)
3. –í —Ç–∞–±–ª–∏—Ü–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –≤—Å–µ –ø–æ–ª—è:
   - –ù–æ–º–µ—Ä –≤ –æ—á–µ—Ä–µ–¥–∏
   - –§–ò–û –ø–∞—Ü–∏–µ–Ω—Ç–∞
   - –ì–æ–¥ —Ä–æ–∂–¥–µ–Ω–∏—è
   - –¢–µ–ª–µ—Ñ–æ–Ω
   - –ê–¥—Ä–µ—Å
   - –£—Å–ª—É–≥–∏
   - –°—Ç–æ–∏–º–æ—Å—Ç—å
   - –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 1. **–£—Å–ª—É–≥–∏ –≤ Appointment**
–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ —Ö—Ä–∞–Ω—è—Ç—Å—è —É—Å–ª—É–≥–∏ –≤ –º–æ–¥–µ–ª–∏ `Appointment`. –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è fallback:
```python
if hasattr(appointment, 'services'):
    services = appointment.services if isinstance(appointment.services, list) else []
```

### 2. **–í—Ä–µ–º—è –≤—ã–∑–æ–≤–∞ (called_at)**
–ü–æ–ª–µ `called_at` –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –º–æ–¥–µ–ª–∏ `Visit`. –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å:
```python
called_at: Mapped[Optional[datetime]] = mapped_column(DateTime, nullable=True)
```

### 3. **–ú–∞–ø–ø–∏–Ω–≥ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–µ–π**
–¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –º–µ–∂–¥—É –ø–æ–ª–Ω—ã–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ (`cardiology`) –∏ –∫–æ—Ä–æ—Ç–∫–∏–º–∏ –∫–ª—é—á–∞–º–∏ (`cardio`):
- `cardiology` ‚Üí `cardio`
- `dermatology` ‚Üí `derma`
- `stomatology` ‚Üí `dental`
- `laboratory` ‚Üí `lab`

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω–æ):
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `called_at` –≤ –º–æ–¥–µ–ª—å `Visit`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π –≤ —Ç–∞–±–ª–∏—Ü–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2 (–í–∞–∂–Ω–æ):
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø–∏—Å–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–∑–æ–≤–∞ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –∏–∑ –æ—á–µ—Ä–µ–¥–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3 (–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ):
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ç–∞—Ç—É—Å–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ –æ—á–µ—Ä–µ–¥—è–º
- [ ] –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö

---

## üìù –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–ï—Å–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –≤ `DailyQueue` –∏ `QueueEntry`, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:

1. –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö –æ—á–µ—Ä–µ–¥–µ–π –≤ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
2. –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∑–∞–≤–∏—Å–∏–º—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

- [x] –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ –º–∞—Å—Ç–µ—Ä —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- [x] –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ø–∞–Ω–µ–ª–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç—É—Ä—ã
- [x] –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª–µ–π
- [x] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—è–º
- [x] –ù—É–º–µ—Ä–∞—Ü–∏—è –≤ –æ—á–µ—Ä–µ–¥–∏
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–ø–∏—Å–∏
- [ ] –í—ã–∑–æ–≤ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- [ ] –ü–æ–∏—Å–∫ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞/–§–ò–û
- [ ] –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-09-30  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–ê–≤—Ç–æ—Ä:** AI Assistant

