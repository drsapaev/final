Здесь — максимально подробный «паспорт системы».Я собрал всё что спланировано, и добавил детализацию по интерфейсам, потокам, API, БД, безопасности, печати, деплою и т.д. Если захочешь, могу из этого сразу сделать PDF‑паспорт.

1) Что это за приложение (кратко)

Комплекс для автоматизации клиники: регистрация пациентов, очереди/расписание, приём у врача (ЭМК), лаборатория, оплаты (нал/онлайн), табло очереди, отчёты, уведомления (Telegram/PWA), AI‑подсказки. Десктопная установка для Windows + серверный деплой (Docker).

2) Роли и персоны

Admin: пользователи/роли, услуги/цены, специалисты/расписания, оплаты/провайдеры, AI/Telegram/табло, филиалы, логи, бэкапы.

Registrar: регистрация, очереди, плановые записи, печать талонов/чеков, касса.

Doctor (кардиолог, дерматолог‑косметолог, стоматолог и др.): ЭМК, шаблоны процедур, фото до/после, памятки, рецепты, повторный приём.

Lab tech: заявки на анализы, ввод результатов, PDF, печать.

Cashier (опционально отдельная роль): касса (наличные/онлайн), чеки/квитанции.

Patient (PWA): онлайн‑запись, подтверждение/перенос/отмена, оплаты, загрузка фото до/после, результаты анализов.


3) Функции — карта возможностей

3.1 Очередь и расписание

Живая очередь + запись на будущие дни.

Онлайн‑очередь через QR/Telegram/PWA:

Окно: доступ с 07:00 до фактического открытия регистратуры (кнопка «Открыть приём сейчас» закрывает онлайн‑набор).

Уникальность: 1 номер на телефон или Telegram‑чат (повтор — возвращает тот же номер).

Лимиты: максимум N талонов на врача (напр., 15), авто‑закрытие (напр., 09:00 — конфиг).

Стартовый номер: настраивается по специальности (напр., дерматолог с №15, стоматолог с №3 и т.п.).


Табло очереди (WebSocket): список вызовов, анимации, видео, звук (кастом), история вызовов.

Календарь врача: все будущие записи, цвета статусов (подтверждено/запланировано/отменено).


3.2 Регистратура

Универсальная вкладка: поля пациента, тип обращения (платный/повторный/льготный), вид оплаты (нал/карта/онлайн), стоимость, статус.

Автозаполнение по ФИО/телефону, быстрые «пустые строки».

Печать талонов в термопринтере (ESC/POS).

Онлайн‑оплата — генерация QR/ссылки, фиксация результата.

Специализированные вкладки (см. «Специфика панелей»).


3.3 Кабинеты врачей (общие функции)

Жалобы (rich‑text), диагноз + МКБ‑10 (маска/автоподсказка/валидатор).

Шаблоны процедур (редактируемые, персональные), предпросмотр/вставка, стоимость → синхронизация с регистратурой.

Фото до/после (jpg/png/heic/pdf): drag&drop, предпросмотр, теги (зона, ракурс), хранение по визиту, таймлайн «прогресс».

PDF‑памятка по уходу: редактирование черновика → генерация PDF → печать/Telegram/сохранение в ЭМК.

Рецепт A5: логотип/шапка/штамп/подпись, печать на одном принтере (общая конфигурация).

Повторный приём: без времени, уведомление и подтверждение через Telegram.

AI‑подсказки (жалобы→процедуры, МКБ‑10, анализ лабораторий, интерпретация загруженных файлов/ЭКГ, рекомендации для памяток/рецептов).


3.4 Лаборатория

Очередь заявок, статусы: в ожидании/в работе/готово/отменено.

Ввод результатов, шаблоны форм, группировка по направлениям.

Прикрепление PDF результатов, печать наборов результатов.

AI‑анализ значений: «что отклонено», краткие интерпретации.


3.5 Пациент (PWA)

Авторизация, просмотр визитов.

Онлайн‑запись и перенос/отмена.

Оплаты: онлайн‑провайдеры, чек/квитанция.

Загрузка фото до/после (с модерацией врача).

Получение PDF (памятки, результаты).


3.6 Оплаты/Касса

Наличные (печать чека ESC/POS).

Онлайн (Click, Payme, Kaspi, Stripe, Apple/Google Pay и др.): init → redirect/виджет → webhook → статус → чек/квитанция PDF.

Привязка платежа к визиту; кассовая панель.


3.7 Отчёты и аналитика

Доходы/посещения по врачам/услугам/периодам, тренды и графики.

Конструктор отчётов, фильтры, группировки, экспорт CSV/PDF.


3.8 Уведомления

Telegram: напоминания, подтверждения/перенос/отмена, готовность анализов, отправка PDF.

PWA push: для врачей/регистраторов/пациентов (где уместно).


3.9 AI‑модуль (единый подход)

Провайдеры: OpenAI, Gemini, Grok, Copilot, DeepSeek — переключаемые в админке.

Сценарии:

Жалобы → перечень процедур/обоснований/расходников.

МКБ‑10: автоподбор и проверка формата кода.

Лаборатория: интерпретация отклонений, подсказки врачу.

Документы: выписки/протоколы/изображения/ЭКГ (при поддержке формата) — извлечение ключевых моментов и рекомендаций.

Генерация текста памяток/рецептов/согласий (с локализацией ru/uz/en).



4) Специфика панелей

Кардиолог (+ ЭхоКГ/ЭКГ)

Единая очередь для консультации + ЭхоКГ (эту услугу выполняет сам кардиолог).

Отдельная вкладка «ЭхоКГ» в регистратуре: быстрые записи только на ЭхоКГ (пациент попадает и в общую очередь).

ЭКГ — отдельная очередь и талон (может идти как доп. услуга).

В кабинете: назначение и загрузка ЭКГ/ЭхоКГ (PDF/SCP/DICOM при наличии), AI‑резюме; рецепт A5; памятка; повтор.


Дерматолог‑косметолог

Процедуры разбиты на группы: дерматологические / косметологические.

Шаблоны процедур (ботокс, мезотерапия, пилинг и т.д.) — редактирование под врача.

Фото до/после с поддержкой HEIC; предпросмотр; теги; история прогресса.

AI‑подсказки по жалобам, МКБ‑10, текст памятки.

Передача стоимости процедур в регистратуру; обязательная печать талонов.


Стоматолог

Онлайн‑запись без выбора услуги; конфиг стартового номера (например, с №3).

Оплата консультации до визита; талон «Консультация оплачена».

Фото до/после для эстетики; план лечения (сумма этапов) → регистратура.

Рецепт A5; памятка; повторный визит.


Регистратура

Универсальная вкладка + специализированные.

Онлайн‑очередь: QR, окно времени, лимиты, стартовые номера, кнопка «Открыть приём».

Печать талонов/чеков; касса; календарь.


Админ‑панель

Пользователи/роли, услуги/прайс, специалисты, расписания/отпуска, филиалы.

Настройки Telegram/AI/оплат/табло/онлайн‑очереди (стартовые номера, лимиты, авто‑закрытие).

Отчёты/графики, экспорт, зарплаты/расходы, логи, бэкапы.


5) Интерфейс и дизайн

Оболочки

Публичная: логин, портал пациента, онлайн‑очередь/оплата/подтверждения.

Приватная: все защищённые разделы — регистратура/врачи/лаборатория/админ/касса/чат.


Навигация

Sidebar с фильтрацией пунктов по роли (RBAC на фронте).

Navbar: переключатель языка RU/UZ/EN, ThemeToggle 🌞/🌙, быстрые действия.


Тёмная тема

ThemeContext + ThemeProvider, хранение в localStorage.

Контраст/цвета/графики и состояние фокуса — адаптированы.


Таблицы и списки

Фиксация колонок, многовыбор, быстрые чип‑фильтры.

Drag&Drop загрузка, клипборд, пустые состояния с CTA.


Формы

React‑Hook‑Form для критических форм: маски/валидаторы (МКБ‑10, телефон).

Тосты ошибок/успеха, автосейв черновиков (дебаунс 500–800 мс).


Доступность

Фокус‑кольца, aria‑метки, размеры шрифтов, контраст 4.5:1+.

Горячие клавиши (Tab/Enter/Esc), кнопки достаточно крупные (44px).


6) Архитектура (техблок)

Стек

Frontend: React + Vite, Tailwind, shadcn/ui, Router, i18n, PWA, WebSocket.

Backend: FastAPI, SQLAlchemy, Alembic, PostgreSQL, Redis, Celery, JOSE/JWT, Jinja2 (PDF).

Payments: REST + webhook, ESC/POS, PDF.

Deploy: Docker/Compose, Nginx; Windows: PyInstaller + Inno Setup.


Главные сервисы

AI‑менеджер: провайдеры (OpenAI/Gemini/Grok/Copilot/DeepSeek) через единый интерфейс; таймауты; лимиты; логирование вызовов; кэширование (по визиту/шаблону).

Telegram: привязка ID; сообщения на русском/узбекском; отправка PDF.

Online‑Queue: токен (дата+врач), проверка окна времени и уникальности; «Открыть приём» закрывает набор.


Хранилища

Files: /uploads/patients/:id/visits/:visitId/{before|after|docs}/...
генерируются миниатюры для изображений; HEIC → JPEG превью.

PDF: кэширование по (visitId, template, lang).


Очереди/фоновые задачи

Celery: рассылки, генерация тяжелых PDF, бэкапы, парсинг ЭКГ/документов, очистка кэша.


7) База данных (основные сущности)

users (id, username, role, password_hash, active)

patients (id, fio, birth_year, phone, address, telegram_id?)

visits (id, patient_id, doctor_id, date, status, complaint, diagnosis, icd10, total_cost, draft_json,…)

services (id, title, code, price, category, active)

visit_services (visit_id, service_id, qty, price, note)

daily_queues (id, day, specialist_id, active, opened_at)

queue_entries (id, queue_id, number, patient_name, phone, telegram_id)

lab_requests (id, visit_id, panel_id, status, result_json, file_id)

files (id, patient_id, visit_id, kind, path, meta_json)

payments (id, visit_id, provider, invoice_id, amount, currency, status, meta, created_at)

schedules (id, doctor_id, weekday, start, end, breaks_json)

vacations (id, doctor_id, date_from, date_to)

audit_logs (id, actor_id, event, entity, entity_id, payload, ts)

settings (key, value) — глобальные/по филиалу.


Индексы: patients(phone), queue_entries(queue_id, phone|telegram_id), payments(provider, invoice_id), visits(patient_id, date).

8) API (срез ключевых эндпоинтов)

Auth: POST /api/auth/login → JWT (role/sub).

Patients: GET/POST/PUT/DELETE /api/patients.

Visits: GET/POST /api/visits, POST /api/visits/:id/medical, POST /api/visits/:id/files.

Queue (онлайн):

POST /api/online-queue/qrcode?day=YYYY-MM-DD&specialist_id=X → token

POST /api/online-queue/join { token, phone?, telegram_id? } → номер (duplicate=true при повторе)

POST /api/online-queue/open?day=...&specialist_id=...


Registrar: CRUD записи, печать талона, календарь.

Lab: GET/POST /api/lab/requests, POST /api/lab/requests/:id/result, файлы.

Payments:

POST /api/payments/init { provider, amount, currency, meta }

GET /api/payments/:id (status)

POST /api/payments/:id/attach-visit

POST /api/payments/:provider/webhook

GET /api/payments/redirect/success?payment_id=... (страница «оплачено»)


Print: POST /api/print/ticket, POST /api/print/receipt.

PDF: POST /api/pdf/receipt, POST /api/pdf/memo, POST /api/pdf/prescription.

AI: POST /api/ai/complaint-to-procedures, POST /api/ai/icd-suggest, POST /api/ai/lab-interpret, POST /api/ai/doc-interpret.


9) Печать: спецификации

Талон (термопринтер ESC/POS)

Состав: клиника, дата/время, пациент (ФИО/год), услуга/врач/кабинет, номер очереди (крупно), примечание (опция).

Язык талона = текущая локаль (ru/uz).


Рецепт A5 (PDF)

Шапка: логотип клиники, реквизиты, адрес/телефон.

Пациент: ФИО, год рождения, дата.

Назначение: препараты (латинское/коммерческое, дозировка, кол‑во, режим), рекомендации.

Подпись врача, штамп клиники, QR (опционально).

Локализация ru/uz, авто‑перенос текста.


Памятка (PDF)

Заголовок/процедура, персонализированный текст с рисками/уходом, сроки, контакты; локализация.


10) i18n и мультиязычность

RU/UZ/EN; хранение ключей группами: app, nav, queue, doctor, lab, admin, payments, pdf, print, errors.

Переключатель языка в Navbar, сохранение в localStorage.

RTL не требуется (узбекский — латиница/кириллица), но шрифты с кириллицей.


11) Безопасность

JWT + RBAC по ролям и роутам.

Пароли — bcrypt, запрет слабых.

Шифрование чувствительных полей (AES‑256) в БД (диагнозы/прикреплённые документы — опционально: на уровне файловой системы с ключом).

Секреты только через .env/secret‑хранилище (никогда в репозитории).

CORS, rate‑limit на критичных эндпоинтах (auth, payments, ai).

Аудит: логирование входов/ошибок/печати/файлов/оплат/изменений статусов.

Резервное копирование БД и /uploads (локально + облако).

GDPR/локальные правила: хранение минимум необходимого, редактируемые политики retention.


12) Производительность и масштабирование

Индексы БД, пагинация списков.

Кэш Redis: словари МКБ‑10, готовые PDF (по ключу), AI‑ответы (hash input).

Celery: тяжёлые/отложенные задачи.

WebSocket с Redis pub/sub для табло/чатов (горизонтальный скейл).

Сжатие изображений/миниатюры; HEIC→JPEG‑preview.


13) Мониторинг, логи, бэкапы

/health эндпоинт.

Структурные логи (JSON), агрегация (ELK/CloudWatch/Grafana — опционально).

Бэкапы: nightly для БД и нужных папок; проверка восстановления.

Алерты по фатальным ошибкам (Sentry — опционально).


14) Тестирование

Unit: модели, утилиты (timez, i18n), RBAC.

Интеграционные: payments init/webhook, очереди (окна времени/дубликаты), PDF‑генерация.

E2E: регистрация → визит → оплата → чек/квитанция → печать → закрытие.

Smoke: health, базовые CRUD.

Подготовленные фикстуры и rest‑скрипты.


15) Деплой/инсталляция

Docker/Compose: backend, frontend, db (Postgres), redis, nginx.

Nginx: /api/ → backend:8000, /* → frontend статика (+ try_files).

Windows: PyInstaller (backend exe) + Inno Setup (установщик), добавление firewall‑правил.

.env: DB/REDIS/SECRET_KEY/AI_KEYS/payment‑keys/locale/timezone/queue‑rules.


16) Конфигурации и фичи‑флаги (Admin → Settings)

Online queue: start number per speciality, QUEUE_START_HOUR (07:00), max tokens, auto‑close time (например, 09:00).

Payments: test/production; провайдеры; webhooks.

AI: провайдер по умолчанию; лимиты; запрещённые подсказки; выбор модели.

Табло: тема/ролики/звуки/скорость; список дисплеев (если несколько экранов).

Печать: принтер по умолчанию (талон/рецепт/памятка), формат A5, отступы.


17) Матрица прав (пример)

Admin: все.

Registrar: пациенты/записи/очереди/печать/касса; нет доступа к чужим ЭМК.

Doctor: свои пациенты/визиты/файлы/памятки/рецепты; нет массы админ‑настроек.

Lab: свои заявки/результаты/файлы лаборатории.

Cashier: платежи/квитанции; нет медданных.

Patient: только свои записи/файлы/оплаты.


18) Дорожная карта (коротко)

Чат (врач↔пациент, сотрудник↔сотрудник) с уведомлениями и историей.

История зарплат (полный модуль).

Автоматизация уведомлений «готовы анализы» (триггеры+шаблоны).

Интеграции ЭКГ/ЭхоКГ: авто‑инжест из «наблюдаемой папки» и парсинг SCP/DICOM.

Одонтограмма (стоматология).

Расширенный аудиторский журнал (полнотекстовый поиск, сравнение

Ещё планируется в дальнейшем подключение к DMED, eGOV и страхованию

19) Система активации приложения 