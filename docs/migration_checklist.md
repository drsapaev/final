# Чек-лист миграции на новый мастер регистрации

## Предварительные проверки

### ✅ Функциональность нового мастера
- [ ] Все тестовые сценарии пройдены успешно
- [ ] Click оплата работает корректно
- [ ] Льготы и повторные визиты применяются правильно
- [ ] Корзина создаёт множественные визиты
- [ ] Очереди работают по queue_tag
- [ ] Автосохранение восстанавливает данные
- [ ] Горячие клавиши функционируют
- [ ] Печать талонов работает

### ✅ Производительность
- [ ] Мастер загружается быстро (< 2 сек)
- [ ] Поиск пациентов мгновенный
- [ ] API запросы выполняются без задержек
- [ ] Автосохранение не замедляет интерфейс

### ✅ Совместимость
- [ ] Работает в Chrome, Firefox, Edge
- [ ] Адаптивный дизайн на мобильных
- [ ] Данные совместимы со старой системой
- [ ] Существующие записи отображаются корректно

### ✅ Обратная связь пользователей
- [ ] Регистраторы протестировали новый мастер
- [ ] Получена положительная обратная связь
- [ ] Критические замечания устранены
- [ ] Пользователи готовы к переходу

## Этапы миграции

### Этап 1: Подготовка к удалению
1. **Создать резервную копию**:
   ```bash
   git checkout -b backup-old-wizard
   git add .
   git commit -m "Backup: старый мастер перед удалением"
   ```

2. **Убедиться, что новый мастер включен по умолчанию**:
   - В админ-панели установить "Использовать новый мастер" = true
   - Проверить, что все пользователи видят V2

3. **Уведомить команду**:
   - Сообщить о планируемом удалении старого кода
   - Дать время на финальное тестирование

### Этап 2: Удаление старого кода

#### 2.1 Frontend файлы для удаления:
- [ ] `frontend/src/components/wizard/AppointmentWizard.jsx` (старый мастер)
- [ ] Связанные CSS файлы старого мастера
- [ ] Неиспользуемые компоненты и утилиты

#### 2.2 Backend endpoints для удаления:
- [ ] Старые API endpoints, если они дублируются
- [ ] Неиспользуемые схемы и модели
- [ ] Устаревшие миграции (осторожно!)

#### 2.3 Обновление импортов:
- [ ] Удалить импорт `AppointmentWizard` из `RegistrarPanel.jsx`
- [ ] Убрать условный рендеринг (оставить только V2)
- [ ] Очистить неиспользуемые зависимости

### Этап 3: Очистка кода

#### 3.1 Удаление условной логики:
```javascript
// УДАЛИТЬ:
{!wizardSettingsLoading && (
  useNewWizard ? (
    <AppointmentWizardV2 ... />
  ) : (
    <AppointmentWizard ... />
  )
)}

// ЗАМЕНИТЬ НА:
<AppointmentWizardV2 ... />
```

#### 3.2 Упрощение настроек:
- [ ] Удалить настройку "wizard_use_new_version" из ClinicSettings
- [ ] Убрать компонент WizardSettings из админ-панели
- [ ] Удалить хук useWizardSettings

#### 3.3 Переименование:
- [ ] `AppointmentWizardV2.jsx` → `AppointmentWizard.jsx`
- [ ] `AppointmentWizardV2.css` → `AppointmentWizard.css`
- [ ] Обновить все импорты

### Этап 4: Тестирование после удаления

#### 4.1 Функциональные тесты:
- [ ] Мастер открывается без ошибок
- [ ] Все функции работают как прежде
- [ ] Нет ошибок в консоли браузера
- [ ] Нет 404 ошибок для удалённых файлов

#### 4.2 Регрессионное тестирование:
- [ ] Повторить ключевые тестовые сценарии
- [ ] Проверить интеграцию с другими компонентами
- [ ] Убедиться в стабильности системы

### Этап 5: Финализация

#### 5.1 Документация:
- [ ] Обновить README с информацией о новом мастере
- [ ] Удалить устаревшую документацию
- [ ] Обновить API документацию

#### 5.2 Мониторинг:
- [ ] Следить за ошибками в продакшене
- [ ] Собирать обратную связь пользователей
- [ ] Готовность к быстрому откату при необходимости

## План отката (на случай проблем)

### Быстрый откат:
1. В админ-панели переключить на старый мастер (если настройка ещё есть)
2. Или временно вернуть старые файлы из backup ветки

### Полный откат:
```bash
git checkout backup-old-wizard
git checkout main -- [specific files to restore]
git commit -m "Откат: восстановление старого мастера"
```

## Критерии успешной миграции

### ✅ Технические критерии:
- Нет ошибок в логах
- Производительность не ухудшилась
- Все функции работают стабильно
- Пользователи не испытывают проблем

### ✅ Бизнес критерии:
- Регистрация пациентов происходит без сбоев
- Время регистрации сократилось или осталось прежним
- Пользователи довольны новым интерфейсом
- Новые функции (льготы, корзина) используются

## Временные рамки

- **Подготовка**: 1-2 дня
- **Удаление кода**: 1 день
- **Тестирование**: 2-3 дня
- **Мониторинг**: 1 неделя

## Ответственные

- **Разработчик**: Удаление кода, тестирование
- **Тестировщик**: Регрессионное тестирование
- **Администратор**: Мониторинг продакшена
- **Пользователи**: Обратная связь, приёмочное тестирование

---

**⚠️ ВАЖНО**: Не удаляйте старый код до полного подтверждения стабильности нового мастера в продакшене!
