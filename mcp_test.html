<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP API –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        input, textarea {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.success { background-color: #28a745; color: white; }
        .status.error { background-color: #dc3545; color: white; }
        .status.info { background-color: #17a2b8; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ MCP API –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>
        <p>–≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ MCP endpoints —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä.</p>
        
        <div class="section info">
            <h3>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:</h3>
            <ol>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ backend —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ <code>http://localhost:8000</code></li>
                <li>–ù–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏" –¥–ª—è –≤—Ö–æ–¥–∞</li>
                <li>–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ MCP endpoints</li>
                <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Ä–∞–∑–¥–µ–ª–∞—Ö</li>
            </ol>
        </div>
    </div>

    <!-- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è -->
    <div class="container">
        <h2>üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
        <div class="section">
            <h3>–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏</h3>
            <input type="text" id="username" placeholder="Username" value="mcp_test">
            <input type="password" id="password" placeholder="Password" value="test123">
            <button onclick="getAuthToken()">–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω</button>
            <div id="authResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- MCP Health -->
    <div class="container">
        <h2>üè• MCP Health Check</h2>
        <div class="section">
            <button onclick="testMCPHealth()" id="healthBtn">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ MCP</button>
            <div id="healthResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- MCP Status -->
    <div class="container">
        <h2>üìä MCP Status</h2>
        <div class="section">
            <button onclick="testMCPStatus()" id="statusBtn">–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å MCP</button>
            <div id="statusResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- MCP Capabilities -->
    <div class="container">
        <h2>üîß MCP Capabilities</h2>
        <div class="section">
            <button onclick="testMCPCapabilities()" id="capabilitiesBtn">–ü–æ–ª—É—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ MCP</button>
            <div id="capabilitiesResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- –ê–Ω–∞–ª–∏–∑ –∂–∞–ª–æ–± -->
    <div class="container">
        <h2>ü©∫ –ê–Ω–∞–ª–∏–∑ –∂–∞–ª–æ–±</h2>
        <div class="section">
            <h3>–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∂–∞–ª–æ–±—É –ø–∞—Ü–∏–µ–Ω—Ç–∞</h3>
            <textarea id="complaintText" placeholder="–í–≤–µ–¥–∏—Ç–µ –∂–∞–ª–æ–±—É –ø–∞—Ü–∏–µ–Ω—Ç–∞..." rows="3">–ì–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å –∏ —Ç–æ—à–Ω–æ—Ç–∞ —É–∂–µ 2 –¥–Ω—è, –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ —É—Ç—Ä–∞–º</textarea>
            <input type="number" id="patientAge" placeholder="–í–æ–∑—Ä–∞—Å—Ç –ø–∞—Ü–∏–µ–Ω—Ç–∞" value="35">
            <select id="patientGender">
                <option value="male">–ú—É–∂—Å–∫–æ–π</option>
                <option value="female">–ñ–µ–Ω—Å–∫–∏–π</option>
            </select>
            <button onclick="analyzeComplaint()" id="complaintBtn">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∂–∞–ª–æ–±—É</button>
            <div id="complaintResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ú–ö–ë-10 -->
    <div class="container">
        <h2>üìã –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ú–ö–ë-10</h2>
        <div class="section">
            <h3>–ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ú–ö–ë-10</h3>
            <textarea id="symptomsText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é..." rows="2">–≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å, —Ç–æ—à–Ω–æ—Ç–∞, —Å–≤–µ—Ç–æ–±–æ—è–∑–Ω—å</textarea>
            <input type="text" id="diagnosisText" placeholder="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –¥–∏–∞–≥–Ω–æ–∑" value="–ú–∏–≥—Ä–µ–Ω—å">
            <button onclick="suggestICD10()" id="icd10Btn">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ú–ö–ë-10</button>
            <div id="icd10Result" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤ -->
    <div class="container">
        <h2>üß™ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤</h2>
        <div class="section">
            <h3>–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–æ–≤</h3>
            <textarea id="labResultsText" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–æ–≤ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ..." rows="4">[
  {"name": "–ì–ª—é–∫–æ–∑–∞", "value": 6.5, "unit": "–º–º–æ–ª—å/–ª", "normal_range": "3.3-5.5"},
  {"name": "–ì–µ–º–æ–≥–ª–æ–±–∏–Ω", "value": 110, "unit": "–≥/–ª", "normal_range": "120-160"},
  {"name": "–õ–µ–π–∫–æ—Ü–∏—Ç—ã", "value": 8.5, "unit": "√ó10‚Åπ/–ª", "normal_range": "4.0-9.0"},
  {"name": "–°–û–≠", "value": 25, "unit": "–º–º/—á", "normal_range": "2-15"}
]</textarea>
            <button onclick="interpretLabResults()" id="labBtn">–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑—ã</button>
            <div id="labResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <!-- –ú–ö–ë-10 –ø–æ–∏—Å–∫ -->
    <div class="container">
        <h2>üîç –ü–æ–∏—Å–∫ –ú–ö–ë-10</h2>
        <div class="section">
            <h3>–ü–æ–∏—Å–∫ –∫–æ–¥–æ–≤ –ú–ö–ë-10</h3>
            <input type="text" id="searchQuery" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å..." value="–º–∏–≥—Ä–µ–Ω—å">
            <button onclick="searchICD10()" id="searchBtn">–ü–æ–∏—Å–∫ –ú–ö–ë-10</button>
            <div id="searchResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:8000/api/v1';
        let authToken = null;

        // –ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        async function getAuthToken() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('authResult');
            
            try {
                const response = await fetch(`${BASE_URL}/auth/minimal-login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json',
                    },
                    mode: 'cors',
                    credentials: 'omit',
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    authToken = data.access_token;
                    resultDiv.className = 'result success';
                    resultDiv.style.display = 'block';
                    resultDiv.textContent = `‚úÖ –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!\n\n–¢–æ–∫–µ–Ω: ${authToken.substring(0, 50)}...\n\n–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å MCP endpoints.`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.style.display = 'block';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ${data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.style.display = 'block';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
        function checkAuth() {
            if (!authToken) {
                alert('–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏!');
                return false;
            }
            return true;
        }

        // –ü–æ–ª—É—á–∏—Ç—å –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
        function getAuthHeaders() {
            return {
                'Authorization': `Bearer ${authToken}`,
                'Content-Type': 'application/json'
            };
        }

        // –¢–µ—Å—Ç –∑–¥–æ—Ä–æ–≤—å—è MCP
        async function testMCPHealth() {
            if (!checkAuth()) return;
            
            const resultDiv = document.getElementById('healthResult');
            const btn = document.getElementById('healthBtn');
            
            btn.disabled = true;
            btn.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º...';
            
            try {
                const response = await fetch(`${BASE_URL}/mcp/health`, {
                    headers: getAuthHeaders(),
                    mode: 'cors',
                    credentials: 'omit'
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ MCP Health Check —É—Å–ø–µ—à–µ–Ω!\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.textContent = '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ MCP';
            }
        }

        // –¢–µ—Å—Ç —Å—Ç–∞—Ç—É—Å–∞ MCP
        async function testMCPStatus() {
            if (!checkAuth()) return;
            
            const resultDiv = document.getElementById('statusResult');
            const btn = document.getElementById('statusBtn');
            
            btn.disabled = true;
            btn.textContent = '–ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç—É—Å...';
            
            try {
                const response = await fetch(`${BASE_URL}/mcp/status`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ MCP Status –ø–æ–ª—É—á–µ–Ω!\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.textContent = '–ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å MCP';
            }
        }

        // –¢–µ—Å—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π MCP
        async function testMCPCapabilities() {
            if (!checkAuth()) return;
            
            const resultDiv = document.getElementById('capabilitiesResult');
            const btn = document.getElementById('capabilitiesBtn');
            
            btn.disabled = true;
            btn.textContent = '–ü–æ–ª—É—á–∞–µ–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏...';
            
            try {
                const response = await fetch(`${BASE_URL}/mcp/capabilities`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ MCP Capabilities –ø–æ–ª—É—á–µ–Ω—ã!\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.textContent = '–ü–æ–ª—É—á–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ MCP';
            }
        }

        // –ê–Ω–∞–ª–∏–∑ –∂–∞–ª–æ–±
        async function analyzeComplaint() {
            if (!checkAuth()) return;
            
            const complaint = document.getElementById('complaintText').value;
            const age = parseInt(document.getElementById('patientAge').value);
            const gender = document.getElementById('patientGender').value;
            const resultDiv = document.getElementById('complaintResult');
            const btn = document.getElementById('complaintBtn');
            
            btn.disabled = true;
            btn.textContent = '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º...';
            
            try {
                const response = await fetch(`${BASE_URL}/mcp/complaint/analyze`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        complaint: complaint,
                        patient_age: age,
                        patient_gender: gender,
                        urgency_assessment: true
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.textContent = `‚úÖ –ê–Ω–∞–ª–∏–∑ –∂–∞–ª–æ–± –≤—ã–ø–æ–ª–Ω–µ–Ω!\n\n${JSON.stringify(data, null, 2)}`;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.textContent = '–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∂–∞–ª–æ–±—É';
            }
        }

        // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ú–ö–ë-10
        async function suggestICD10() {
            if (!checkAuth()) return;
            
            const symptoms = document.getElementById('symptomsText').value.split(',').map(s => s.trim());
            const diagnosis = document.getElementById('diagnosisText').value;
            const resultDiv = document.getElementById('icd10Result');
            const btn = document.getElementById('icd10Btn');
            
            btn.disabled = true;
            btn.textContent = '–ü–æ–ª—É—á–∞–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏...';
            
            try {
                const response = await fetch(`${BASE_URL}/mcp/icd10/suggest`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        symptoms: symptoms,
                        diagnosis: diagnosis,
                        max_suggestions: 5
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ú–ö–ë-10
                    let formattedResult = '‚úÖ –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ú–ö–ë-10 –ø–æ–ª—É—á–µ–Ω—ã!\n\n';
                    
                    if (data.data && data.data.suggestions) {
                        formattedResult += 'üìã –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–¥—ã –ú–ö–ë-10:\n\n';
                        data.data.suggestions.forEach((item, index) => {
                            formattedResult += `${index + 1}. ${item.code} - ${item.name || item.description}\n`;
                            formattedResult += `   –†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: ${item.relevance || '–≤—ã—Å–æ–∫–∞—è'}\n\n`;
                        });
                    } else {
                        formattedResult += JSON.stringify(data, null, 2);
                    }
                    
                    resultDiv.textContent = formattedResult;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.textContent = '–ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ú–ö–ë-10';
            }
        }

        // –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤
        async function interpretLabResults() {
            if (!checkAuth()) return;
            
            const resultsText = document.getElementById('labResultsText').value;
            const resultDiv = document.getElementById('labResult');
            const btn = document.getElementById('labBtn');
            
            btn.disabled = true;
            btn.textContent = '–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º...';
            
            try {
                const results = JSON.parse(resultsText);
                
                const response = await fetch(`${BASE_URL}/mcp/lab/interpret`, {
                    method: 'POST',
                    headers: getAuthHeaders(),
                    body: JSON.stringify({
                        results: results,
                        patient_info: {
                            age: 35,
                            gender: 'female'
                        }
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏–∏ –∞–Ω–∞–ª–∏–∑–æ–≤
                    let formattedResult = '‚úÖ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –∞–Ω–∞–ª–∏–∑–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞!\n\n';
                    
                    if (data.data && data.data.ai_interpretation) {
                        const ai = data.data.ai_interpretation;
                        
                        formattedResult += `üìä ${ai.summary}\n\n`;
                        
                        if (ai.abnormal_values && ai.abnormal_values.length > 0) {
                            formattedResult += '‚ö†Ô∏è –û—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –æ—Ç –Ω–æ—Ä–º—ã:\n';
                            ai.abnormal_values.forEach((item, index) => {
                                formattedResult += `${index + 1}. ${item.parameter}: ${item.value}\n`;
                                formattedResult += `   ${item.interpretation}\n`;
                                formattedResult += `   –ö–ª–∏–Ω–∏—á–µ—Å–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ: ${item.clinical_significance}\n\n`;
                            });
                        }
                        
                        if (ai.possible_conditions && ai.possible_conditions.length > 0) {
                            formattedResult += 'üîç –í–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è:\n';
                            ai.possible_conditions.forEach((condition, index) => {
                                formattedResult += `${index + 1}. ${condition}\n`;
                            });
                            formattedResult += '\n';
                        }
                        
                        if (ai.recommendations && ai.recommendations.length > 0) {
                            formattedResult += 'üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:\n';
                            ai.recommendations.forEach((rec, index) => {
                                formattedResult += `${index + 1}. ${rec}\n`;
                            });
                            formattedResult += '\n';
                        }
                        
                        formattedResult += `üö® –°—Ä–æ—á–Ω–∞—è –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è: ${ai.urgency === '–¥–∞' ? '–¢—Ä–µ–±—É–µ—Ç—Å—è' : '–ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è'}\n`;
                    } else {
                        formattedResult += JSON.stringify(data, null, 2);
                    }
                    
                    resultDiv.textContent = formattedResult;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${error.message}`;
            } finally {
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.textContent = '–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–Ω–∞–ª–∏–∑—ã';
            }
        }

        // –ü–æ–∏—Å–∫ –ú–ö–ë-10
        async function searchICD10() {
            if (!checkAuth()) return;
            
            const query = document.getElementById('searchQuery').value;
            const resultDiv = document.getElementById('searchResult');
            const btn = document.getElementById('searchBtn');
            
            btn.disabled = true;
            btn.textContent = '–ò—â–µ–º...';
            
            try {
                const response = await fetch(`${BASE_URL}/mcp/icd10/search?query=${encodeURIComponent(query)}`, {
                    headers: getAuthHeaders()
                });

                const data = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    
                    // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –ú–ö–ë-10
                    let formattedResult = '‚úÖ –ü–æ–∏—Å–∫ –ú–ö–ë-10 –≤—ã–ø–æ–ª–Ω–µ–Ω!\n\n';
                    
                    if (data.data && data.data.results) {
                        formattedResult += `üîç –ù–∞–π–¥–µ–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ${data.data.total_found}\n`;
                        formattedResult += `üìù –ó–∞–ø—Ä–æ—Å: "${data.data.query}"\n\n`;
                        
                        if (data.data.results.length > 0) {
                            formattedResult += 'üìã –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–¥—ã:\n\n';
                            data.data.results.forEach((item, index) => {
                                formattedResult += `${index + 1}. ${item.code} - ${item.description}\n`;
                                formattedResult += `   –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${item.category}\n`;
                                formattedResult += `   –°–æ–≤–ø–∞–¥–µ–Ω–∏–µ: ${Math.round((item.match_score || 1) * 100)}%\n\n`;
                            });
                        } else {
                            formattedResult += '‚ùå –ö–æ–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã\n';
                        }
                    } else {
                        formattedResult += JSON.stringify(data, null, 2);
                    }
                    
                    resultDiv.textContent = formattedResult;
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞: ${data.detail || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`;
                }
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`;
            } finally {
                resultDiv.style.display = 'block';
                btn.disabled = false;
                btn.textContent = '–ü–æ–∏—Å–∫ –ú–ö–ë-10';
            }
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = async function() {
            try {
                const response = await fetch(`${BASE_URL}/health`, {
                    mode: 'cors',
                    credentials: 'omit'
                });
                if (response.ok) {
                    console.log('‚úÖ Backend —Å–µ—Ä–≤–µ—Ä –¥–æ—Å—Ç—É–ø–µ–Ω');
                    document.body.style.borderTop = '5px solid #28a745';
                } else {
                    console.log('‚ö†Ô∏è Backend —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                    document.body.style.borderTop = '5px solid #ffc107';
                }
            } catch (error) {
                console.log('‚ùå Backend —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω:', error.message);
                document.body.style.borderTop = '5px solid #dc3545';
            }
        };
    </script>
</body>
</html>
