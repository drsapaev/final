#!/usr/bin/env python3
"""
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —É—Å–ª—É–≥ –∏–∑ –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
"""

import sqlite3
import os

def add_all_lab_services():
    """–î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏"""

    db_path = 'clinic.db'

    if not os.path.exists(db_path):
        print(f"‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö '{db_path}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
        return False

    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()

    try:
        print("üîÑ –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏...")

        # –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —É—Å–ª—É–≥ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º (–∏—Å–∫–ª—é—á–∞—è L02, L31, L50)
        lab_services = [
            # L01 - –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –∫—Ä–æ–≤–∏ (—É–∂–µ –µ—Å—Ç—å)
            # L02 - –ë–∏–æ—Ö–∏–º–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫—Ä–æ–≤–∏ (–∏—Å–∫–ª—é—á–∏—Ç—å)
            # L03 - –í—Ä–µ–º—è —Å–≤–µ—Ä—Ç—ã–≤–∞–µ–º–æ—Å—Ç–∏ –∫—Ä–æ–≤–∏ (—É–∂–µ –µ—Å—Ç—å)
            # L25 - –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –º–æ—á–∏ (—É–∂–µ –µ—Å—Ç—å)
            # L30 - HBsAg –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç
            # L31 - –ò–Ω—Ñ–µ–∫—Ü–∏–∏/—Å–µ—Ä–æ–ª–æ–≥–∏—è (–∏—Å–∫–ª—é—á–∏—Ç—å)
            # L32 - HIV –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç
            # L33 - RW –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç
            # L35 - –ì–ª—é–∫–æ–∑–∞ —ç–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç
            # L50 - –ì–æ—Ä–º–æ–Ω—ã (–∏—Å–∫–ª—é—á–∏—Ç—å)

            # –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ
            ('lab.hbsag', 'HBsAg –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç', 'L30'),
            ('lab.hiv', 'HIV –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç', 'L32'),
            ('lab.rw', 'RW –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç', 'L33'),
            ('lab.glucose_express', '–ì–ª—é–∫–æ–∑–∞ —ç–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç', 'L35'),
            ('lab.protein', '–û–±—â–∏–π –±–µ–ª–æ–∫', 'L10'),
            ('lab.glucose', '–ì–ª—é–∫–æ–∑–∞', 'L11'),
            ('lab.cholesterol', '–•–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω', 'L12'),
            ('lab.urea', '–ú–æ—á–µ–≤–∏–Ω–∞', 'L13'),
            ('lab.creatinine', '–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω', 'L14'),
            ('lab.alt', '–ê–ª–ê–¢ - –∞–ª–∞–Ω–∏–Ω–∞–º–∏–Ω–æ—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–∑–∞', 'L15'),
            ('lab.ast', '–ê—Å–ê–¢ - –∞—Å–ø–∞—Ä—Ç–∞—Ç–∞–º–∏–Ω–æ—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–∑–∞', 'L16'),
            ('lab.bilirubin', '–ë–∏–ª–∏—Ä—É–±–∏–Ω (–æ–±—â, –ø—Ä—è–º, –Ω–µ–ø—Ä—è–º)', 'L17'),
            ('lab.alkaline', '–©–µ–ª–æ—á–Ω–∞—è —Ñ–æ—Å—Ñ–∞—Ç–∞–∑–∞', 'L18'),
            ('lab.amylase', '–ê–ª—å—Ñ–∞-–∞–º–∏–ª–∞–∑–∞', 'L19'),
            ('lab.potassium', '–ö–∞–ª–∏–π', 'L20'),
            ('lab.calcium', '–ö–∞–ª—å—Ü–∏–π', 'L21'),
            ('lab.sodium', '–ù–∞—Ç—Ä–∏–π', 'L22'),
            ('lab.vitamin_d', '–í–∏—Ç–∞–º–∏–Ω –î', 'L23'),
            ('lab.immunoglobulin', '–ò–º–º—É–Ω–æ–≥–ª–æ–±—É–ª–∏–Ω –ï', 'L65'),
            ('lab.spermogram', '–°–ø–µ—Ä–º–æ–≥—Ä–∞–º–º–∞', 'L34'),
            ('lab.rheumatoid', '–†–µ–≤–º–∞—Ç–æ–∏–¥–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä (RF)', 'L40'),
            ('lab.crp', '–°-—Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –±–µ–ª–æ–∫ (CRP)', 'L41'),
            ('lab.aslo', '–ê–Ω—Ç–∏—Å—Ç—Ä–µ–ø—Ç–æ–ª–∏–∑–∏–Ω-–û (ASlO)', 'L42'),
            ('lab.brucellosis', '–ë—Ä—É—Ü–µ–ª–ª–µ–∑ (Rose Bengal)', 'L43'),
            ('lab.tsh', '–¢–¢–ì (—Ç–∏—Ä–µ–æ—Ç—Ä–æ–ø–Ω—ã–π –≥–æ—Ä–º–æ–Ω)', 'L51'),
            ('lab.t4', '–¢4 (—Ç–∏—Ä–æ–∫—Å–∏–Ω)', 'L52'),
            ('lab.t3', '–¢3 (—Ç—Ä–∏–π–æ–¥—Ç–∏—Ä–æ–Ω–∏–Ω)', 'L53'),
            ('lab.at_tpo', '–ê–¢-–¢–ü–û (–∞—É—Ç–æ–∞–Ω—Ç–∏—Ç–µ–ª–æ –∫ —Ç–∏—Ä–µ–æ–ø–µ—Ä–æ–∫—Å–∏–¥–∞–∑–µ)', 'L54'),
            ('lab.testosterone', '–¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω', 'L55'),
            ('lab.fungi', '–ù–∏—Ç–∏ –≥—Ä–∏–±–∫–∏', 'L60'),
            ('lab.malassezia', 'Malassezia furfur', 'L61'),
            ('lab.demodex', '–î–µ–º–æ–¥–µ–∫–æ–∑', 'L62'),
            ('lab.smear', '–ú–∞–∑–æ–∫ –Ω–∞ —Å—Ç–µ–ø–µ–Ω—å —á–∏—Å—Ç–æ—Ç—ã', 'L63'),
            ('lab.stool', '–ö–∞–ª –Ω–∞ —è/–≥', 'L64'),
        ]

        added_count = 0
        for service_code, service_name, service_code_value in lab_services:
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É—Å–ª—É–≥–∞
            cursor.execute('SELECT id FROM services WHERE code = ?', (service_code,))
            existing = cursor.fetchone()

            if existing:
                # –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ
                cursor.execute("""
                    UPDATE services
                    SET service_code = ?, category_code = 'L', name = ?, active = 1
                    WHERE code = ?
                """, (service_code_value, service_name, service_code))
                print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —É—Å–ª—É–≥–∞: {service_code} -> {service_code_value}")
            else:
                # –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ
                cursor.execute("""
                    INSERT INTO services (code, name, department, unit, price, currency, active, category_code, service_code, duration_minutes)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
                """, (service_code, service_name, 'laboratory', '–∞–Ω–∞–ª–∏–∑', 15000.00, 'UZS', 1, 'L', service_code_value, 5))
                print(f"‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —É—Å–ª—É–≥–∞: {service_code_value} - {service_name}")
                added_count += 1

        print(f"\nüìä –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —É—Å–ª—É–≥: {added_count}")

        conn.commit()
        print("‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —É—Å–ª—É–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ")

        return True

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        conn.rollback()
        return False
    finally:
        conn.close()

if __name__ == "__main__":
    add_all_lab_services()
