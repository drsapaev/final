#!/usr/bin/env python3
"""
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —É—Å–ª—É–≥ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–Ω–æ –ø–æ–ª–Ω–æ–º—É —Å–ø–∏—Å–∫—É
"""

import sqlite3
import os

def update_lab_services():
    """–û–±–Ω–æ–≤–ª—è–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏"""

    db_path = 'clinic.db'

    if not os.path.exists(db_path):
        print(f"‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö '{db_path}' –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
        return False

    conn = sqlite3.connect(db_path)
    cursor = conn.cursor()

    try:
        print("üîÑ –û–±–Ω–æ–≤–ª—è–µ–º –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã–µ —É—Å–ª—É–≥–∏...")

        # –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —É—Å–ª—É–≥ —Å–æ–≥–ª–∞—Å–Ω–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
        lab_services = [
            ("lab.cbc", "–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –∫—Ä–æ–≤–∏", "L01"),
            ("lab.coag", "–í—Ä–µ–º—è —Å–≤–µ—Ä—Ç—ã–≤–∞–µ–º–æ—Å—Ç–∏ –∫—Ä–æ–≤–∏", "L03"),
            ("lab.urine", "–û–±—â–∏–π –∞–Ω–∞–ª–∏–∑ –º–æ—á–∏", "L25"),
            ("lab.glucose_express", "–ì–ª—é–∫–æ–∑–∞ —ç–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç", "L35"),
            ("lab.hbsag", "HBsAg –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç", "L30"),
            ("lab.hcv", "HCV –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç", "L31"),
            ("lab.hiv", "HIV –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç", "L32"),
            ("lab.rw", "RW –≠–∫—Å–ø—Ä–µ—Å—Å —Ç–µ—Å—Ç", "L33"),
            ("lab.protein", "–û–±—â–∏–π –±–µ–ª–æ–∫", "L10"),
            ("lab.glucose", "–ì–ª—é–∫–æ–∑–∞", "L11"),
            ("lab.cholesterol", "–•–æ–ª–µ—Å—Ç–µ—Ä–∏–Ω", "L12"),
            ("lab.urea", "–ú–æ—á–µ–≤–∏–Ω–∞", "L13"),
            ("lab.creatinine", "–ö—Ä–µ–∞—Ç–∏–Ω–∏–Ω", "L14"),
            ("lab.alt", "–ê–ª–ê–¢ - –∞–ª–∞–Ω–∏–Ω–∞–º–∏–Ω–æ—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–∑–∞", "L15"),
            ("lab.ast", "–ê—Å–ê–¢ - –∞—Å–ø–∞—Ä—Ç–∞—Ç–∞–º–∏–Ω–æ—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞–∑–∞", "L16"),
            ("lab.bilirubin", "–ë–∏–ª–∏—Ä—É–±–∏–Ω (–æ–±—â, –ø—Ä—è–º, –Ω–µ–ø—Ä—è–º)", "L17"),
            ("lab.alkaline", "–©–µ–ª–æ—á–Ω–∞—è —Ñ–æ—Å—Ñ–∞—Ç–∞–∑–∞", "L18"),
            ("lab.amylase", "–ê–ª—å—Ñ–∞-–∞–º–∏–ª–∞–∑–∞", "L19"),
            ("lab.potassium", "–ö–∞–ª–∏–π", "L20"),
            ("lab.calcium", "–ö–∞–ª—å—Ü–∏–π", "L21"),
            ("lab.sodium", "–ù–∞—Ç—Ä–∏–π", "L22"),
            ("lab.vitamin_d", "–í–∏—Ç–∞–º–∏–Ω –î", "L23"),
            ("lab.immunoglobulin", "–ò–º–º—É–Ω–æ–≥–ª–æ–±—É–ª–∏–Ω –ï", "L65"),
            ("lab.spermogram", "–°–ø–µ—Ä–º–æ–≥—Ä–∞–º–º–∞", "L34"),
            ("lab.rheumatoid", "–†–µ–≤–º–∞—Ç–æ–∏–¥–Ω—ã–π —Ñ–∞–∫—Ç–æ—Ä (RF)", "L40"),
            ("lab.crp", "–°-—Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π –±–µ–ª–æ–∫ (CRP)", "L41"),
            ("lab.aslo", "–ê–Ω—Ç–∏—Å—Ç—Ä–µ–ø—Ç–æ–ª–∏–∑–∏–Ω-–û (ASlO)", "L42"),
            ("lab.brucellosis", "–ë—Ä—É—Ü–µ–ª–ª–µ–∑ (Rose Bengal)", "L43"),
            ("lab.tsh", "–¢–¢–ì (—Ç–∏—Ä–µ–æ—Ç—Ä–æ–ø–Ω—ã–π –≥–æ—Ä–º–æ–Ω)", "L50"),
            ("lab.t4", "–¢4 (—Ç–∏—Ä–æ–∫—Å–∏–Ω)", "L51"),
            ("lab.t3", "–¢3 (—Ç—Ä–∏–π–æ–¥—Ç–∏—Ä–æ–Ω–∏–Ω)", "L52"),
            ("lab.at_tpo", "–ê–¢-–¢–ü–û (–∞—É—Ç–æ–∞–Ω—Ç–∏—Ç–µ–ª–æ –∫ —Ç–∏—Ä–µ–æ–ø–µ—Ä–æ–∫—Å–∏–¥–∞–∑–µ)", "L53"),
            ("lab.testosterone", "–¢–µ—Å—Ç–æ—Å—Ç–µ—Ä–æ–Ω", "L54"),
            ("lab.fungi", "–ù–∏—Ç–∏ –≥—Ä–∏–±–∫–∏", "L60"),
            ("lab.malassezia", "Malassezia furfur", "L61"),
            ("lab.demodex", "–î–µ–º–æ–¥–µ–∫–æ–∑", "L62"),
            ("lab.smear", "–ú–∞–∑–æ–∫ –Ω–∞ —Å—Ç–µ–ø–µ–Ω—å —á–∏—Å—Ç–æ—Ç—ã", "L63"),
            ("lab.stool", "–ö–∞–ª –Ω–∞ —è/–≥", "L64"),
        ]

        updated_count = 0
        for service_code, service_name, new_service_code in lab_services:
            cursor.execute("""
                UPDATE services
                SET service_code = ?, category_code = 'L', name = ?
                WHERE code = ?
            """, (new_service_code, service_name, service_code))

            if cursor.rowcount > 0:
                print(f"‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —É—Å–ª—É–≥–∞: {service_code} -> {new_service_code} ({service_name})")
                updated_count += 1
            else:
                print(f"‚ö†Ô∏è –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —É—Å–ª—É–≥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞: {service_code}")

        print(f"\nüìä –û–±–Ω–æ–≤–ª–µ–Ω–æ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —É—Å–ª—É–≥: {updated_count}")

        conn.commit()
        print("‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω—ã—Ö —É—Å–ª—É–≥ –∑–∞–≤–µ—Ä—à–µ–Ω–æ")

        return True

    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        conn.rollback()
        return False
    finally:
        conn.close()

if __name__ == "__main__":
    update_lab_services()
