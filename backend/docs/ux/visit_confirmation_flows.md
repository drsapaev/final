# UX Документация: Потоки подтверждения визитов

## Обзор пользовательского опыта

Система подтверждения визитов обеспечивает удобный и интуитивный процесс для всех участников: врачей, пациентов и регистраторов.

## Основные принципы UX

### 1. Простота и ясность
- Минимальное количество шагов для подтверждения
- Четкие инструкции на каждом этапе
- Понятные сообщения об ошибках

### 2. Мультиканальность
- Поддержка разных способов подтверждения
- Автоматический выбор оптимального канала
- Fallback на телефонное подтверждение

### 3. Безопасность
- Токены с ограниченным временем жизни
- Защита от спама и злоупотреблений
- Аудит всех действий

---

## Пользовательские роли и сценарии

### 👨‍⚕️ Врач

#### Сценарий: Назначение следующего визита

**Цель**: Быстро назначить пациенту следующий визит с автоматическим уведомлением.

**Шаги**:
1. **Поиск пациента**
   - Врач вводит ФИО или телефон пациента
   - Система показывает список совпадений
   - Врач выбирает нужного пациента

2. **Выбор услуг**
   - Отображается список доступных услуг по специальности
   - Врач отмечает нужные услуги
   - Система автоматически рассчитывает стоимость

3. **Настройка визита**
   - Выбор даты и времени
   - Указание типа визита (платный/повторный/льготный)
   - Выбор канала подтверждения

4. **Создание визита**
   - Система генерирует токен подтверждения
   - Отправляется приглашение пациенту
   - Врач получает подтверждение о создании

**UI элементы**:
```
┌─────────────────────────────────────┐
│ 🔍 Поиск пациента                   │
│ [Иванов Иван Иванович          ] 🔍 │
│                                     │
│ 📋 Услуги                          │
│ ☑ Консультация кардиолога          │
│ ☐ ЭКГ                              │
│ ☐ ЭхоКГ                            │
│                                     │
│ 📅 Дата: [26.09.2025] ⏰ [14:30]   │
│                                     │
│ 💰 Тип визита: ○ Платный ● Повторный│
│                                     │
│ 📱 Подтверждение: ● Telegram ○ PWA  │
│                                     │
│ [Отмена]              [Назначить]   │
└─────────────────────────────────────┘
```

---

### 👤 Пациент

#### Сценарий 1: Подтверждение через Telegram

**Цель**: Быстро подтвердить визит в мессенджере.

**Шаги**:
1. **Получение уведомления**
   - Пациент получает сообщение в Telegram
   - Сообщение содержит детали визита
   - Есть кнопки "Подтвердить" и "Отменить"

2. **Подтверждение**
   - Пациент нажимает "Подтвердить"
   - Система мгновенно обрабатывает запрос
   - Отправляется подтверждение с номером в очереди

**Telegram интерфейс**:
```
🏥 Клиника "Здоровье"

📅 Назначен визит на 26.09.2025 в 14:30

👨‍⚕️ Врач: Петров П.П. (Кардиология)
💊 Услуги: Консультация кардиолога
💰 Стоимость: 150,000 сум

⏰ Подтвердите до: 28.09.2025 14:30

[✅ Подтвердить]  [❌ Отменить]
```

После подтверждения:
```
✅ Визит подтвержден!

🎫 Ваш номер в очереди: 15
🏥 Отделение: Кардиология
📍 Приходите за 15 минут до приема

Удачи! 🍀
```

#### Сценарий 2: Подтверждение через PWA

**Цель**: Подтвердить визит через веб-приложение.

**Шаги**:
1. **Переход по ссылке**
   - Пациент получает SMS/Email со ссылкой
   - Переходит по ссылке в браузере
   - Открывается PWA страница подтверждения

2. **Просмотр деталей**
   - Отображается информация о визите
   - Показана стоимость и время
   - Есть кнопка подтверждения

3. **Подтверждение**
   - Пациент вводит номер телефона для верификации
   - Нажимает "Подтвердить визит"
   - Получает номер в очереди

**PWA интерфейс**:
```
┌─────────────────────────────────────┐
│ 🏥 Клиника "Здоровье"               │
│                                     │
│ 📋 Подтверждение визита             │
│                                     │
│ 👤 Пациент: Иванов И.И.             │
│ 📅 Дата: 26 сентября 2025          │
│ ⏰ Время: 14:30                     │
│ 👨‍⚕️ Врач: Петров П.П.               │
│ 🏥 Отделение: Кардиология           │
│                                     │
│ 💊 Услуги:                          │
│ • Консультация кардиолога           │
│                                     │
│ 💰 К оплате: 150,000 сум            │
│                                     │
│ 📱 Телефон для подтверждения:       │
│ [+998 90 123-45-67            ]    │
│                                     │
│ ⏰ Подтвердить до: 28.09.2025 14:30 │
│                                     │
│ [✅ Подтвердить визит]              │
└─────────────────────────────────────┘
```

---

### 👩‍💼 Регистратор

#### Сценарий: Подтверждение по телефону

**Цель**: Помочь пациенту подтвердить визит при звонке в клинику.

**Шаги**:
1. **Поиск визита**
   - Регистратор ищет пациента по ФИО или телефону
   - Система показывает неподтвержденные визиты
   - Выбирается нужный визит

2. **Подтверждение**
   - Регистратор уточняет детали с пациентом
   - Нажимает "Подтвердить по телефону"
   - Вводит комментарий о подтверждении

3. **Результат**
   - Пациент получает номер в очереди
   - Система отправляет SMS с деталями
   - Регистратор информирует пациента

**Интерфейс регистратора**:
```
┌─────────────────────────────────────┐
│ 📞 Подтверждение визитов            │
│                                     │
│ 🔍 Поиск: [Иванов              ] 🔍│
│                                     │
│ 📋 Неподтвержденные визиты:         │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 👤 Иванов Иван Иванович         │ │
│ │ 📅 26.09.2025 14:30             │ │
│ │ 👨‍⚕️ Петров П.П. (Кардиология)   │ │
│ │ 💊 Консультация кардиолога       │ │
│ │ ⏰ Истекает: 28.09.2025 14:30   │ │
│ │                                 │ │
│ │ 📝 Комментарий:                 │ │
│ │ [Подтверждено по телефону     ] │ │
│ │                                 │ │
│ │ [✅ Подтвердить]               │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## Состояния и переходы

### Диаграмма состояний визита

```
┌─────────────────┐
│ Врач назначает  │
│     визит       │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐    ⏰ Истек срок    ┌─────────────────┐
│ Ожидает         │ ──────────────────▶ │   Отменен       │
│ подтверждения   │                     │  (автоматически)│
└─────────┬───────┘                     └─────────────────┘
          │
          │ ✅ Подтвержден
          ▼
┌─────────────────┐
│  Подтвержден    │
└─────────┬───────┘
          │
          │ 🌅 Утреннее присвоение / Сегодня
          ▼
┌─────────────────┐    👨‍⚕️ Врач вызвал   ┌─────────────────┐
│ Открыт (номер   │ ──────────────────▶ │   В процессе    │
│ в очереди выдан)│                     │                 │
└─────────────────┘                     └─────────┬───────┘
                                                  │
                                                  │ ✅ Завершен
                                                  ▼
                                        ┌─────────────────┐
                                        │   Завершен      │
                                        └─────────────────┘
```

---

## Уведомления и обратная связь

### Типы уведомлений

#### 1. Приглашение к подтверждению
- **Канал**: Telegram, SMS, Email
- **Содержание**: Детали визита, срок подтверждения, кнопки действий
- **Время отправки**: Сразу после назначения

#### 2. Подтверждение получено
- **Канал**: Тот же, что использовался для подтверждения
- **Содержание**: Номер в очереди, время прихода, инструкции
- **Время отправки**: Сразу после подтверждения

#### 3. Напоминание о визите
- **Канал**: SMS, Push-уведомление
- **Содержание**: Напоминание о визите завтра, номер в очереди
- **Время отправки**: Вечер накануне визита

#### 4. Уведомление о вызове
- **Канал**: SMS, Push-уведомление, табло в клинике
- **Содержание**: "Ваша очередь, проходите в кабинет №X"
- **Время отправки**: Когда врач вызывает пациента

### Шаблоны сообщений

#### Telegram приглашение
```
🏥 **Клиника "Здоровье"**

Здравствуйте, {patient_name}!

📅 Вам назначен визит на **{visit_date}** в **{visit_time}**

👨‍⚕️ **Врач**: {doctor_name} ({department})
💊 **Услуги**: {services_list}
💰 **Стоимость**: {total_amount} сум

⏰ **Подтвердите до**: {expires_at}

Нажмите кнопку ниже для подтверждения:
```

#### SMS подтверждение
```
✅ Визит подтвержден!
🎫 Номер в очереди: {queue_number}
📅 {visit_date} в {visit_time}
🏥 {department}
Приходите за 15 мин до приема.
Клиника "Здоровье"
```

---

## Обработка ошибок

### Пользовательские ошибки

#### 1. Истекший токен
**Сообщение**: "⏰ Срок подтверждения истек. Обратитесь к врачу для назначения нового визита."
**Действия**: Кнопка "Связаться с клиникой"

#### 2. Уже подтвержденный визит
**Сообщение**: "✅ Этот визит уже подтвержден. Ваш номер в очереди: {queue_number}"
**Действия**: Показать детали подтверждения

#### 3. Превышен лимит попыток
**Сообщение**: "🚫 Слишком много попыток подтверждения. Попробуйте через 15 минут или позвоните в клинику."
**Действия**: Показать телефон клиники

#### 4. Технические проблемы
**Сообщение**: "⚠️ Временные технические проблемы. Попробуйте позже или позвоните в клинику."
**Действия**: Кнопка "Повторить", телефон клиники

### Fallback сценарии

#### 1. Telegram недоступен
- Автоматическая отправка SMS со ссылкой на PWA
- Уведомление врача о проблеме с доставкой

#### 2. PWA не работает
- Отображение телефона клиники
- Инструкция для звонка регистратору

#### 3. Все каналы недоступны
- Автоматическое уведомление администратора
- Визит остается в статусе "ожидает подтверждения"
- Регистратор может подтвердить вручную

---

## Метрики и аналитика

### KPI подтверждения визитов

#### 1. Скорость подтверждения
- **Цель**: 80% визитов подтверждается в течение 2 часов
- **Измерение**: Время от отправки приглашения до подтверждения

#### 2. Процент подтверждений
- **Цель**: 90% назначенных визитов подтверждается
- **Измерение**: Отношение подтвержденных к назначенным

#### 3. Распределение по каналам
- **Telegram**: 60%
- **PWA**: 25%
- **Телефон (регистратор)**: 15%

#### 4. Показатель отмен
- **Цель**: Менее 5% подтвержденных визитов отменяется
- **Измерение**: Отношение отмененных к подтвержденным

### Дашборд для администратора

```
┌─────────────────────────────────────────────────────────┐
│ 📊 Аналитика подтверждения визитов                      │
│                                                         │
│ 📅 Сегодня                                              │
│ ├─ Назначено визитов: 45                               │
│ ├─ Подтверждено: 38 (84%)                              │
│ ├─ Ожидает подтверждения: 7                            │
│ └─ Истекло/отменено: 0                                 │
│                                                         │
│ ⏱️ Среднее время подтверждения: 1ч 23м                  │
│                                                         │
│ 📱 По каналам:                                          │
│ ├─ Telegram: 23 (61%)                                  │
│ ├─ PWA: 9 (24%)                                        │
│ └─ Телефон: 6 (15%)                                    │
│                                                         │
│ 🎯 Цели:                                               │
│ ├─ Процент подтверждений: 84% / 90% 🟡                 │
│ ├─ Время подтверждения: 1ч 23м / 2ч ✅                 │
│ └─ Отмены: 2% / 5% ✅                                   │
└─────────────────────────────────────────────────────────┘
```

---

## Рекомендации по улучшению UX

### Краткосрочные улучшения (1-2 недели)

1. **Персонализация сообщений**
   - Использование имени пациента
   - Адаптация под предпочтения канала

2. **Улучшение мобильного интерфейса**
   - Оптимизация для маленьких экранов
   - Упрощение форм ввода

3. **Быстрые действия**
   - Кнопки "Подтвердить все" для нескольких визитов
   - Горячие клавиши для врачей

### Среднесрочные улучшения (1-2 месяца)

1. **Умные уведомления**
   - Анализ активности пациента
   - Оптимальное время отправки

2. **Интеграция с календарем**
   - Добавление в Google Calendar
   - Синхронизация с Outlook

3. **Голосовые уведомления**
   - Автоматические звонки
   - Голосовое подтверждение

### Долгосрочные улучшения (3-6 месяцев)

1. **ИИ-помощник**
   - Чат-бот для ответов на вопросы
   - Автоматическое перенесение визитов

2. **Предиктивная аналитика**
   - Прогноз вероятности подтверждения
   - Оптимизация расписания врачей

3. **Мультиязычность**
   - Поддержка узбекского языка
   - Автоматическое определение языка
