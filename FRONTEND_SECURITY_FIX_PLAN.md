# –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2025-12-06
**–í–µ—Ä—Å–∏—è:** 1.0
**–ü—Ä–æ–µ–∫—Ç:** Medical Clinic Management System
**–°—Ç–∞—Ç—É—Å:** –í –æ–∂–∏–¥–∞–Ω–∏–∏ —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
2. [–≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (0-3 –¥–Ω—è)](#—ç—Ç–∞–ø-1-–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è-0-3-–¥–Ω—è)
3. [–≠—Ç–∞–ø 2: –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-2 –Ω–µ–¥–µ–ª–∏)](#—ç—Ç–∞–ø-2-–≤—ã—Å–æ–∫–∏–π-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-1-2-–Ω–µ–¥–µ–ª–∏)
4. [–≠—Ç–∞–ø 3: –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (2-4 –Ω–µ–¥–µ–ª–∏)](#—ç—Ç–∞–ø-3-—Å—Ä–µ–¥–Ω–∏–π-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç-2-4-–Ω–µ–¥–µ–ª–∏)
5. [–≠—Ç–∞–ø 4: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-3 –º–µ—Å—è—Ü–∞)](#—ç—Ç–∞–ø-4-–¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ-—É–ª—É—á—à–µ–Ω–∏—è-1-3-–º–µ—Å—è—Ü–∞)
6. [–ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è](#–ø–ª–∞–Ω-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
7. [–ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è](#–∫—Ä–∏—Ç–µ—Ä–∏–∏-–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è)

---

## –û–±–∑–æ—Ä

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –°—Ç–∞—Ç—É—Å |
|-----------|------------|--------|
| CRITICAL  | 8          | ‚è≥ –û–∂–∏–¥–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| HIGH      | 12         | ‚è≥ –û–∂–∏–¥–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| MEDIUM    | 6          | ‚è≥ –û–∂–∏–¥–∞–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| LOW       | 15+        | üìã –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ |

### –û—Ü–µ–Ω–∫–∞ —Ç—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç

- **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** 2-3 –¥–Ω—è
- **–í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 2 –Ω–µ–¥–µ–ª–∏
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 2-4 –Ω–µ–¥–µ–ª–∏
- **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ:** 1-3 –º–µ—Å—è—Ü–∞
- **–ò–¢–û–ì–û:** ~2-3 –º–µ—Å—è—Ü–∞ –¥–æ –ø–æ–ª–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è HIPAA

---

## –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (0-3 –¥–Ω—è)

> **–°–†–û–ö:** –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–≤ —Ç–µ—á–µ–Ω–∏–µ 48 —á–∞—Å–æ–≤)
> **–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–´–ô:** Frontend Team Lead
> **–ë–õ–û–ö–ò–†–£–ï–¢:** –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç

---

### 1.1. –£–¥–∞–ª–∏—Ç—å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL
**–í—Ä–µ–º—è:** 1 —á–∞—Å
**–§–∞–π–ª—ã:** `frontend/src/components/auth/LoginFormStyled.jsx`

#### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// –°—Ç—Ä–æ–∫–∏ 35-36, 66-67
const [formData, setFormData] = useState({
  username: 'admin@example.com',  // ‚ùå –ö–†–ò–¢–ò–ß–ù–û
  password: 'admin123',             // ‚ùå –ö–†–ò–¢–ò–ß–ù–û
  loginType: 'username'
});

// –°—Ç—Ä–æ–∫–∏ 66-67 - –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ fallback
const username = formData.username || 'admin@example.com';  // ‚ùå
const password = formData.password || 'admin123';            // ‚ùå
```

#### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1:** –£–¥–∞–ª–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

```javascript
// ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï
const [formData, setFormData] = useState({
  username: '',  // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
  password: '',  // –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞
  loginType: 'username'
});
```

**–®–∞–≥ 2:** –£–¥–∞–ª–∏—Ç—å fallback –ª–æ–≥–∏–∫—É

```javascript
// ‚ùå –£–î–ê–õ–ò–¢–¨ —Å—Ç—Ä–æ–∫–∏ 66-67
// const username = formData.username || 'admin@example.com';
// const password = formData.password || 'admin123';

// ‚úÖ –ó–ê–ú–ï–ù–ò–¢–¨ –Ω–∞
const username = formData.username;
const password = formData.password;

// –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é
if (!username || !password) {
  setError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å');
  setLoading(false);
  return;
}
```

**–®–∞–≥ 3 (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):** –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```javascript
// .env.development (–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å!)
VITE_DEV_USERNAME=admin@example.com
VITE_DEV_PASSWORD=admin123

// –í –∫–æ–¥–µ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
const [formData, setFormData] = useState({
  username: import.meta.env.MODE === 'development'
    ? (import.meta.env.VITE_DEV_USERNAME || '')
    : '',
  password: import.meta.env.MODE === 'development'
    ? (import.meta.env.VITE_DEV_PASSWORD || '')
    : '',
  loginType: 'username'
});
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –í production build –Ω–µ—Ç –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö credentials
- [ ] –§–æ—Ä–º–∞ –ª–æ–≥–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—É—Å—Ç—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –ø—É—Å—Ç—ã—Ö –ø–æ–ª–µ–π
- [ ] `.env.development` –¥–æ–±–∞–≤–ª–µ–Ω –≤ `.gitignore`

---

### 1.2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–µ–π —Ç–æ–∫–µ–Ω–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞
**–§–∞–π–ª—ã:** `services/auth.js`, `api/ws.js`, `api/client.js`, `utils/api.js`, `utils/queueApi.js`

#### –ü—Ä–æ–±–ª–µ–º–∞

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è 3 —Ä–∞–∑–Ω—ã—Ö –∫–ª—é—á–∞ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞:
- `auth_token` (–≤ api/client.js)
- `token` (–≤ services/auth.js) ‚ùå
- `access_token` (–≤ api/ws.js) ‚ùå

#### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1:** –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –º–æ–¥—É–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞–º–∏

```javascript
// frontend/src/utils/tokenManager.js (–ù–û–í–´–ô –§–ê–ô–õ)

const TOKEN_KEY = 'auth_token';
const REFRESH_TOKEN_KEY = 'refresh_token';
const USER_KEY = 'user';

/**
 * –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏
 */
export const tokenManager = {
  // –ü–æ–ª—É—á–∏—Ç—å access token
  getAccessToken() {
    return localStorage.getItem(TOKEN_KEY);
  },

  // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å access token
  setAccessToken(token) {
    if (token) {
      localStorage.setItem(TOKEN_KEY, token);
    } else {
      localStorage.removeItem(TOKEN_KEY);
    }
  },

  // –ü–æ–ª—É—á–∏—Ç—å refresh token
  getRefreshToken() {
    return localStorage.getItem(REFRESH_TOKEN_KEY);
  },

  // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å refresh token
  setRefreshToken(token) {
    if (token) {
      localStorage.setItem(REFRESH_TOKEN_KEY, token);
    } else {
      localStorage.removeItem(REFRESH_TOKEN_KEY);
    }
  },

  // –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–æ–∫–µ–Ω—ã
  clearAll() {
    localStorage.removeItem(TOKEN_KEY);
    localStorage.removeItem(REFRESH_TOKEN_KEY);
    localStorage.removeItem(USER_KEY);
  },

  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Ç–æ–∫–µ–Ω–∞
  hasToken() {
    return !!this.getAccessToken();
  }
};
```

**–®–∞–≥ 2:** –û–±–Ω–æ–≤–∏—Ç—å `services/auth.js`

```javascript
// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 67)
localStorage.setItem('token', response.data.access_token); // ‚ùå

// –°–¢–ê–õ–û
import { tokenManager } from '../utils/tokenManager';

// –°—Ç—Ä–æ–∫–∞ 67
tokenManager.setAccessToken(response.data.access_token); // ‚úÖ

// –°—Ç—Ä–æ–∫–∞ 102 - isAuthenticated()
isAuthenticated() {
  return tokenManager.hasToken(); // ‚úÖ
}
```

**–®–∞–≥ 3:** –û–±–Ω–æ–≤–∏—Ç—å `api/ws.js`

```javascript
// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 67)
const token = localStorage.getItem('access_token'); // ‚ùå

// –°–¢–ê–õ–û
import { tokenManager } from '../utils/tokenManager';

const token = tokenManager.getAccessToken(); // ‚úÖ
```

**–®–∞–≥ 4:** –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã

–§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
- `utils/api.js` - –∑–∞–º–µ–Ω–∏—Ç—å `localStorage.getItem('auth_token')`
- `utils/queueApi.js` - –∑–∞–º–µ–Ω–∏—Ç—å `localStorage.getItem('access_token')`
- `utils/websocketAuth.js` - –∑–∞–º–µ–Ω–∏—Ç—å `localStorage.getItem('access_token')`
- `components/dashboard/Dashboard.jsx` - –∑–∞–º–µ–Ω–∏—Ç—å `localStorage.getItem('access_token')`
- `components/common/ScheduleNextModal.jsx` (3 –º–µ—Å—Ç–∞) - –∑–∞–º–µ–Ω–∏—Ç—å `localStorage.getItem('access_token')`
- `hooks/useApi.js` - –∑–∞–º–µ–Ω–∏—Ç—å `localStorage.getItem('access_token')`

**–®–∞–≥ 5:** –û–±–Ω–æ–≤–∏—Ç—å `api/interceptors.js`

```javascript
// –°—Ç—Ä–æ–∫–∞ 15, 74, 96, 126, 207
import { tokenManager } from '../utils/tokenManager';

// –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ
localStorage.getItem('auth_token') ‚Üí tokenManager.getAccessToken()
localStorage.getItem('refresh_token') ‚Üí tokenManager.getRefreshToken()
localStorage.setItem('auth_token', ...) ‚Üí tokenManager.setAccessToken(...)
localStorage.removeItem('auth_token') ‚Üí tokenManager.clearAll()
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –°–æ–∑–¥–∞–Ω `utils/tokenManager.js`
- [ ] –í—Å–µ 82 —Ñ–∞–π–ª–∞ —Å localStorage –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∫–ª—é—á `auth_token`
- [ ] –¢–µ—Å—Ç—ã –ª–æ–≥–∏–Ω–∞/–ª–æ–≥–∞—É—Ç–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### 1.3. –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL (HIPAA VIOLATION)
**–í—Ä–µ–º—è:** 4 —á–∞—Å–∞
**–§–∞–π–ª—ã:** 100+ —Ñ–∞–π–ª–æ–≤ —Å console.log

#### –ü—Ä–æ–±–ª–µ–º–∞

510 console.log statements, –º–Ω–æ–≥–∏–µ –ª–æ–≥–∏—Ä—É—é—Ç PHI (Protected Health Information)

#### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1:** –°–æ–∑–¥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

```javascript
// frontend/src/utils/logger.js (–ù–û–í–´–ô –§–ê–ô–õ)

const isDevelopment = import.meta.env.MODE === 'development';

/**
 * –°–ø–∏—Å–æ–∫ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∏
 */
const SENSITIVE_FIELDS = [
  'password', 'token', 'access_token', 'refresh_token',
  'patient_name', 'full_name', 'phone', 'email',
  'passport', 'diagnosis', 'complaints', 'anamnesis',
  'examination', 'medical_history', 'treatment_plan',
  'medications', 'allergies', 'lab_results'
];

/**
 * –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
 */
function sanitizeData(data) {
  if (!data || typeof data !== 'object') return data;

  const sanitized = Array.isArray(data) ? [...data] : { ...data };

  Object.keys(sanitized).forEach(key => {
    const lowerKey = key.toLowerCase();

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
    const isSensitive = SENSITIVE_FIELDS.some(field =>
      lowerKey.includes(field.toLowerCase())
    );

    if (isSensitive) {
      sanitized[key] = '[REDACTED]';
    } else if (typeof sanitized[key] === 'object') {
      sanitized[key] = sanitizeData(sanitized[key]);
    }
  });

  return sanitized;
}

/**
 * –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
 */
export const logger = {
  log(...args) {
    if (isDevelopment) {
      const sanitized = args.map(arg => sanitizeData(arg));
      console.log(...sanitized);
    }
  },

  warn(...args) {
    if (isDevelopment) {
      const sanitized = args.map(arg => sanitizeData(arg));
      console.warn(...sanitized);
    }
  },

  error(...args) {
    // –û—à–∏–±–∫–∏ –≤—Å–µ–≥–¥–∞ –ª–æ–≥–∏—Ä—É–µ–º, –Ω–æ —Å –º–∞—Å–∫–∏—Ä–æ–≤–∫–æ–π
    const sanitized = args.map(arg => sanitizeData(arg));
    console.error(...sanitized);
  },

  debug(...args) {
    if (isDevelopment) {
      const sanitized = args.map(arg => sanitizeData(arg));
      console.debug(...sanitized);
    }
  }
};
```

**–®–∞–≥ 2:** –ó–∞–º–µ–Ω–∏—Ç—å console.log –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö

```javascript
// api/interceptors.js
import { logger } from '../utils/logger';

// –°—Ç—Ä–æ–∫–∞ 22, 31, 41, 63 –∏ —Ç.–¥.
// –ë–´–õ–û
console.log(`üîÑ API Request:`, { params: config.params, data: config.data });

// –°–¢–ê–õ–û
logger.log(`üîÑ API Request:`, {
  url: config.url,
  method: config.method,
  // params –∏ data –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—Å—Ç—è—Ç—Å—è –æ—Ç PHI
  params: config.params,
  data: config.data
});
```

**–®–∞–≥ 3:** –£–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ –∏–∑ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```javascript
// components/medical/EMRSystem.jsx

// –£–î–ê–õ–ò–¢–¨ —Å—Ç—Ä–æ–∫–∏ 196, 215, 723
// console.log('[Dental EMR] Tooth ${toothNumber} clicked:', toothData); ‚ùå

// –ï—Å–ª–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏:
logger.debug('[Dental EMR] Tooth interaction', {
  toothNumber,
  // toothData –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ sanitized
});
```

**–®–∞–≥ 4:** –û–±–Ω–æ–≤–∏—Ç—å vite.config.js

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤ production console.log —É–¥–∞–ª—è—é—Ç—Å—è:

```javascript
// vite.config.js - —Å—Ç—Ä–æ–∫–∏ 154-159 (–£–ñ–ï –ï–°–¢–¨, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)
terserOptions: {
  compress: {
    drop_console: true,      // ‚úÖ –£–¥–∞–ª—è—Ç—å console.log
    drop_debugger: true      // ‚úÖ –£–¥–∞–ª—è—Ç—å debugger
  }
}
```

**–®–∞–≥ 5:** –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å ESLint

```javascript
// .eslintrc.cjs –∏–ª–∏ eslint.config.js
{
  rules: {
    'no-console': ['error', {
      allow: ['error', 'warn'] // –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ error –∏ warn
    }]
  }
}
```

#### –§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ):**
1. `components/medical/EMRSystem.jsx` - —É–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ PHI
2. `components/medical/EMRInterface.jsx` - —É–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏ PHI
3. `components/laboratory/LabResultsManager.jsx` - —É–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏
4. `components/cardiology/ECGViewer.jsx` - —É–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏
5. `components/dermatology/PhotoUploader.jsx` - —É–¥–∞–ª–∏—Ç—å –ª–æ–≥–∏
6. `api/interceptors.js` - –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ logger
7. `api/client.js` - –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ logger

**–û—Å—Ç–∞–ª—å–Ω—ã–µ (100+ —Ñ–∞–π–ª–æ–≤):**
- –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –∑–∞–º–µ–Ω–∞ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ESLint + –∞–≤—Ç–æ—Ñ–∏–∫—Å

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –°–æ–∑–¥–∞–Ω `utils/logger.js` —Å sanitizeData
- [ ] –í—Å–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç logger
- [ ] –í production build –Ω–µ—Ç console.log (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ build)
- [ ] ESLint –ø—Ä–∞–≤–∏–ª–æ `no-console` –∞–∫—Ç–∏–≤–Ω–æ
- [ ] –¢–µ—Å—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ PHI –≤ –ª–æ–≥–∞—Ö

---

### 1.4. –û–±–Ω–æ–≤–∏—Ç—å —É—è–∑–≤–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL
**–í—Ä–µ–º—è:** 1 —á–∞—Å
**–§–∞–π–ª—ã:** `package.json`

#### –ü—Ä–æ–±–ª–µ–º–∞

10 npm —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π:
- axios@1.11.0 ‚Üí DoS vulnerability (CVSS 7.5)
- vite@4.3.9 ‚Üí 6 file disclosure vulnerabilities
- @playwright/test@1.48.0 ‚Üí security issue
- esbuild@0.17.19 ‚Üí CORS bypass

#### –†–µ—à–µ–Ω–∏–µ

```bash
cd frontend

# –û–±–Ω–æ–≤–∏—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
npm install axios@latest
npm install vite@latest
npm install @playwright/test@latest
npm install esbuild@latest
npm install eslint@latest

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —É—è–∑–≤–∏–º–æ—Å—Ç–∏
npm audit

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∞–≤—Ç–æ—Ñ–∏–∫—Å
npm audit fix

# –î–ª—è major –≤–µ—Ä—Å–∏–π (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ, –º–æ–≥—É—Ç –±—ã—Ç—å breaking changes)
npm audit fix --force

# –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å!
npm run test
npm run build
npm run preview
```

#### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ package.json

```json
{
  "dependencies": {
    "axios": "^1.13.2",  // –±—ã–ª–æ 1.11.0
    // –æ—Å—Ç–∞–ª—å–Ω–æ–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
  },
  "devDependencies": {
    "@playwright/test": "^1.57.0",  // –±—ã–ª–æ 1.48.0
    "esbuild": "^0.24.3",           // –±—ã–ª–æ 0.17.19
    "eslint": "^9.39.1",            // –±—ã–ª–æ 9.16.0
    "vite": "^4.5.14"               // –±—ã–ª–æ 4.3.9
  }
}
```

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **Axios:** API –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç
2. **Vite:** Dev server –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, build —É—Å–ø–µ—à–µ–Ω
3. **Playwright:** E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
4. **ESLint:** –õ–∏–Ω—Ç–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] `npm audit` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 0 critical/high —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
- [ ] Dev server –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] Production build —É—Å–ø–µ—à–µ–Ω
- [ ] E2E —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ù–µ—Ç breaking changes –≤ API

---

### 1.5. –ò—Å–ø—Ä–∞–≤–∏—Ç—å —É—Ç–µ—á–∫–∏ –ø–∞–º—è—Ç–∏ —Å blob URLs

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL
**–í—Ä–µ–º—è:** 2 —á–∞—Å–∞
**–§–∞–π–ª—ã:** `components/medical/EMRSystem.jsx`, `components/dermatology/PhotoUploader.jsx`

#### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// –°–æ–∑–¥–∞—ë—Ç—Å—è blob URL, –Ω–æ –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç—Å—è
<img src={URL.createObjectURL(attachment.file)} />
```

–ü—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ 50+ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä –º–æ–∂–µ—Ç —É–ø–∞—Å—Ç—å.

#### –†–µ—à–µ–Ω–∏–µ

**–í–∞—Ä–∏–∞–Ω—Ç 1: Custom Hook –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Blob URLs**

```javascript
// frontend/src/hooks/useBlobURL.js (–ù–û–í–´–ô –§–ê–ô–õ)
import { useEffect, useState } from 'react';

/**
 * Hook –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Blob URLs
 * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—á–∏—â–∞–µ—Ç URL –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 */
export function useBlobURL(file) {
  const [blobURL, setBlobURL] = useState(null);

  useEffect(() => {
    if (!file) {
      setBlobURL(null);
      return;
    }

    // –°–æ–∑–¥–∞—ë–º blob URL
    const url = URL.createObjectURL(file);
    setBlobURL(url);

    // Cleanup —Ñ—É–Ω–∫—Ü–∏—è - –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
    return () => {
      URL.revokeObjectURL(url);
    };
  }, [file]);

  return blobURL;
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ EMRSystem.jsx:**

```javascript
// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 1102)
{attachments.map((attachment, idx) => (
  <div key={idx}>
    <img src={URL.createObjectURL(attachment.file)} /> {/* ‚ùå –£–¢–ï–ß–ö–ê */}
  </div>
))}

// –°–¢–ê–õ–û
import { useBlobURL } from '../../hooks/useBlobURL';

// –í–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
function AttachmentPreview({ file, name }) {
  const blobURL = useBlobURL(file); // ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞

  if (!blobURL) return <div>–ó–∞–≥—Ä—É–∑–∫–∞...</div>;

  return (
    <div>
      <img src={blobURL} alt={name} />
    </div>
  );
}

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
{attachments.map((attachment, idx) => (
  <AttachmentPreview
    key={idx}
    file={attachment.file}
    name={attachment.name}
  />
))}
```

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —Ä—É—á–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º**

```javascript
// –î–ª—è PhotoUploader.jsx (—Å—Ç—Ä–æ–∫–∞ 342)
import { useEffect, useState } from 'react';

function PhotoPreview({ photo }) {
  const [previewURL, setPreviewURL] = useState(null);

  useEffect(() => {
    if (photo.file) {
      const url = URL.createObjectURL(photo.file);
      setPreviewURL(url);

      return () => {
        URL.revokeObjectURL(url);
      };
    } else if (photo.preview) {
      setPreviewURL(photo.preview);
    }
  }, [photo]);

  return (
    <img
      src={previewURL}
      alt={photo.zone || 'Preview'}
    />
  );
}
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –°–æ–∑–¥–∞–Ω hook `useBlobURL.js`
- [ ] EMRSystem.jsx –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π preview
- [ ] PhotoUploader.jsx –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—ã–π preview
- [ ] Memory profiler –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- [ ] –ú–æ–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å 100+ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –±–µ–∑ –∫—Ä–∞—à–∞

---

### 1.6. –£–±—Ä–∞—Ç—å –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL (HIPAA)
**–í—Ä–µ–º—è:** 30 –º–∏–Ω—É—Ç
**–§–∞–π–ª—ã:** `components/medical/EMRInterface.jsx`

#### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// –°—Ç—Ä–æ–∫–∏ 108-149
const mockPatients = [
  {
    id: 1,
    full_name: '–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á',  // ‚ùå PII
    phone: '+7 (999) 123-45-67',        // ‚ùå PII
    email: 'ivanov@example.com'         // ‚ùå PII
  }
];
```

#### –†–µ—à–µ–Ω–∏–µ

```javascript
// –£–î–ê–õ–ò–¢–¨ –≤–µ—Å—å –±–ª–æ–∫ mockPatients

// –ó–ê–ú–ï–ù–ò–¢–¨ –Ω–∞ –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –∏–ª–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
const mockPatients = import.meta.env.MODE === 'development'
  ? generateMockPatients(10) // –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  : [];

// –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
function generateMockPatients(count) {
  return Array.from({ length: count }, (_, i) => ({
    id: i + 1,
    full_name: `–ü–∞—Ü–∏–µ–Ω—Ç ${i + 1}`,
    phone: `+7 (900) ${String(i).padStart(7, '0')}`,
    email: `patient${i}@test.local`
  }));
}
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –§–ò–û –≤ –∫–æ–¥–µ
- [ ] –ù–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤/email
- [ ] –í production mockPatients = []
- [ ] Git history –ø—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

### 1.7. –ò—Å–ø—Ä–∞–≤–∏—Ç—å client-side file validation

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî¥ CRITICAL
**–í—Ä–µ–º—è:** 3 —á–∞—Å–∞
**–§–∞–π–ª—ã:** `components/medical/EMRSystem.jsx`, `components/dermatology/PhotoUploader.jsx`, `components/files/FileManager.jsx`

#### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// –¢–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è - –ª–µ–≥–∫–æ –æ–±–æ–π—Ç–∏
<input accept="image/*,.pdf,.doc,.docx" />
if (file.type === 'image/heic') { ... }
```

–ê—Ç–∞–∫—É—é—â–∏–π –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∑–∏—Ç—å `malware.exe` —Å MIME type `image/jpeg`.

#### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1: –£—Å–∏–ª–µ–Ω–Ω–∞—è –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**

```javascript
// frontend/src/utils/fileValidator.js (–ù–û–í–´–ô –§–ê–ô–õ)

/**
 * –†–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ MIME types –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤
 */
const ALLOWED_MIME_TYPES = {
  images: [
    'image/jpeg',
    'image/jpg',
    'image/png',
    'image/gif',
    'image/heic',
    'image/heif',
    'image/webp'
  ],
  documents: [
    'application/pdf',
    'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document'
  ],
  medical: [
    'text/xml',           // ECG
    'application/dicom',  // Medical imaging
    'text/csv',           // Lab results
    'application/vnd.ms-excel',
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
  ]
};

/**
 * Magic numbers (—Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏
 */
const FILE_SIGNATURES = {
  'image/jpeg': ['FFD8FF'],
  'image/png': ['89504E47'],
  'application/pdf': ['25504446'],
  'application/zip': ['504B0304'],
  // –î–æ–±–∞–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ
};

/**
 * –ß—Ç–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö –±–∞–π—Ç–æ–≤ —Ñ–∞–π–ª–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã
 */
async function readFileSignature(file, bytesToRead = 4) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = (e) => {
      const arr = new Uint8Array(e.target.result);
      const hex = Array.from(arr)
        .map(b => b.toString(16).padStart(2, '0').toUpperCase())
        .join('');
      resolve(hex);
    };
    reader.onerror = reject;
    reader.readAsArrayBuffer(file.slice(0, bytesToRead));
  });
}

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–∞ –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é, MIME type –∏ magic numbers
 */
export async function validateFile(file, allowedCategories = ['images']) {
  const errors = [];

  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ (–º–∞–∫—Å–∏–º—É–º 50MB –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤)
  const MAX_SIZE = 50 * 1024 * 1024;
  if (file.size > MAX_SIZE) {
    errors.push(`–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º—É–º ${MAX_SIZE / 1024 / 1024}MB`);
  }

  // 2. –ü–æ–ª—É—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω—ã–µ MIME types
  const allowedTypes = allowedCategories.flatMap(cat =>
    ALLOWED_MIME_TYPES[cat] || []
  );

  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME type
  if (!allowedTypes.includes(file.type)) {
    errors.push(`–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞: ${file.type}`);
  }

  // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
  const ext = file.name.split('.').pop().toLowerCase();
  const validExtensions = {
    'image/jpeg': ['jpg', 'jpeg'],
    'image/png': ['png'],
    'image/heic': ['heic'],
    'application/pdf': ['pdf'],
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ
  };

  const expectedExts = validExtensions[file.type] || [];
  if (expectedExts.length > 0 && !expectedExts.includes(ext)) {
    errors.push(`–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ ${ext} –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø—É ${file.type}`);
  }

  // 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ magic numbers (—Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —Ñ–∞–π–ª–∞)
  try {
    const signature = await readFileSignature(file);
    const expectedSig = FILE_SIGNATURES[file.type];

    if (expectedSig) {
      const matches = expectedSig.some(sig => signature.startsWith(sig));
      if (!matches) {
        errors.push('–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∑–∞—è–≤–ª–µ–Ω–Ω–æ–º—É —Ç–∏–ø—É (magic number mismatch)');
      }
    }
  } catch (err) {
    errors.push('–ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏');
  }

  return {
    valid: errors.length === 0,
    errors
  };
}
```

**–®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ PhotoUploader.jsx**

```javascript
import { validateFile } from '../../utils/fileValidator';

async function handleFileSelect(files) {
  for (const file of files) {
    // –£—Å–∏–ª–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
    const validation = await validateFile(file, ['images']);

    if (!validation.valid) {
      setError(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ ${file.name}:\n${validation.errors.join('\n')}`);
      continue;
    }

    // –§–∞–π–ª –ø—Ä–æ—à—ë–ª –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
    // –ù–æ –°–ï–†–í–ï–†–ù–ê–Ø –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å—ë —Ä–∞–≤–Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞!
    uploadFile(file);
  }
}
```

**–®–∞–≥ 3: –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é (Backend)**

> **–í–ê–ñ–ù–û:** –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞! –ù—É–∂–Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞.

–°–æ–∑–¥–∞—Ç—å –∑–∞–¥–∞—á—É –¥–ª—è backend team:

```markdown
## Backend Task: Implement Server-Side File Validation

**Endpoint:** `/api/v1/files/upload`

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME type —á–µ—Ä–µ–∑ libmagic/python-magic
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ file signature (magic numbers)
3. –ê–Ω—Ç–∏–≤–∏—Ä—É—Å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (ClamAV)
4. –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞
5. Sanitization –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
6. –ò–∑–æ–ª—è—Ü–∏—è uploaded files –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

**–ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (Python):**
```python
import magic
from werkzeug.utils import secure_filename

def validate_uploaded_file(file):
    # 1. Secure filename
    filename = secure_filename(file.filename)

    # 2. Check file signature
    mime = magic.from_buffer(file.read(1024), mime=True)
    file.seek(0)

    ALLOWED_TYPES = ['image/jpeg', 'image/png', 'application/pdf']
    if mime not in ALLOWED_TYPES:
        raise ValidationError(f"Invalid file type: {mime}")

    # 3. –ê–Ω—Ç–∏–≤–∏—Ä—É—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    # scan_with_clamav(file)

    return True
```
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –°–æ–∑–¥–∞–Ω `utils/fileValidator.js`
- [ ] –í—Å–µ upload –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç validateFile()
- [ ] Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] –¢–µ—Å—Ç: –ø–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ .exe —Å MIME image/jpeg –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è
- [ ] –¢–µ—Å—Ç: –≤–∞–ª–∏–¥–Ω—ã–π JPEG –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ

---

## –≠—Ç–∞–ø 2: –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-2 –Ω–µ–¥–µ–ª–∏)

> **–°–†–û–ö:** 2 –Ω–µ–¥–µ–ª–∏
> **–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–´–ô:** Frontend + Backend Teams
> **–ë–õ–û–ö–ò–†–£–ï–¢:** HIPAA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

---

### 2.1. –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å localStorage –Ω–∞ httpOnly cookies

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH
**–í—Ä–µ–º—è:** 3 –¥–Ω—è
**–§–∞–π–ª—ã:** –í–µ—Å—å authentication flow

#### –ü—Ä–æ–±–ª–µ–º–∞

–¢–æ–∫–µ–Ω—ã –≤ localStorage –¥–æ—Å—Ç—É–ø–Ω—ã JavaScript ‚Üí XSS –∞—Ç–∞–∫–∏ –º–æ–≥—É—Ç —É–∫—Ä–∞—Å—Ç—å —Ç–æ–∫–µ–Ω—ã.

#### –†–µ—à–µ–Ω–∏–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**

1. **Access token:** httpOnly cookie (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º)
2. **Refresh token:** httpOnly cookie (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º)
3. **User profile:** localStorage (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞)

**–®–∞–≥ 1: Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è**

```python
# backend/app/api/v1/endpoints/authentication.py

from fastapi import Response

@router.post("/login")
async def login(
    response: Response,  # –î–æ–±–∞–≤–∏—Ç—å Response
    credentials: LoginRequest
):
    # ... –ø—Ä–æ–≤–µ—Ä–∫–∞ credentials ...

    access_token = create_access_token(user.id)
    refresh_token = create_refresh_token(user.id)

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º httpOnly cookies –≤–º–µ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ JSON
    response.set_cookie(
        key="access_token",
        value=access_token,
        httponly=True,      # ‚úÖ –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ JS
        secure=True,        # ‚úÖ –¢–æ–ª—å–∫–æ HTTPS
        samesite="lax",     # ‚úÖ CSRF –∑–∞—â–∏—Ç–∞
        max_age=1800        # 30 –º–∏–Ω—É—Ç
    )

    response.set_cookie(
        key="refresh_token",
        value=refresh_token,
        httponly=True,
        secure=True,
        samesite="lax",
        max_age=604800      # 7 –¥–Ω–µ–π
    )

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ç–æ–ª—å–∫–æ user data
    return {
        "user": user_schema,
        "message": "Login successful"
    }
```

**–®–∞–≥ 2: Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è**

```javascript
// api/client.js - –£–ë–†–ê–¢–¨ —É—Å—Ç–∞–Ω–æ–≤–∫—É —Ç–æ–∫–µ–Ω–æ–≤
async function login(username, password) {
  const resp = await api.post('/auth/login', {
    username,
    password
  }, {
    withCredentials: true  // ‚úÖ –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å cookies
  });

  // –¢–æ–∫–µ–Ω—ã —É–∂–µ –≤ cookies, –Ω–µ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤ localStorage
  // localStorage.setItem('auth_token', ...) ‚ùå –£–î–ê–õ–ò–¢–¨

  return resp.data;
}

// –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –≤–∫–ª—é—á–∞—Ç—å credentials
api.defaults.withCredentials = true;
```

**–®–∞–≥ 3: Interceptors –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**

```javascript
// api/interceptors.js

// –£–î–ê–õ–ò–¢–¨ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ Authorization header
// Cookies –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

api.interceptors.request.use((config) => {
  // Authorization header –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω - cookie –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
  // ‚ùå –£–î–ê–õ–ò–¢–¨: config.headers['Authorization'] = `Bearer ${token}`;

  config.withCredentials = true;  // –í–∫–ª—é—á–∏—Ç—å cookies
  return config;
});

// Response interceptor - refresh —Ç–æ–∫–µ–Ω–∞
api.interceptors.response.use(
  (response) => response,
  async (error) => {
    if (error.response?.status === 401) {
      try {
        // Refresh token —É–∂–µ –≤ cookie, –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ–º endpoint
        await api.post('/auth/refresh', {}, {
          withCredentials: true
        });

        // –ü–æ–≤—Ç–æ—Ä—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        return api(error.config);
      } catch (refreshError) {
        // Refresh failed - redirect to login
        window.location.href = '/login';
      }
    }
    return Promise.reject(error);
  }
);
```

**–®–∞–≥ 4: CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

```python
# backend/app/main.py

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # Frontend URL
    allow_credentials=True,  # ‚úÖ –†–∞–∑—Ä–µ—à–∏—Ç—å cookies
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**–®–∞–≥ 5: CSRF –∑–∞—â–∏—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**

–î–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```python
# Backend: –¥–æ–±–∞–≤–∏—Ç—å CSRF token –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é cookie
response.set_cookie(
    key="csrf_token",
    value=generate_csrf_token(),
    httponly=False,  # –î–æ—Å—Ç—É–ø–Ω–æ JS –¥–ª—è —á—Ç–µ–Ω–∏—è
    secure=True,
    samesite="lax"
)

# Frontend: –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å CSRF token –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ
api.interceptors.request.use((config) => {
  const csrfToken = getCookie('csrf_token');
  if (csrfToken) {
    config.headers['X-CSRF-Token'] = csrfToken;
  }
  return config;
});
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] Backend —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç httpOnly cookies
- [ ] Frontend –Ω–µ —Ö—Ä–∞–Ω–∏—Ç —Ç–æ–∫–µ–Ω—ã –≤ localStorage
- [ ] `withCredentials: true` –Ω–∞ –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
- [ ] CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å `allow_credentials: true`
- [ ] –õ–æ–≥–∏–Ω/–ª–æ–≥–∞—É—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Token refresh —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã (cookies –≤ handshake)

---

### 2.2. –î–æ–±–∞–≤–∏—Ç—å input sanitization –¥–ª—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö —Ñ–æ—Ä–º

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH
**–í—Ä–µ–º—è:** 2 –¥–Ω—è
**–§–∞–π–ª—ã:** `components/medical/EMRSystem.jsx`, –≤—Å–µ —Ñ–æ—Ä–º—ã

#### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// –ü—Ä—è–º–æ–π –≤–≤–æ–¥ –±–µ–∑ sanitization
<textarea
  value={emrData.complaints}
  onChange={(e) => handleFieldChange('complaints', e.target.value)}
/>
```

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—Å—Ç–∞–≤–∏—Ç—å JavaScript, HTML entities, Unicode control characters.

#### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è sanitization**

```bash
npm install dompurify
npm install --save-dev @types/dompurify
```

**–®–∞–≥ 2: –£—Ç–∏–ª–∏—Ç–∞ sanitization**

```javascript
// frontend/src/utils/sanitizer.js (–ù–û–í–´–ô –§–ê–ô–õ)
import DOMPurify from 'dompurify';

/**
 * Sanitization –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –ø–æ–ª–µ–π
 */
export function sanitizeMedicalText(text) {
  if (!text || typeof text !== 'string') return text;

  // 1. –£–¥–∞–ª–∏—Ç—å HTML tags (–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–µ–∫—Å—Ç)
  let sanitized = DOMPurify.sanitize(text, {
    ALLOWED_TAGS: [],  // –ù–∏–∫–∞–∫–∏—Ö HTML —Ç–µ–≥–æ–≤
    KEEP_CONTENT: true
  });

  // 2. –£–¥–∞–ª–∏—Ç—å –æ–ø–∞—Å–Ω—ã–µ Unicode —Å–∏–º–≤–æ–ª—ã (control characters)
  sanitized = sanitized.replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F-\x9F]/g, '');

  // 3. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–±–µ–ª—ã
  sanitized = sanitized.replace(/\s+/g, ' ').trim();

  // 4. –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–ª–∏–Ω—É (–∑–∞—â–∏—Ç–∞ –æ—Ç DoS)
  const MAX_LENGTH = 50000;
  if (sanitized.length > MAX_LENGTH) {
    sanitized = sanitized.substring(0, MAX_LENGTH);
  }

  return sanitized;
}

/**
 * Sanitization –¥–ª—è –∏–º—ë–Ω –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
 */
export function sanitizePatientName(name) {
  if (!name) return name;

  // –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã, –ø—Ä–æ–±–µ–ª—ã, –¥–µ—Ñ–∏—Å—ã
  return name
    .replace(/[^–∞-—è–ê-–Ø—ë–Åa-zA-Z\s\-]/g, '')
    .trim();
}

/**
 * Sanitization –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
 */
export function sanitizePhone(phone) {
  if (!phone) return phone;

  // –¢–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã, +, -, (, ), –ø—Ä–æ–±–µ–ª—ã
  return phone.replace(/[^0-9\+\-\(\)\s]/g, '');
}

/**
 * Sanitization –¥–ª—è email
 */
export function sanitizeEmail(email) {
  if (!email) return email;

  // –ë–∞–∑–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ (–æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
  return email
    .toLowerCase()
    .trim()
    .replace(/[<>]/g, '');
}
```

**–®–∞–≥ 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ EMRSystem.jsx**

```javascript
import {
  sanitizeMedicalText,
  sanitizePatientName,
  sanitizePhone
} from '../../utils/sanitizer';

// –û–±–Ω–æ–≤–∏—Ç—å handleFieldChange
const handleFieldChange = (field, value) => {
  let sanitizedValue = value;

  // –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é sanitization
  if (['complaints', 'anamnesis', 'examination', 'diagnosis', 'treatment_plan'].includes(field)) {
    sanitizedValue = sanitizeMedicalText(value);
  }

  setEmrData(prev => ({
    ...prev,
    [field]: sanitizedValue
  }));
};

// –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
const handleSave = async () => {
  const sanitizedData = {
    ...emrData,
    complaints: sanitizeMedicalText(emrData.complaints),
    anamnesis: sanitizeMedicalText(emrData.anamnesis),
    examination: sanitizeMedicalText(emrData.examination),
    // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  };

  await api.post('/emr/save', sanitizedData);
};
```

**–®–∞–≥ 4: –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ backend (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)**

Backend —Ç–æ–∂–µ –¥–æ–ª–∂–µ–Ω –æ—á–∏—â–∞—Ç—å input:

```python
# backend/app/schemas/emr.py
from pydantic import BaseModel, validator
import bleach

class EMRCreate(BaseModel):
    complaints: str
    anamnesis: str
    examination: str

    @validator('complaints', 'anamnesis', 'examination')
    def sanitize_text(cls, v):
        if not v:
            return v
        # –£–¥–∞–ª–∏—Ç—å HTML
        cleaned = bleach.clean(v, tags=[], strip=True)
        # –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–ª–∏–Ω—É
        return cleaned[:50000]
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω DOMPurify
- [ ] –°–æ–∑–¥–∞–Ω `utils/sanitizer.js`
- [ ] –í—Å–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ñ–æ—Ä–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç sanitization
- [ ] Backend –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –¢–µ—Å—Ç: –≤–≤–æ–¥ `<script>alert('xss')</script>` –æ—á–∏—â–∞–µ—Ç—Å—è
- [ ] –¢–µ—Å—Ç: Unicode control characters —É–¥–∞–ª—è—é—Ç—Å—è

---

### 2.3. –í–∞–ª–∏–¥–∞—Ü–∏—è AI-–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH
**–í—Ä–µ–º—è:** 2 –¥–Ω—è
**–§–∞–π–ª—ã:** `components/medical/EMRSystem.jsx`, AI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// –°—Ç—Ä–æ–∫–∏ 156-160
if (result.findings) {
  const aiAnalysis = `\n\nAI –ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è "${attachment.name}":\n${result.findings}`;
  handleFieldChange('examination', emrData.examination + aiAnalysis);
}
```

AI output –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

#### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1: –í–∞–ª–∏–¥–∞—Ç–æ—Ä AI –∫–æ–Ω—Ç–µ–Ω—Ç–∞**

```javascript
// frontend/src/utils/aiValidator.js (–ù–û–í–´–ô –§–ê–ô–õ)

/**
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ AI output –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
 */
export function validateAIOutput(aiText, context = {}) {
  const warnings = [];
  const errors = [];

  // 1. –ë–∞–∑–æ–≤–∞—è sanitization
  const sanitized = sanitizeMedicalText(aiText);

  // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é/–º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –¥–ª–∏–Ω—É
  if (sanitized.length < 10) {
    errors.push('AI –æ—Ç–≤–µ—Ç —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π (–≤–æ–∑–º–æ–∂–Ω–∞ –æ—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)');
  }
  if (sanitized.length > 10000) {
    warnings.push('AI –æ—Ç–≤–µ—Ç –æ—á–µ–Ω—å –¥–ª–∏–Ω–Ω—ã–π');
  }

  // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è (–ø—Ä–∏–∑–Ω–∞–∫ hallucination)
  const words = sanitized.split(/\s+/);
  const uniqueWords = new Set(words);
  if (words.length > 50 && uniqueWords.size < words.length * 0.3) {
    warnings.push('–û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–æ–≤—Ç–æ—Ä—è—é—â–∏–µ—Å—è —Ñ—Ä–∞–∑—ã - –≤–æ–∑–º–æ–∂–Ω–∞ –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è AI');
  }

  // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
  const dangerousPatterns = [
    /javascript:/i,
    /<script/i,
    /onclick=/i,
    /onerror=/i,
    /eval\(/i
  ];

  for (const pattern of dangerousPatterns) {
    if (pattern.test(sanitized)) {
      errors.push('AI output —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç');
      break;
    }
  }

  // 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ disclaimer
  const hasDisclaimer = /AI|–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç|–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏/i.test(sanitized);
  if (!hasDisclaimer) {
    warnings.push('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–º–µ—Ç–∫—É –æ–± AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏');
  }

  return {
    sanitized,
    valid: errors.length === 0,
    errors,
    warnings
  };
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI output –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –∑–∞–ø–∏—Å—å
 */
export function formatAIOutput(aiText, metadata = {}) {
  const validation = validateAIOutput(aiText);

  if (!validation.valid) {
    throw new Error(`AI output validation failed: ${validation.errors.join(', ')}`);
  }

  // –î–æ–±–∞–≤–∏—Ç—å metadata –∏ disclaimer
  const timestamp = new Date().toLocaleString('ru-RU');
  const formatted = `
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
ü§ñ AI –ê–ù–ê–õ–ò–ó (–¢—Ä–µ–±—É–µ—Ç—Å—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Ä–∞—á–æ–º)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
–í—Ä–µ–º—è: ${timestamp}
–ú–æ–¥–µ–ª—å: ${metadata.model || 'Unknown'}
–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${metadata.imageName || 'N/A'}

${validation.sanitized}

‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –î–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å–æ–∑–¥–∞–Ω –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–æ–º –∏ —Ç—Ä–µ–±—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—Ä–∞—á–æ–º.
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
`;

  return {
    formatted,
    warnings: validation.warnings
  };
}
```

**–®–∞–≥ 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ EMRSystem.jsx**

```javascript
import { formatAIOutput } from '../../utils/aiValidator';

// –°—Ç—Ä–æ–∫–∏ 156-160 - –ó–ê–ú–ï–ù–ò–¢–¨
const handleAIAnalysis = async (attachment, result) => {
  try {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
    const { formatted, warnings } = formatAIOutput(result.findings, {
      model: 'GPT-4 Vision',
      imageName: attachment.name
    });

    // –ü–æ–∫–∞–∑–∞—Ç—å warnings –µ—Å–ª–∏ –µ—Å—Ç—å
    if (warnings.length > 0) {
      showWarningDialog({
        title: '–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è AI –∞–Ω–∞–ª–∏–∑–∞',
        message: warnings.join('\n'),
        onContinue: () => {
          handleFieldChange('examination', emrData.examination + '\n\n' + formatted);
        }
      });
    } else {
      handleFieldChange('examination', emrData.examination + '\n\n' + formatted);
    }

    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞—É–¥–∏—Ç–∞
    logAIUsage({
      action: 'ai_image_analysis',
      patient_id: appointment?.patient_id,
      doctor_id: currentUser?.id,
      timestamp: new Date().toISOString(),
      image: attachment.name,
      model: 'GPT-4 Vision'
    });

  } catch (error) {
    setError(`–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ AI –∞–Ω–∞–ª–∏–∑–∞: ${error.message}`);
  }
};
```

**–®–∞–≥ 3: Backend audit logging**

```python
# backend/app/models/ai_usage_log.py

class AIUsageLog(Base):
    __tablename__ = "ai_usage_logs"

    id = Column(Integer, primary_key=True)
    user_id = Column(Integer, ForeignKey("users.id"))
    patient_id = Column(Integer, ForeignKey("patients.id"))
    action = Column(String)  # 'ai_image_analysis', 'ai_diagnosis', etc.
    model = Column(String)
    input_data = Column(Text)  # Sanitized
    output_data = Column(Text)  # Sanitized
    timestamp = Column(DateTime, default=datetime.utcnow)
    verified_by_doctor = Column(Boolean, default=False)
    verification_timestamp = Column(DateTime, nullable=True)
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –°–æ–∑–¥–∞–Ω `utils/aiValidator.js`
- [ ] AI output –ø—Ä–æ—Ö–æ–¥–∏—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π
- [ ] –î–æ–±–∞–≤–ª–µ–Ω disclaimer –æ–± AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- [ ] Backend logging –¥–ª—è AI usage
- [ ] UI –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç warnings –ø—Ä–∏ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–º output
- [ ] –¢–µ—Å—Ç: AI output —Å `<script>` –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è

---

### 2.4. –î–æ–±–∞–≤–∏—Ç—å –∑–∞—â–∏—Ç—É –Ω–∞ unprotected routes

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH
**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å
**–§–∞–π–ª—ã:** `App.jsx`

#### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// –°—Ç—Ä–æ–∫–∞ 1156 - –Ω–µ—Ç –∑–∞—â–∏—Ç—ã
<Route path="/queue/join" element={<QueueJoin />} />
```

#### –†–µ—à–µ–Ω–∏–µ

```javascript
// App.jsx

// –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∫–∞–∫–∏–µ —Ä–æ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è –∫ –æ—á–µ—Ä–µ–¥–∏
<Route
  path="/queue/join"
  element={
    <RequireAuth roles={['Patient', 'Registrar']}>
      <QueueJoin />
    </RequireAuth>
  }
/>

// –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –µ—Å–ª–∏ —ç—Ç–æ –ø—É–±–ª–∏—á–Ω—ã–π endpoint –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤
// —Å QR –∫–æ–¥–∞–º–∏, –¥–æ–±–∞–≤–∏—Ç—å token validation –≤–Ω—É—Ç—Ä–∏ QueueJoin
```

**–ê—É–¥–∏—Ç –≤—Å–µ—Ö routes:**

```javascript
// –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∞—É–¥–∏—Ç–∞ routes
// frontend/scripts/audit-routes.js

import fs from 'fs';
import path from 'path';

const appJsxPath = path.join(process.cwd(), 'src', 'App.jsx');
const content = fs.readFileSync(appJsxPath, 'utf-8');

// –ù–∞–π—Ç–∏ –≤—Å–µ <Route> –±–µ–∑ RequireAuth
const routeRegex = /<Route\s+path="([^"]+)"\s+element={<(\w+)/g;
const matches = [...content.matchAll(routeRegex)];

const unprotectedRoutes = matches.filter(match => {
  const [fullMatch, path, component] = match;
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—Ç –ª–∏ RequireAuth –ø–µ—Ä–µ–¥ Route
  const index = content.indexOf(fullMatch);
  const before = content.substring(Math.max(0, index - 200), index);
  return !before.includes('RequireAuth');
});

console.log('Unprotected routes:');
unprotectedRoutes.forEach(([, path, component]) => {
  console.log(`  ${path} ‚Üí ${component}`);
});
```

–ó–∞–ø—É—Å—Ç–∏—Ç—å:
```bash
node scripts/audit-routes.js
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –í—Å–µ protected routes –∏–º–µ—é—Ç RequireAuth
- [ ] Public routes –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –æ–±–æ—Å–Ω–æ–≤–∞–Ω—ã
- [ ] –°–∫—Ä–∏–ø—Ç audit-routes.js —Å–æ–∑–¥–∞–Ω
- [ ] CI/CD –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ unprotected routes

---

### 2.5. –ò—Å–ø—Ä–∞–≤–∏—Ç—å soft role checking

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH
**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å
**–§–∞–π–ª—ã:** `App.jsx`

#### –ü—Ä–æ–±–ª–µ–º–∞

```javascript
// –°—Ç—Ä–æ–∫–∏ 158-160
if (!profile?.roles || profile.roles.length === 0) {
  return true; // ‚ùå –†–∞–∑—Ä–µ—à–∞–µ—Ç –¥–æ—Å—Ç—É–ø –±–µ–∑ —Ä–æ–ª–µ–π!
}
```

#### –†–µ—à–µ–Ω–∏–µ

```javascript
// App.jsx - —Å—Ç—Ä–æ–∫–∏ 150-205

function RequireAuth({ roles, children }) {
  const [loading, setLoading] = useState(true);
  const [authorized, setAuthorized] = useState(false);

  useEffect(() => {
    async function checkAuth() {
      const token = tokenManager.getAccessToken();

      // –ù–µ—Ç —Ç–æ–∫–µ–Ω–∞ = –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞
      if (!token) {
        setAuthorized(false);
        setLoading(false);
        return;
      }

      try {
        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å
        const profileResponse = await api.get('/auth/me');
        const profile = profileResponse.data;
        setProfile(profile);

        // –°–¢–†–û–ì–ê–Ø –ü–†–û–í–ï–†–ö–ê –†–û–õ–ï–ô
        if (!profile || !profile.roles || profile.roles.length === 0) {
          // ‚ùå –ù–ï–¢ –†–û–õ–ï–ô = –ù–ï–¢ –î–û–°–¢–£–ü–ê
          console.warn('User has no roles assigned');
          setAuthorized(false);
          setLoading(false);
          return;
        }

        // –ï—Å–ª–∏ —Ä–æ–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã - —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ —Ä–æ–ª—å
        if (!roles || roles.length === 0) {
          setAuthorized(profile.roles.length > 0);
        } else {
          // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–æ–ª–µ–π
          const hasRequiredRole = profile.roles.some(userRole =>
            roles.includes(userRole)
          );
          setAuthorized(hasRequiredRole);
        }

      } catch (error) {
        console.error('Auth check failed:', error);
        setAuthorized(false);
      } finally {
        setLoading(false);
      }
    }

    checkAuth();
  }, [roles]);

  if (loading) {
    return <div>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞...</div>;
  }

  if (!authorized) {
    return <Navigate to="/login" state={{ from: location }} replace />;
  }

  return children;
}
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±–µ–∑ —Ä–æ–ª–µ–π –Ω–µ –ø–æ–ª—É—á–∞—é—Ç –¥–æ—Å—Ç—É–ø
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ä–æ–ª—è–º–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- [ ] –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- [ ] –¢–µ—Å—Ç: user –±–µ–∑ —Ä–æ–ª–µ–π ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login
- [ ] –¢–µ—Å—Ç: user —Å —Ä–æ–ª—å—é 'Patient' –Ω–µ –º–æ–∂–µ—Ç –Ω–∞ /admin

---

### 2.6. –£–¥–∞–ª–∏—Ç—å hardcoded localhost URLs

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü† HIGH
**–í—Ä–µ–º—è:** 2 –¥–Ω—è
**–§–∞–π–ª—ã:** 27 —Ñ–∞–π–ª–æ–≤

#### –ü—Ä–æ–±–ª–µ–º–∞

65 –≤—Ö–æ–∂–¥–µ–Ω–∏–π `http://localhost:8000` –≤ –∫–æ–¥–µ.

#### –†–µ—à–µ–Ω–∏–µ

**–®–∞–≥ 1: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**

```javascript
// frontend/src/config/api.js (–ù–û–í–´–ô –§–ê–ô–õ)

/**
 * API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å fallback –ª–æ–≥–∏–∫–æ–π
 */
export const API_CONFIG = {
  // –ë–∞–∑–æ–≤—ã–π URL API
  BASE_URL: import.meta.env.VITE_API_BASE_URL || getDefaultApiUrl(),

  // WebSocket URL
  WS_URL: import.meta.env.VITE_WS_URL || getDefaultWsUrl(),

  // Timeout –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
  TIMEOUT: parseInt(import.meta.env.VITE_API_TIMEOUT) || 30000,
};

/**
 * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π API URL –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
 */
function getDefaultApiUrl() {
  // Production
  if (import.meta.env.PROD) {
    // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ API –Ω–∞ —Ç–æ–º –∂–µ –¥–æ–º–µ–Ω–µ
    return `${window.location.origin}/api/v1`;
  }

  // Development
  return 'http://localhost:8000/api/v1';
}

/**
 * –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π WebSocket URL
 */
function getDefaultWsUrl() {
  if (import.meta.env.PROD) {
    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
    return `${protocol}//${window.location.host}/ws`;
  }

  return 'ws://localhost:8000/ws';
}

export default API_CONFIG;
```

**–®–∞–≥ 2: .env —Ñ–∞–π–ª—ã**

```bash
# frontend/.env.development
VITE_API_BASE_URL=http://localhost:8000/api/v1
VITE_WS_URL=ws://localhost:8000/ws

# frontend/.env.production
VITE_API_BASE_URL=/api/v1
VITE_WS_URL=/ws

# frontend/.env.staging (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
VITE_API_BASE_URL=https://staging.clinic.com/api/v1
VITE_WS_URL=wss://staging.clinic.com/ws
```

**–®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å api/client.js**

```javascript
// –ë–´–õ–û
const API_BASE = 'http://localhost:8000/api/v1'; // ‚ùå

// –°–¢–ê–õ–û
import API_CONFIG from '../config/api';

const api = axios.create({
  baseURL: API_CONFIG.BASE_URL,  // ‚úÖ
  timeout: API_CONFIG.TIMEOUT,
  headers: { 'Content-Type': 'application/json' },
  withCredentials: true
});
```

**–®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç—å LoginFormStyled.jsx**

```javascript
// –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∞ 79)
const response = await fetch('http://localhost:8000/api/v1/auth/minimal-login', ...); // ‚ùå

// –°–¢–ê–õ–û
import API_CONFIG from '../../config/api';

const response = await fetch(`${API_CONFIG.BASE_URL}/auth/minimal-login`, {  // ‚úÖ
  method: 'POST',
  ...
});
```

**–®–∞–≥ 5: –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–º–µ–Ω–∞**

```bash
# –ü–æ–∏—Å–∫ –≤—Å–µ—Ö hardcoded URLs
grep -r "http://localhost" frontend/src/ --include="*.jsx" --include="*.js"

# –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞:
# 1. –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å API_CONFIG
# 2. –ó–∞–º–µ–Ω–∏—Ç—å hardcoded URL –Ω–∞ API_CONFIG.BASE_URL
```

–°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (27 —Ñ–∞–π–ª–æ–≤):
- `api/client.js`
- `components/auth/LoginFormStyled.jsx`
- `api/mcpClient.js`
- `hooks/usePayments.js`
- `services/queue.js`
- `utils/queueApi.js`
- ... –∏ —Ç.–¥.

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] –°–æ–∑–¥–∞–Ω `config/api.js`
- [ ] `.env.development` –∏ `.env.production` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] 0 –≤—Ö–æ–∂–¥–µ–Ω–∏–π `http://localhost` –≤ src/ (–∫—Ä–æ–º–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤)
- [ ] Dev —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç —Å localhost
- [ ] Production build –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ URLs
- [ ] WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö

---

## –≠—Ç–∞–ø 3: –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (2-4 –Ω–µ–¥–µ–ª–∏)

> **–°–†–û–ö:** 1 –º–µ—Å—è—Ü
> **–û–¢–í–ï–¢–°–¢–í–ï–ù–ù–´–ô:** Full Team

---

### 3.1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å HIPAA audit logging

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° MEDIUM (–Ω–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è HIPAA)
**–í—Ä–µ–º—è:** 5 –¥–Ω–µ–π
**–§–∞–π–ª—ã:** –í—Å–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### –†–µ—à–µ–Ω–∏–µ

```javascript
// frontend/src/utils/auditLogger.js (–ù–û–í–´–ô –§–ê–ô–õ)

/**
 * HIPAA Audit Logger
 * –õ–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –¥–æ—Å—Ç—É–ø—ã –∫ PHI (Protected Health Information)
 */
export class AuditLogger {
  static async log(event) {
    const auditEntry = {
      timestamp: new Date().toISOString(),
      user_id: getCurrentUserId(),
      user_role: getCurrentUserRole(),
      event_type: event.type,
      resource_type: event.resourceType,
      resource_id: event.resourceId,
      action: event.action,
      ip_address: await getClientIP(),
      user_agent: navigator.userAgent,
      success: event.success ?? true,
      details: event.details
    };

    try {
      await api.post('/audit/log', auditEntry, {
        // –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π –∑–∞–ø—Ä–æ—Å failed
        skipAuthRedirect: true
      });
    } catch (error) {
      // Fallback - localStorage queue
      const queue = JSON.parse(localStorage.getItem('audit_queue') || '[]');
      queue.push(auditEntry);
      localStorage.setItem('audit_queue', JSON.stringify(queue));
    }
  }

  // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
  static async logPatientView(patientId) {
    await this.log({
      type: 'ACCESS',
      resourceType: 'PATIENT',
      resourceId: patientId,
      action: 'VIEW'
    });
  }

  static async logEMRModification(patientId, emrId, changes) {
    await this.log({
      type: 'MODIFICATION',
      resourceType: 'EMR',
      resourceId: emrId,
      action: 'UPDATE',
      details: {
        patient_id: patientId,
        fields_changed: Object.keys(changes)
      }
    });
  }

  static async logFileDownload(fileId, fileName) {
    await this.log({
      type: 'ACCESS',
      resourceType: 'MEDICAL_FILE',
      resourceId: fileId,
      action: 'DOWNLOAD',
      details: { file_name: fileName }
    });
  }
}
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö:**

```javascript
// EMRSystem.jsx
import { AuditLogger } from '../../utils/auditLogger';

// –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ EMR
useEffect(() => {
  if (appointment?.patient_id) {
    AuditLogger.logPatientView(appointment.patient_id);
  }
}, [appointment]);

// –ü—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ EMR
const handleSave = async () => {
  const changes = getChangedFields(originalData, emrData);

  await api.post('/emr/save', emrData);

  await AuditLogger.logEMRModification(
    appointment.patient_id,
    emr.id,
    changes
  );
};
```

#### –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏—ë–º–∫–∏
- [ ] AuditLogger —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [ ] –õ–æ–≥–∏—Ä—É—é—Ç—Å—è: –ø—Ä–æ—Å–º–æ—Ç—Ä –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤, –∏–∑–º–µ–Ω–µ–Ω–∏–µ EMR, —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
- [ ] Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç audit logs –≤ –ë–î
- [ ] Audit logs –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è/–∏–∑–º–µ–Ω–µ–Ω–∏—è
- [ ] –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ audit trail

---

### 3.2. –î–æ–±–∞–≤–∏—Ç—å Content Security Policy

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° MEDIUM
**–í—Ä–µ–º—è:** 2 –¥–Ω—è

#### –†–µ—à–µ–Ω–∏–µ

```html
<!-- frontend/index.html -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' 'unsafe-eval';
  style-src 'self' 'unsafe-inline';
  img-src 'self' data: blob: https:;
  font-src 'self' data:;
  connect-src 'self' ws://localhost:8000 wss://localhost:8000;
  frame-ancestors 'none';
  base-uri 'self';
  form-action 'self';
">
```

–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–∂–µ—Å—Ç–æ—á–∞—Ç—å (—É–±—Ä–∞—Ç—å 'unsafe-inline', 'unsafe-eval').

---

### 3.3. –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å RequireAuth implementations

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° MEDIUM
**–í—Ä–µ–º—è:** 1 –¥–µ–Ω—å

–£–¥–∞–ª–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–∂–¥—É `App.jsx` –∏ `RequireAuth.jsx`.

---

### 3.4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è bundle size

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üü° MEDIUM
**–í—Ä–µ–º—è:** 3 –¥–Ω—è

- –ê–Ω–∞–ª–∏–∑ bundle —Å `npm run analyze`
- Tree-shaking –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –∫–æ–¥–∞
- Dynamic imports –¥–ª—è –∫—Ä—É–ø–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫

---

## –≠—Ç–∞–ø 4: –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-3 –º–µ—Å—è—Ü–∞)

### 4.1. HIPAA Compliance Certification
### 4.2. Zero-knowledge Architecture
### 4.3. Security Penetration Testing
### 4.4. Rate Limiting & DDoS Protection
### 4.5. Multi-Factor –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit Tests

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
npm run test

# –¢–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤—ã—Ö —É—Ç–∏–ª–∏—Ç
npm run test -- --grep "tokenManager"
npm run test -- --grep "fileValidator"
npm run test -- --grep "sanitizer"
```

### E2E Tests

```bash
# Playwright —Ç–µ—Å—Ç—ã
npm run test:e2e

# –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
# 1. Login flow —Å httpOnly cookies
# 2. File upload validation
# 3. AI content validation
# 4. Role-based access control
```

### Security Tests

```bash
# XSS —Ç–µ—Å—Ç—ã
# CSRF —Ç–µ—Å—Ç—ã
# File upload bypass —Ç–µ—Å—Ç—ã
# Token theft simulation
```

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –≠—Ç–∞–ø 1 (Critical)
- [ ] 0 hardcoded credentials
- [ ] –ï–¥–∏–Ω—ã–π token key –≤–æ –≤—Å—ë–º –∫–æ–¥–µ
- [ ] 0 console.log —Å PHI –≤ production
- [ ] 0 critical npm vulnerabilities
- [ ] Blob URLs –æ—Å–≤–æ–±–æ–∂–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] File validation —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [ ] Hardcoded patient data —É–¥–∞–ª—ë–Ω

### –≠—Ç–∞–ø 2 (High)
- [ ] httpOnly cookies –≤–Ω–µ–¥—Ä–µ–Ω—ã
- [ ] Input sanitization —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] AI output –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
- [ ] –í—Å–µ routes –∑–∞—â–∏—â–µ–Ω—ã
- [ ] Soft role checking –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [ ] 0 hardcoded localhost URLs

### –≠—Ç–∞–ø 3 (Medium)
- [ ] Audit logging —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] CSP –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] RequireAuth –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω
- [ ] Bundle size –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω

### –≠—Ç–∞–ø 4 (Long-term)
- [ ] HIPAA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∞
- [ ] Penetration testing –ø—Ä–æ–π–¥–µ–Ω
- [ ] Production ready

---

## –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

### GitHub Issues

–°–æ–∑–¥–∞—Ç—å issues –¥–ª—è –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏:

```
[CRITICAL] Remove hardcoded credentials (#1)
[CRITICAL] Fix token key inconsistency (#2)
[CRITICAL] Remove PHI logging (#3)
...
```

### Milestones

- Milestone 1: Critical Fixes (Week 1)
- Milestone 2: High Priority (Week 2-3)
- Milestone 3: Medium Priority (Week 4-6)
- Milestone 4: HIPAA Ready (Month 3)

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–µ

**Frontend Team Lead:** [–ò–º—è]
**Backend Team Lead:** [–ò–º—è]
**Security Officer:** [–ò–º—è]
**HIPAA Compliance Officer:** [–ò–º—è]

---

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-06
**–°–ª–µ–¥—É—é—â–∏–π review:** 2025-12-13