# –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú –° API

## üéØ –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

### –ü—Ä–æ–±–ª–µ–º—ã:
1. ‚ùå **403 Forbidden** - `/admin/departments` —Ç—Ä–µ–±—É–µ—Ç —Ä–æ–ª—å Admin, —É —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –µ—ë –Ω–µ—Ç
2. ‚ùå **404 Not Found** - `/registrar/departments` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —Ç.–∫. backend –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
3. ‚úÖ **500 Error –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞** - –±–∞–≥ —Å `department` –≤ `app/crud/visit.py` —É–∂–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω

## üîß –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

### Backend –∏–∑–º–µ–Ω–µ–Ω–∏—è (–£–ñ–ï –í –ö–û–î–ï):
1. **–°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π endpoint** `/api/v1/registrar/departments` –≤ —Ñ–∞–π–ª–µ:
   - `c:\final\backend\app\api\v1\endpoints\registrar_integration.py` (—Å—Ç—Ä–æ–∫–∏ 29-73)
   - –î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Ä–æ–ª–µ–π: Admin, Registrar, Doctor, Cashier
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è —Å queue_prefix

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω –±–∞–≥ 500** –≤ —Ñ–∞–π–ª–µ:
   - `c:\final\backend\app\crud\visit.py` (—Å—Ç—Ä–æ–∫–∏ 120-147)
   - –¢–µ–ø–µ—Ä—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `department` –∫–∞–∫ —Å—Ç—Ä–æ–∫—É –∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ `department_id`

### Frontend –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. **–û–±–Ω–æ–≤–ª–µ–Ω** `c:\final\frontend\src\pages\RegistrarPanel.jsx`
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `/registrar/departments` endpoint (—Å—Ç—Ä–æ–∫–∞ 807)

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: Backend –ù–ï –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω!

–ù–æ–≤—ã–π endpoint `/registrar/departments` –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ–¥, –Ω–æ **–ù–ï –ê–ö–¢–ò–í–ï–ù** –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–µ–π –∫–æ–¥–∞.

## üöÄ –†–ï–®–ï–ù–ò–ï - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ Backend:

### –®–∞–≥ 1: –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ backend
–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω uvicorn –Ω–∞–∂–º–∏—Ç–µ: **Ctrl+C**

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend –∑–∞–Ω–æ–≤–æ
```powershell
cd c:\final\backend
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```powershell
cd c:\final\backend
python verify_fix.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ Backend seems restarted! /registrar/departments returns 401
‚úÖ Cart creation SUCCESS!
üéâ ALL SYSTEMS GO!
```

### –®–∞–≥ 4: –û–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä
–ù–∞–∂–º–∏—Ç–µ **F5** –≤ Registrar Panel

## ‚úÖ –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞:

1. ‚úÖ –û—à–∏–±–∫–∞ 403 Forbidden –∏—Å—á–µ–∑–Ω–µ—Ç
2. ‚úÖ –û—à–∏–±–∫–∞ 404 Not Found –∏—Å—á–µ–∑–Ω–µ—Ç  
3. ‚úÖ –û—à–∏–±–∫–∞ 500 Internal Server Error –∏—Å—á–µ–∑–Ω–µ—Ç
4. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
5. ‚úÖ –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ –æ—Ç–¥–µ–ª–µ–Ω–∏—è –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

### –ù–æ–≤—ã–π endpoint:
- **URL**: `GET /api/v1/registrar/departments`
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: `?active_only=true` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: Bearer token
- **–†–æ–ª–∏**: Admin, Registrar, Doctor, Cashier
- **–û—Ç–≤–µ—Ç**: –°–ø–∏—Å–æ–∫ –æ—Ç–¥–µ–ª–µ–Ω–∏–π —Å –ø–æ–ª—è–º–∏:
  - id, key, name_ru, name_uz
  - icon, color, gradient
  - display_order, active
  - description, queue_prefix

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±–∞–≥:
- **–§–∞–π–ª**: `app/crud/visit.py`
- **–ü—Ä–æ–±–ª–µ–º–∞**: `department` (string) –ø–µ—Ä–µ–¥–∞–≤–∞–ª—Å—è –≤ relationship –ø–æ–ª–µ
- **–†–µ—à–µ–Ω–∏–µ**: –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è `department` key ‚Üí `department_id` —á–µ—Ä–µ–∑ –∑–∞–ø—Ä–æ—Å –∫ –ë–î

---

**–í–ê–ñ–ù–û**: –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –£–ñ–ï –≤ –∫–æ–¥–µ. –ù—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ backend!
