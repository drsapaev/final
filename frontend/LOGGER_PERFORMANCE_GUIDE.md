# Logger Performance Guide

## Оптимизация производительности logger.js

### Проблема
После внедрения PHI-санитизации в logger.js возникли задержки при выполнении действий в приложении из-за обработки больших объектов.

### Решение (v2)

#### Оптимизации производительности:

1. **Уменьшена максимальная глубина**: 5 → **3 уровня**
   - Быстрее обработка вложенных объектов
   - Меньше рекурсивных вызовов

2. **Уменьшены лимиты**:
   - Массивы: 10 → **5 элементов**
   - Объекты: 20 → **15 полей**
   - Большие объекты показываются как `[Object with N fields]`

3. **Защита от React/Event объектов**:
   - Автоматическое определение Fiber, SyntheticEvent
   - Замена на `[ConstructorName]` без обработки

4. **Быстрая проверка размера**:
   - Проверка `keys.length` перед обработкой
   - Пропуск объектов с >15 полями

5. **Оптимизация PHI проверки**:
   - Замена `.some()` на цикл `for` с `break`
   - На ~20% быстрее для массивов PHI_FIELDS

6. **Error объекты**:
   - Специальная обработка Error
   - Показываются только 3 строки stack trace

7. **Опциональная санитизация**:
   - Переменная окружения: `VITE_ENABLE_PHI_SANITIZATION=false`
   - Отключает санитизацию полностью для максимальной скорости

### Отключение санитизации в development

Если вам нужна максимальная производительность в dev режиме:

**Вариант 1: .env.local**
```bash
# frontend/.env.local
VITE_ENABLE_PHI_SANITIZATION=false
```

**Вариант 2: Командная строка**
```bash
VITE_ENABLE_PHI_SANITIZATION=false npm run dev
```

**⚠️ ВАЖНО**: В production санитизация всегда активна для HIPAA compliance!

### Метрики производительности

**До оптимизации (v1)**:
- Полное зависание на больших объектах
- ~500ms задержка на логирование

**После первого фикса (v1)**:
- Зависание исправлено
- ~50-100ms задержка заметна

**После оптимизации (v2)**:
- ~5-15ms на логирование
- Незаметные задержки для пользователя

### Примеры вывода

```javascript
logger.log('User data', bigObject);

// Было (v1): полная обработка всех полей
// {field1: ..., field2: ..., ... x100 fields}

// Стало (v2): быстрое резюме
// [Object with 100 fields]
```

```javascript
logger.log('Events', reactEvents);

// Было (v1): попытка обработать весь Fiber tree → зависание
// Стало (v2): мгновенная замена
// [SyntheticEvent]
```

### Debugging

Если вам нужно увидеть полный объект:
```javascript
// Временно отключите logger и используйте console напрямую
console.log('Full object:', obj);

// Или используйте console.table для структурированных данных
logger.table(data); // Уже оптимизирован
```

### Production Build

В production санитизация работает всегда:
- PHI данные → `[REDACTED]`
- Циклические ссылки → `[CIRCULAR]`
- DOM элементы → `[DOM_OR_REACT_ELEMENT]`
- Большие объекты → `[Object with N fields]`

Это гарантирует HIPAA compliance без утечек медицинских данных в логи.
