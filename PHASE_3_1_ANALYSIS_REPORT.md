# –û—Ç—á–µ—Ç: –§–∞–∑–∞ 3.1 - –ê–Ω–∞–ª–∏–∑ queue endpoints –¥–ª—è –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

**–î–∞—Ç–∞**: 2025-11-24
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù
**–†–µ—à–µ–Ω–∏–µ**: üõë –ù–ï –û–ë–™–ï–î–ò–ù–Ø–¢–¨ (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥)
**–í–µ—Ç–∫–∞**: feat/macos-ui-refactor

---

## üìã Executive Summary

–ü–æ—Å–ª–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ 3 —Ñ–∞–π–ª–æ–≤ queue endpoints (**2510+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**, **24 endpoints**, **23+ Pydantic —Å—Ö–µ–º—ã**), –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ **–ù–ï –û–ë–™–ï–î–ò–ù–Ø–¢–¨** —Ñ–∞–π–ª—ã –≤ –µ–¥–∏–Ω—ã–π `queue_unified.py`.

**–ü—Ä–∏—á–∏–Ω–∞**: –°–ª–∏—à–∫–æ–º –≤—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫ –¥–ª—è production —Å–∏—Å—Ç–µ–º—ã –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –≤—ã–≥–æ–¥–µ.

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å routing conflicts, –¥–æ–±–∞–≤–∏—Ç—å —á–µ—Ç–∫—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, –º–∞—Ä–∫–∏—Ä–æ–≤–∞—Ç—å deprecated endpoints.

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–Ω–∞–ª–∏–∑–∞

### –û–±–∑–æ—Ä —Ñ–∞–π–ª–æ–≤

| –§–∞–π–ª | Endpoints | –°—Ç—Ä–æ–∫ | –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å | –°—Ç–∞—Ç—É—Å |
|------|-----------|-------|------------------|--------|
| `queue.py` | 6 | 470 | –ë–∞–∑–æ–≤–∞—è –æ—á–µ—Ä–µ–¥—å (join, QR, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –≤—ã–∑–æ–≤) | Legacy |
| `qr_queue.py` | 14 | 1604 | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è QR –æ—á–µ—Ä–µ–¥—å (—Å–µ—Å—Å–∏–∏, —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞) | Extended/Active |
| `queue_reorder.py` | 4 | 436 | –ü–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏–µ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ | Specialized |
| **–ò–¢–û–ì–û** | **24** | **2510** | –ü–æ–ª–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π | **Production** |

### Endpoints –ø–æ —Ç–∏–ø–∞–º

| –ú–µ—Ç–æ–¥ | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ | –ü—Ä–∏–º–µ—Ä—ã |
|-------|-----------|---------|
| POST | 9 | `/qrcode`, `/join`, `/join/start`, `/join/complete`, `/open`, `/call`, `/reorder` |
| GET | 10 | `/statistics`, `/status`, `/today`, `/available-specialists`, `/qr-tokens/{token}/info` |
| PUT | 4 | `/online-entry/{id}/update`, `/online-entry/{id}/full-update`, `/reorder`, `/move-entry` |
| DELETE | 1 | `/admin/qr-tokens/{token}` |

---

## üîç –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–∞—Ö–æ–¥–∫–∏

### 1. Routing Conflicts (‚ùå –ü–†–û–ë–õ–ï–ú–ê)

**–í–°–ï 3 —Ä–æ—É—Ç–µ—Ä–∞ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –æ–¥–Ω–æ–º –ø—Ä–µ—Ñ–∏–∫—Å–µ** `/queue`:

```python
# backend/app/api/v1/api.py
api_router.include_router(qr_queue.router, prefix="/queue", tags=["qr-queue"])        # –°—Ç—Ä–æ–∫–∞ 161
api_router.include_router(queue_reorder.router, prefix="/queue", tags=["queue-reorder"])  # –°—Ç—Ä–æ–∫–∞ 241
api_router.include_router(queue_router, prefix="/queue", tags=["queue"])            # –°—Ç—Ä–æ–∫–∞ 250
```

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏–µ**: Endpoints –º–æ–≥—É—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞! –ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π router –∏–º–µ–µ—Ç –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç.

---

### 2. –î—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è endpoints (‚ö†Ô∏è –ö–û–ù–§–õ–ò–ö–¢–´)

#### ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç #1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR —Ç–æ–∫–µ–Ω–∞

**queue.py:70**:
```python
@router.post("/qrcode", response_model=QueueTokenResponse)
def generate_qr_token(
    day: date,
    specialist_id: int,
    # ... –ø—Ä–æ—Å—Ç–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
)
```

**qr_queue.py:151**:
```python
@router.post("/admin/qr-tokens/generate", response_model=QRTokenResponse)
def generate_qr_token(
    request: QRTokenGenerateRequest,
    # ... —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Å expires_hours, visit_type, target_date
)
```

**–†–∞–∑–ª–∏—á–∏–µ**: `qr_queue.py` –≤–µ—Ä—Å–∏—è **–±–æ–ª–µ–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞** (–±–æ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤, –ª—É—á—à–∞—è –ª–æ–≥–∏–∫–∞).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `qr_queue.py` –≤–µ—Ä—Å–∏—é, –ø–æ–º–µ—Ç–∏—Ç—å `queue.py` –≤–µ—Ä—Å–∏—é –∫–∞–∫ DEPRECATED.

---

#### ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç #2: –í—ã–∑–æ–≤ –ø–∞—Ü–∏–µ–Ω—Ç–∞

**queue.py:412**:
```python
@router.post("/call/{entry_id}")  # –í—ã–∑—ã–≤–∞–µ—Ç –ö–û–ù–ö–†–ï–¢–ù–û–ì–û –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–æ ID
def call_patient(entry_id: int, ...)
```

**qr_queue.py:512**:
```python
@router.post("/{specialist_id}/call-next")  # –í—ã–∑—ã–≤–∞–µ—Ç –°–õ–ï–î–£–Æ–©–ï–ì–û –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
def call_next_patient(specialist_id: int, ...)
```

**–†–∞–∑–ª–∏—á–∏–µ**: –†–∞–∑–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞ (specific vs auto-next).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –û—Å—Ç–∞–≤–∏—Ç—å –û–ë–ê endpoint - —Ä–∞–∑–Ω—ã–µ use cases.

---

#### ‚ö†Ô∏è –ö–æ–Ω—Ñ–ª–∏–∫—Ç #3: QueueStatusResponse (—Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)

**queue.py –≤–µ—Ä—Å–∏—è**:
```python
class QueueStatusResponse(BaseModel):
    queue_id: int
    day: date
    specialist_name: str
    is_open: bool  # ‚ùå
    opened_at: Optional[datetime]
    total_entries: int
    waiting_entries: int  # ‚ùå
    entries: List[QueueEntryResponse]  # ‚ùå Typed list
```

**qr_queue.py –≤–µ—Ä—Å–∏—è**:
```python
class QueueStatusResponse(BaseModel):
    active: bool  # ‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è!
    queue_length: int
    current_number: Optional[int]  # ‚ùå –£–Ω–∏–∫–∞–ª—å–Ω–æ–µ –ø–æ–ª–µ
    entries: List[Dict[str, Any]]  # ‚ùå Generic dict
```

**queue_reorder.py –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–µ—Ç–∏–π –≤–∞—Ä–∏–∞–Ω—Ç** (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç raw dict)!

**–ü—Ä–æ–±–ª–µ–º–∞**: Pydantic —Å—Ö–µ–º–∞ —Å **–û–î–ò–ù–ê–ö–û–í–´–ú –ò–ú–ï–ù–ï–ú** –Ω–æ **–†–ê–ó–ù–û–ô –°–¢–†–£–ö–¢–£–†–û–ô** –≤ —Ä–∞–∑–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö!

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –≤ `QueueStatusDetailed`, `QueueStatusSimple`, `QueueStatusQR`.

---

### 3. –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ endpoints (‚úÖ –ù–ï–¢ –î–£–ë–õ–ò–†–û–í–ê–ù–ò–Ø)

**–¢–æ–ª—å–∫–æ –≤ queue.py**:
- `POST /open` - –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø—Ä–∏–µ–º–∞ (–∑–∞–∫—Ä—ã—Ç–∏–µ –æ–Ω–ª–∞–π–Ω-–∑–∞–ø–∏—Å–∏)

**–¢–æ–ª—å–∫–æ –≤ qr_queue.py** (11 endpoints):
- `POST /admin/qr-tokens/generate-clinic` - –æ–±—â–∏–π QR –¥–ª—è –∫–ª–∏–Ω–∏–∫–∏
- `GET /available-specialists` - —Å–ø–∏—Å–æ–∫ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ (–ø—É–±–ª–∏—á–Ω—ã–π)
- `GET /qr-tokens/{token}/info` - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–µ
- `POST /join/start` + `POST /join/complete` - —Å–µ—Å—Å–∏–æ–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- `GET /admin/qr-tokens/active` - –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `DELETE /admin/qr-tokens/{token}` - –¥–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞
- `GET /admin/queue-analytics/{specialist_id}` - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- `PUT /online-entry/{entry_id}/update` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞
- `PUT /online-entry/{entry_id}/full-update` - –ø–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å Visit
- `POST /online-entry/{entry_id}/cancel-service` - –æ—Ç–º–µ–Ω–∞ —É—Å–ª—É–≥–∏

**–¢–æ–ª—å–∫–æ –≤ queue_reorder.py** (4 endpoints):
- `PUT /reorder` - –º–∞—Å—Å–æ–≤–æ–µ –ø–µ—Ä–µ—É–ø–æ—Ä—è–¥–æ—á–µ–Ω–∏–µ
- `PUT /move-entry` - –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –æ–¥–Ω–æ–π –∑–∞–ø–∏—Å–∏
- `GET /status/by-specialist/` - —Å—Ç–∞—Ç—É—Å –ø–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç—É –∏ –¥–Ω—é
- `GET /status/{queue_id}` - —Å—Ç–∞—Ç—É—Å –ø–æ ID –æ—á–µ—Ä–µ–¥–∏

---

## üö® –†–∏—Å–∫–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è

### HIGH RISK —Ñ–∞–∫—Ç–æ—Ä—ã:

1. **Production –∫–ª–∏–µ–Ω—Ç—ã** (frontend) –∏—Å–ø–æ–ª—å–∑—É—é—Ç —ç—Ç–∏ API
   - –õ—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—É—Ç–µ–π —Å–ª–æ–º–∞–µ—Ç frontend
   - –¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è —Å frontend –∫–æ–º–∞–Ω–¥–æ–π
   - –ù—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –≤—ã–∑–æ–≤–æ–≤ API

2. **23+ Pydantic —Å—Ö–µ–º—ã** —Å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞–º–∏
   - `QueueStatusResponse` - 3 –†–ê–ó–ù–´–ï —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å –æ–¥–Ω–∏–º –∏–º–µ–Ω–µ–º
   - –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
   - –†–∏—Å–∫ typing errors

3. **Cross-dependencies** –º–µ–∂–¥—É endpoints
   - `qr_queue.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `QRQueueService` + `queue_service`
   - `queue_reorder.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `crud.online_queue`
   - –°–ª–æ–∂–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤

4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ comprehensive tests**
   - –ù–µ—Ç E2E —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö endpoints
   - Regression —Ç–µ—Å—Ç—ã –Ω–µ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –≤—Å–µ —Å–ª—É—á–∞–∏
   - –†–∏—Å–∫ silent breakage

### MEDIUM RISK —Ñ–∞–∫—Ç–æ—Ä—ã:

5. **–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞** –ø–æ—Å–ª–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è
   - 2510+ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ –æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ
   - –°–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å
   - –°–ª–æ–∂–Ω–æ —Ä–µ–≤—å—é–∏—Ç—å

6. **–†–∞–∑–Ω–∞—è —Å–µ–º–∞–Ω—Ç–∏–∫–∞** endpoints
   - Legacy vs Extended —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - –†–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã (simple join vs session-based join)

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–í–º–µ—Å—Ç–æ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è, –ø—Ä–∏–º–µ–Ω—è–µ–º **3-—ç—Ç–∞–ø–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é**:

### –≠—Ç–∞–ø 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å routing conflicts (‚úÖ –ö–†–ò–¢–ò–ß–ù–û)

**–ü—Ä–æ–±–ª–µ–º–∞**: –í—Å–µ 3 —Ä–æ—É—Ç–µ—Ä–∞ –Ω–∞ `/queue` prefix.

**–†–µ—à–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è:

```python
# backend/app/api/v1/api.py

# ‚úÖ –ù–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê (–∏–∑–±–µ–≥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤)
api_router.include_router(qr_queue.router, prefix="/queue/qr", tags=["qr-queue"])
api_router.include_router(queue_reorder.router, prefix="/queue/manage", tags=["queue-management"])
api_router.include_router(queue_router, prefix="/queue/legacy", tags=["queue-legacy"])

# OR (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
api_router.include_router(queue_router, prefix="/queue", tags=["queue-basic"])
api_router.include_router(qr_queue.router, prefix="/queue-qr", tags=["qr-queue"])
api_router.include_router(queue_reorder.router, prefix="/queue-admin", tags=["queue-admin"])
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ù–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤, –∫–∞–∂–¥—ã–π router –Ω–∞ —Å–≤–æ–µ–º –ø—Ä–µ—Ñ–∏–∫—Å–µ.

---

### –≠—Ç–∞–ø 2: –î–æ–±–∞–≤–∏—Ç—å DEPRECATED –º–∞—Ä–∫–µ—Ä—ã (‚úÖ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø)

–î–æ–±–∞–≤–∏—Ç—å headers –∫ deprecated endpoints:

**backend/app/api/v1/endpoints/queue.py**:
```python
"""
API endpoints –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –æ—á–µ—Ä–µ–¥–µ–π

‚ö†Ô∏è DEPRECATED NOTICE:
  - POST /qrcode ‚Üí DEPRECATED, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /queue/qr/admin/qr-tokens/generate
  - POST /join ‚Üí DEPRECATED, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ /queue/qr/join/start + /queue/qr/join/complete

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç legacy endpoints –¥–ª—è backward compatibility.
–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç qr_queue.py.

Migration guide: docs/QUEUE_API_MIGRATION_GUIDE.md
"""
```

---

### –≠—Ç–∞–ø 3: –°–æ–∑–¥–∞—Ç—å migration guide (‚úÖ –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø)

–°–æ–∑–¥–∞—Ç—å `docs/QUEUE_API_MIGRATION_GUIDE.md`:

```markdown
# Queue API Migration Guide

## Deprecated Endpoints

| Old Endpoint | Status | New Endpoint | Migration Deadline |
|--------------|--------|--------------|-------------------|
| `POST /queue/qrcode` | DEPRECATED | `POST /queue/qr/admin/qr-tokens/generate` | 2025-03-01 |
| `POST /queue/join` | DEPRECATED | `POST /queue/qr/join/start` + `POST /queue/qr/join/complete` | 2025-03-01 |

## Breaking Changes

### QueueStatusResponse Structure

**OLD (queue.py)**:
```json
{
  "queue_id": 1,
  "is_open": true,
  "waiting_entries": 5
}
```

**NEW (qr_queue.py)**:
```json
{
  "active": true,
  "queue_length": 5,
  "current_number": 3
}
```
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã (–ü–õ–ê–ù–ò–†–£–ï–ú–´–ï)

### –ë—É–¥—É—Ç –∏–∑–º–µ–Ω–µ–Ω—ã:

1. **backend/app/api/v1/api.py**
   - –ò—Å–ø—Ä–∞–≤–∏—Ç—å routing conflicts
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–µ—Ñ–∏–∫—Å—ã
   - **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: 5 —Å—Ç—Ä–æ–∫

2. **backend/app/api/v1/endpoints/queue.py**
   - –î–æ–±–∞–≤–∏—Ç—å DEPRECATED header
   - **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: +15 —Å—Ç—Ä–æ–∫ (docstring)

3. **backend/app/api/v1/endpoints/qr_queue.py**
   - –î–æ–±–∞–≤–∏—Ç—å ACTIVE/PREFERRED header
   - **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: +10 —Å—Ç—Ä–æ–∫ (docstring)

4. **backend/app/api/v1/endpoints/queue_reorder.py**
   - –î–æ–±–∞–≤–∏—Ç—å SPECIALIZED header
   - **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: +10 —Å—Ç—Ä–æ–∫ (docstring)

### –ë—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã:

5. **docs/QUEUE_API_MIGRATION_GUIDE.md** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - Migration guide –¥–ª—è deprecated endpoints
   - Breaking changes –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - Timeline –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è legacy endpoints

6. **docs/QUEUE_API_REFERENCE.md** (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)
   - –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö queue endpoints
   - –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
   - –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ê—Å–ø–µ–∫—Ç | –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ | –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ |
|--------|------------------------|----------------------|
| **–†–∞–∑–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π** | 2500+ —Å—Ç—Ä–æ–∫ | 40 —Å—Ç—Ä–æ–∫ |
| **–†–∏—Å–∫ breakage** | –í–´–°–û–ö–ò–ô | –ù–ò–ó–ö–ò–ô |
| **–í—Ä–µ–º—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** | 3-5 –¥–Ω–µ–π | 2-3 —á–∞—Å–∞ |
| **Testing effort** | –í–´–°–û–ö–ò–ô | –ù–ò–ó–ö–ò–ô |
| **Backward compatibility** | –°–õ–û–ú–ê–ù–û | –°–û–•–†–ê–ù–ï–ù–û |
| **Frontend migration** | –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û | –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø |
| **Production risk** | –í–´–°–û–ö–ò–ô | –ú–ò–ù–ò–ú–ê–õ–¨–ù–´–ô |
| **Maintainability** | –°–ø–æ—Ä–Ω–æ (–æ–¥–∏–Ω –±–æ–ª—å—à–æ–π —Ñ–∞–π–ª) | –•–æ—Ä–æ—à–æ (–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ) |

**–í—ã–≤–æ–¥**: –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ **–≤ 10 —Ä–∞–∑ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ** –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### ‚úÖ –î–ï–õ–ê–ï–ú –°–ï–ô–ß–ê–°:

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å routing conflicts** - –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
2. **–î–æ–±–∞–≤–∏—Ç—å DEPRECATED –º–∞—Ä–∫–µ—Ä—ã** - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
3. **–°–æ–∑–¥–∞—Ç—å migration guide** - –ø–ª–∞–Ω –Ω–∞ –±—É–¥—É—â–µ–µ

### ‚è≥ –î–ï–õ–ê–ï–ú –ü–û–ó–ñ–ï (–§–∞–∑–∞ 4-6):

4. **Frontend migration** - –æ–±–Ω–æ–≤–∏—Ç—å API –≤—ã–∑–æ–≤—ã
5. **–£–¥–∞–ª–∏—Ç—å legacy endpoints** - –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤
6. **Unit tests** - –ø–æ–∫—Ä—ã—Ç—å –≤—Å–µ endpoints —Ç–µ—Å—Ç–∞–º–∏

### ‚ùå –ù–ï –î–ï–õ–ê–ï–ú:

7. **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª** - —Å–ª–∏—à–∫–æ–º —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ
8. **Breaking changes –±–µ–∑ migration period** - —Å–ª–æ–º–∞–µ—Ç production
9. **–ò–∑–º–µ–Ω–µ–Ω–∏–µ API –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** - —Å–ª–æ–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å

---

## üìö –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–æ–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –ü–æ—á–µ–º—É —Ä–∞–∑–¥–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –ª—É—á—à–µ?

**1. Separation of Concerns**:
- `queue.py` - –±–∞–∑–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (legacy)
- `qr_queue.py` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è QR —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (active)
- `queue_reorder.py` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ä—è–¥–∫–æ–º (specialized)

**2. Easier Code Review**:
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ QR –ª–æ–≥–∏–∫–µ –Ω–µ –∑–∞—Ç—Ä–∞–≥–∏–≤–∞—é—Ç reorder
- –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –º–æ–∂–Ω–æ —Ä–µ–≤—å—é–∏—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ

**3. Gradual Migration**:
- Legacy endpoints –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –ø–æ –æ–¥–Ω–æ–º—É
- –ù–µ—Ç —Ä–∏—Å–∫–∞ "big bang" migration

**4. Team Collaboration**:
- –†–∞–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–≥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ —Ä–∞–∑–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏
- –ú–µ–Ω—å—à–µ merge conflicts

---

## üîÆ –ë—É–¥—É—â–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ

### –í–æ–∑–º–æ–∂–Ω—ã–π roadmap:

**Q1 2025**:
- ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å routing conflicts
- ‚úÖ –î–æ–±–∞–≤–∏—Ç—å DEPRECATED –º–∞—Ä–∫–µ—Ä—ã
- ‚úÖ –°–æ–∑–¥–∞—Ç—å migration guide

**Q2 2025**:
- Frontend migration –Ω–∞ –Ω–æ–≤—ã–µ endpoints
- –ú–µ—Ç—Ä–∏–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è legacy endpoints
- Deprecation warnings –≤ API responses

**Q3 2025**:
- –£–¥–∞–ª–µ–Ω–∏–µ legacy endpoints (–µ—Å–ª–∏ migration –∑–∞–≤–µ—Ä—à–µ–Ω–∞)
- Cleanup queue.py –∏–ª–∏ –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ
- Consolidation –≤ unified —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ê–Ω–∞–ª–∏–∑ (‚úÖ –ó–ê–í–ï–†–®–ï–ù–û):
- [x] –ò–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö queue endpoints (24 endpoints)
- [x] –ê–Ω–∞–ª–∏–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (3 –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –Ω–∞–π–¥–µ–Ω–æ)
- [x] –ê–Ω–∞–ª–∏–∑ Pydantic —Å—Ö–µ–º (23+ —Å—Ö–µ–º—ã, –∫–æ–Ω—Ñ–ª–∏–∫—Ç QueueStatusResponse)
- [x] –û—Ü–µ–Ω–∫–∞ —Ä–∏—Å–∫–æ–≤ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è (–í–´–°–û–ö–ò–ô —Ä–∏—Å–∫)
- [x] –í—ã–±–æ—Ä —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏ (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥)

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è (‚è≥ –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì):
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å routing conflicts –≤ api.py
- [ ] –î–æ–±–∞–≤–∏—Ç—å DEPRECATED headers –∫ queue.py
- [ ] –î–æ–±–∞–≤–∏—Ç—å ACTIVE headers –∫ qr_queue.py
- [ ] –°–æ–∑–¥–∞—Ç—å QUEUE_API_MIGRATION_GUIDE.md
- [ ] –°–æ–∑–¥–∞—Ç—å QUEUE_API_REFERENCE.md
- [ ] –û–±–Ω–æ–≤–∏—Ç—å QUEUE_SYSTEM_ARCHITECTURE.md —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ–± endpoints

---

## üéì –£—Ä–æ–∫–∏

### –ß—Ç–æ —É–∑–Ω–∞–ª–∏:

1. **–ù–µ —Å–ø–µ—à–∏—Ç–µ —Å —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–æ–º** - –∞–Ω–∞–ª–∏–∑ –ø–æ–∫–∞–∑–∞–ª —á—Ç–æ "–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ä–∞–¥–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è" –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞
2. **Production first** - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—é—â–µ–π —Å–∏—Å—Ç–µ–º—ã –≤–∞–∂–Ω–µ–µ "–∫—Ä–∞—Å–∏–≤–æ–≥–æ –∫–æ–¥–∞"
3. **Incremental changes** - –º–∞–ª–µ–Ω—å–∫–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª—É—á—à–µ –±–æ–ª—å—à–æ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
4. **Documentation matters** - —á–µ—Ç–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤–∞–∂–Ω–µ–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤

### –ß—Ç–æ —Å—Ä–∞–±–æ—Ç–∞–ª–æ —Ö–æ—Ä–æ—à–æ:

1. **–î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º** - –∏–∑–±–µ–∂–∞–ª–∏ –±–æ–ª—å—à–æ–π –æ—à–∏–±–∫–∏
2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Task agent** - –ø–æ–ª—É—á–∏–ª–∏ –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç–∏–Ω—É
3. **–ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥** - –º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–ª–∏ —Ä–∏—Å–∫–∏

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª**: Claude Code Agent
**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù
**–†–µ—à–µ–Ω–∏–µ**: üõë –ù–ï –û–ë–™–ï–î–ò–ù–Ø–¢–¨
**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥**: –ò—Å–ø—Ä–∞–≤–∏—Ç—å routing conflicts (–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ)
